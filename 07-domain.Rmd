# 社会学のデータ分析でよくある処理 {#domain}

日本の社会学業界を念頭においたときのデータ分析でよくある処理についてランダムにまとめます。ただし内容は作成者（麦山）の経験と感覚によるもので、業界で標準的な手続きなのかどうかはわかりません。

## SSM職業小分類を大分類にまとめる（工事中）

いくつかの調査では、調査対象者に仕事の内容を自由記述で尋ね、その回答をもとに、職業名を割り当てているものがある。このときに使われる職業分類が1995年SSM職業小分類と呼ばれるものである。1995年SSM職業章分類は約200の小分類からなり、それぞれの職業に番号が振られている。この番号を振った調査を以下に列挙する。

| 調査名                        | 調査年    | **現職職業小分類** | 初職職業小分類 | **15歳時父親職業小分類** | 15歳時母親職業小分類 |
|-------------------------------|-----------|--------------------|----------------|--------------------------|----------------------|
| 社会階層と社会移動調査（SSM） | 1995      | 有                 | 有             | 有（「主な仕事」）       | 有（「主な仕事」）   |
|                               | 2005      | 有                 | 有             | 有                       | 有                   |
|                               | 2015      | 有                 | 有             | 有                       | 有                   |
| 日本版総合的社会調査（JGSS）  | 2000      | 有                 | 有             | 有                       |                      |
|                               | 2001      | 有                 | 有             | 有                       |                      |
|                               | 2002      | 有                 | 有             | 有                       |                      |
|                               | 2003      | 有                 |                | 有                       |                      |
|                               | 2005      | 有                 | 有             | 有                       |                      |
|                               | 2006      | 有                 | 有             | 有                       |                      |
|                               | 2008      | 有                 | 有             | 有                       |                      |
|                               | 2010      | 有                 | 有             | 有                       |                      |
|                               | 2012      | 有                 | 有             | 有                       |                      |
|                               | 2015      | 有                 | 有             | 有                       |                      |
| 東大社研パネル調査（JLPS）    | 2007-2020 | 有                 | 有             | 有                       | 有                   |

ふつうはこうした200個近い分類をそのまま分析に使うということはなく、少数のカテゴリにまとめて使う。カテゴリへのまとめ方はいくつも種類があるが、ここでは代表的なものとして「SSM職業大分類」と「国勢調査職業分類」の2つを準備する。

## EGP階級分類を作成する（工事中）

## 旧制学歴と新制学歴の対応

| 旧制学歴                         | 新制学歴                       | 統合学歴（5分類） | 統合学歴（4分類） | 統合学歴（3分類） |
|----------------------------------|--------------------------------|-------------------|-------------------|-------------------|
| 旧制尋常小学校                   | 新制中学校                     | 中学              | 中学              | 初等教育          |
| 旧制高等小学校                   | 新制中学校                     | 中学              | 中学              | 初等教育          |
| 旧制中学校・高等女学校           | 新制高校                       | 高校              | 高校              | 中等教育          |
| 旧制実業学校                     | 新制高校                       | 高校              | 高校              | 中等教育          |
| \-                               | 専修学校高等課程\*             | 高校              | 高校              | 中等教育          |
| \-                               | 専門学校（専修学校専門課程）\* | 専門学校          | 高校              | 高等教育\*\*      |
| 旧制師範学校                     | 新制短大・高専                 | 短大高専          | 短大高専          | 高等教育          |
| 旧制高校・専門学校・高等師範学校 | 新制短大・高専                 | 短大高専          | 短大高専          | 高等教育          |
| 旧制大学                         | 新制大学                       | 大学大学院        | 大学大学院        | 高等教育          |
| 旧制大学                         | 新制大学院                     | 大学大学院        | 大学大学院        | 高等教育          |

\*専修学校高等課程は中学卒業者を対象として職業教育を実施する機関。専修学校専門課程は高校卒業者を対象として職業教育を実施する機関で、ふつう「専門学校」というときにはこちらを指すことが多い。調査票の選択肢に「専門学校」が設けられていた場合も、対象者はおそらくこちらを想定していると思われる。

\*\*国際標準教育分類（ISCED2011）では専門学校はレベル5（Short-cycle tertiary education）とされており、高等教育相当とされている。

## 年収と労働時間から時間給を作成する

労働から得られる報酬を測定する場合、個人年収というのは必ずしも適切な指標ではないことがある。というのも、人によって労働時間の長さは違うので、同じ年収であったとしても、労働時間が短い人のほうがよりその報酬は高いと考えられるからだ。

### SSM2005の例

そこで、年収を1時間あたりの年収（時間給）に直し、それを分析に用いることがある。いま、2005年SSM調査のデータを持っているとする（数値は架空例）。

| Col1   | Col2                                                           |
|--------|----------------------------------------------------------------|
| q02f_w | 週あたり労働時間。無回答の場合には9という値が入っている。                                               |
| q02f_m | 月あたり労働時間（週の労働時間を回答している場合は回答しない）。無回答の場合には99という値が入っている。 |
| q02f_d | 1日の労働時間                                                  |
| q33a   | 個人年収を区間（単位：万円）で尋ねた項目                       |

```{r, echo = FALSE}
q02f_d <- c(8, 4, 10, 9, 12, 5)
q02f_w <- c(5, 4, 99, 99, 5, 1)
q02f_m <- c(99, 99, 20, 15, 99, 99)
q33a <- c(3, 5, 12, 9, 10, 4)
ssm <- tibble(q02f_d, q02f_w, q02f_m, q33a)
```

```{r}
ssm
```

このデータに対して以下のコードを実行することで、時間あたり賃金の変数wageを計算することができる。

```{r}
ssm <- ssm %>% 
  mutate(income = case_when(
    q33a ==  1 ~ 0,
    q33a ==  2 ~ 12.5,
    q33a ==  3 ~ 37.5,
    q33a ==  4 ~ 62.5,
    q33a ==  5 ~ 87.5,
    q33a ==  6 ~ 112.5,
    q33a ==  7 ~ 137.5,
    q33a ==  8 ~ 175,
    q33a ==  9 ~ 225,
    q33a == 10 ~ 275,
    q33a == 11 ~ 325,
    q33a == 12 ~ 375,
    q33a == 13 ~ 425,
    q33a == 14 ~ 500,
    q33a == 15 ~ 600,
    q33a == 16 ~ 700,
    q33a == 17 ~ 800,
    q33a == 18 ~ 900,
    q33a == 19 ~ 1000,
    q33a == 20 ~ 1100,
    q33a == 21 ~ 1200,
    q33a == 22 ~ 1300,
    q33a == 23 ~ 1400,
    q33a == 24 ~ 1500,
    q33a == 25 ~ 1600,
    q33a == 26 ~ 1700,
    q33a == 27 ~ 1800,
    q33a == 28 ~ 1900,
    q33a == 29 ~ 2000,
    q33a == 30 ~ 2050 * 1.4)) %>% 
  mutate(workhour = if_else(q02f_d < 98, q02f_d, NA_real_)) %>% 
  mutate(workmonth = case_when(
    q02f_m < 98 ~ q02f_m,
    (q02f_m == 98 | q02f_m == 99) & q02f_w < 8 ~ q02f_w * 4, 
    (q02f_m == 98 | q02f_m == 99) & (q02f_w == 8 | q02f_w == 9) ~ NA_real_
    )) %>% 
  mutate(wage = income * 10000 / (workhour * workmonth * 12))
```

```{r}
ssm
```

### 「〜万円以上」というカテゴリの処理

### 外れ値の処理

```{r, eval = FALSE, echo = FALSE}
ssm <- ssm %>% 
  mutate(wage = case_when(
    wage < 300 ~ NA_real_,
    wage > 10000 ~ NA_real_,
    300 <= wage & wage <= 10000 ~ wage
  )) 
```

