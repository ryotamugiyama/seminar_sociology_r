<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 4 データの加工 | Rによる社会調査データ分析の手引き</title>
  <meta name="description" content="This is the document for the class Seminar in Sociology held in Department of Political Studies, Gakushuin University. Anyone can freely use this as reference." />
  <meta name="generator" content="bookdown 0.43 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 4 データの加工 | Rによる社会調査データ分析の手引き" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="This is the document for the class Seminar in Sociology held in Department of Political Studies, Gakushuin University. Anyone can freely use this as reference." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 4 データの加工 | Rによる社会調査データ分析の手引き" />
  
  <meta name="twitter:description" content="This is the document for the class Seminar in Sociology held in Department of Political Studies, Gakushuin University. Anyone can freely use this as reference." />
  

<meta name="author" content="麦山 亮太（学習院大学法学部政治学科）/ Ryota Mugiyama (Department of Political Studies, Gakushuin University)" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="import.html"/>
<link rel="next" href="descriptives.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />


<style type="text/css">
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Rによる社会調査データ分析の手引き</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path=""><a href="#%E3%81%BE%E3%81%88%E3%81%8C%E3%81%8D"><i class="fa fa-check"></i>まえがき</a></li>
<li class="chapter" data-level="1" data-path="plan.html"><a href="plan.html"><i class="fa fa-check"></i><b>1</b> 研究計画を立てる</a>
<ul>
<li class="chapter" data-level="1.1" data-path="04-handling.html"><a href="#%E7%A0%94%E7%A9%B6%E8%A8%88%E7%94%BB%E3%81%A8%E3%81%AF"><i class="fa fa-check"></i><b>1.1</b> 研究計画とは</a></li>
<li class="chapter" data-level="1.2" data-path="04-handling.html"><a href="#%E7%A0%94%E7%A9%B6%E8%A8%88%E7%94%BB%E3%81%AE%E6%A7%8B%E6%88%90"><i class="fa fa-check"></i><b>1.2</b> 研究計画の構成</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="plan.html"><a href="plan.html#plan_background"><i class="fa fa-check"></i><b>1.2.1</b> 研究背景</a></li>
<li class="chapter" data-level="1.2.2" data-path="plan.html"><a href="plan.html#plan_question"><i class="fa fa-check"></i><b>1.2.2</b> 研究目的・問い</a></li>
<li class="chapter" data-level="1.2.3" data-path="plan.html"><a href="plan.html#plan_method"><i class="fa fa-check"></i><b>1.2.3</b> 方法</a></li>
<li class="chapter" data-level="1.2.4" data-path="plan.html"><a href="plan.html#plan_reference"><i class="fa fa-check"></i><b>1.2.4</b> 参考文献</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="04-handling.html"><a href="#%E4%BD%BF%E7%94%A8%E3%81%99%E3%82%8B%E8%AA%BF%E6%9F%BB%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AE%E9%81%B8%E5%AE%9A"><i class="fa fa-check"></i><b>1.3</b> 使用する調査データの選定</a>
<ul>
<li class="chapter" data-level="1.3.1" data-path="04-handling.html"><a href="#%E5%80%8B%E7%A5%A8%E3%83%87%E3%83%BC%E3%82%BF%E3%81%A8%E3%81%AF%E4%BD%95%E3%81%8B"><i class="fa fa-check"></i><b>1.3.1</b> 個票データとは何か</a></li>
<li class="chapter" data-level="1.3.2" data-path="plan.html"><a href="plan.html#jgss"><i class="fa fa-check"></i><b>1.3.2</b> JGSS</a></li>
<li class="chapter" data-level="1.3.3" data-path="04-handling.html"><a href="#jgss%E4%BB%A5%E5%A4%96%E3%81%AE%E6%97%A5%E6%9C%AC%E3%81%AE%E7%A4%BE%E4%BC%9A%E8%AA%BF%E6%9F%BB"><i class="fa fa-check"></i><b>1.3.3</b> JGSS以外の日本の社会調査</a></li>
<li class="chapter" data-level="1.3.4" data-path="04-handling.html"><a href="#%E6%97%A5%E6%9C%AC%E4%BB%A5%E5%A4%96%E3%81%AE%E7%A4%BE%E4%BC%9A%E8%AA%BF%E6%9F%BB%E3%83%87%E3%83%BC%E3%82%BF"><i class="fa fa-check"></i><b>1.3.4</b> 日本以外の社会調査データ</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="plan.html"><a href="plan.html#literature"><i class="fa fa-check"></i><b>1.4</b> 先行研究を探す</a>
<ul>
<li class="chapter" data-level="1.4.1" data-path="04-handling.html"><a href="#%E8%AB%96%E6%96%87"><i class="fa fa-check"></i><b>1.4.1</b> 論文</a></li>
<li class="chapter" data-level="1.4.2" data-path="04-handling.html"><a href="#%E6%9B%B8%E7%B1%8D"><i class="fa fa-check"></i><b>1.4.2</b> 書籍</a></li>
<li class="chapter" data-level="1.4.3" data-path="04-handling.html"><a href="#%E5%A0%B1%E5%91%8A%E6%9B%B8"><i class="fa fa-check"></i><b>1.4.3</b> 報告書</a></li>
<li class="chapter" data-level="1.4.4" data-path="04-handling.html"><a href="#%E7%A0%94%E7%A9%B6%E3%81%AE%E6%B5%81%E3%82%8C%E3%82%92%E3%81%A4%E3%81%8B%E3%82%80"><i class="fa fa-check"></i><b>1.4.4</b> 研究の流れをつかむ</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="preparation.html"><a href="preparation.html"><i class="fa fa-check"></i><b>2</b> RとRStudioの下準備</a>
<ul>
<li class="chapter" data-level="2.1" data-path="04-handling.html"><a href="#r%E3%81%A8rstudio%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB%E6%96%B9%E6%B3%95"><i class="fa fa-check"></i><b>2.1</b> RとRStudioのインストール方法</a></li>
<li class="chapter" data-level="2.2" data-path="04-handling.html"><a href="#%E3%83%87%E3%83%BC%E3%82%BF%E5%88%86%E6%9E%90%E3%81%AE%E3%83%AF%E3%83%BC%E3%82%AF%E3%83%95%E3%83%AD%E3%83%BC"><i class="fa fa-check"></i><b>2.2</b> データ分析のワークフロー</a></li>
<li class="chapter" data-level="2.3" data-path="preparation.html"><a href="preparation.html#preparation_project"><i class="fa fa-check"></i><b>2.3</b> プロジェクトの作成</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="04-handling.html"><a href="#rstudio%E3%82%92%E9%96%8B%E3%81%84%E3%81%A6%E3%81%BF%E3%82%88%E3%81%86"><i class="fa fa-check"></i><b>2.3.1</b> RStudioを開いてみよう</a></li>
<li class="chapter" data-level="2.3.2" data-path="04-handling.html"><a href="#%E6%8E%88%E6%A5%AD%E7%94%A8%E3%81%AE%E3%83%95%E3%82%A9%E3%83%AB%E3%83%80%E3%82%92%E4%BD%9C%E3%82%8D%E3%81%86"><i class="fa fa-check"></i><b>2.3.2</b> 授業用のフォルダを作ろう</a></li>
<li class="chapter" data-level="2.3.3" data-path="04-handling.html"><a href="#%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%83%91%E3%82%B9%E3%81%A8%E4%BD%9C%E6%A5%AD%E3%83%87%E3%82%A3%E3%83%AC%E3%82%AF%E3%83%88%E3%83%AA"><i class="fa fa-check"></i><b>2.3.3</b> ファイルパスと作業ディレクトリ</a></li>
<li class="chapter" data-level="2.3.4" data-path="04-handling.html"><a href="#%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E4%BD%9C%E6%88%90%E3%81%AE%E6%89%8B%E9%A0%86"><i class="fa fa-check"></i><b>2.3.4</b> プロジェクト作成の手順</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="04-handling.html"><a href="#%E5%9F%BA%E6%9C%AC%E7%9A%84%E3%81%AA%E6%93%8D%E4%BD%9C"><i class="fa fa-check"></i><b>2.4</b> 基本的な操作</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="04-handling.html"><a href="#%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%83%88%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB"><i class="fa fa-check"></i><b>2.4.1</b> スクリプトファイル</a></li>
<li class="chapter" data-level="2.4.2" data-path="04-handling.html"><a href="#%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%83%88%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%82%92%E4%BF%9D%E5%AD%98%E3%81%99%E3%82%8B"><i class="fa fa-check"></i><b>2.4.2</b> スクリプトファイルを保存する</a></li>
<li class="chapter" data-level="2.4.3" data-path="04-handling.html"><a href="#%E3%83%91%E3%83%83%E3%82%B1%E3%83%BC%E3%82%B8%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB"><i class="fa fa-check"></i><b>2.4.3</b> パッケージのインストール</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="04-handling.html"><a href="#%E3%81%9D%E3%81%AE%E4%BB%96%E3%81%AE%E8%A8%AD%E5%AE%9A"><i class="fa fa-check"></i><b>2.5</b> その他の設定</a>
<ul>
<li class="chapter" data-level="2.5.1" data-path="04-handling.html"><a href="#rstudio%E3%82%92%E9%96%89%E3%81%98%E3%82%8B%E9%9A%9B%E3%81%AEworkspace%E4%BF%9D%E5%AD%98%E3%81%AE%E8%AD%A6%E5%91%8A%E3%82%92%E5%89%8A%E9%99%A4"><i class="fa fa-check"></i><b>2.5.1</b> RStudioを閉じる際のWorkspace保存の警告を削除</a></li>
<li class="chapter" data-level="2.5.2" data-path="04-handling.html"><a href="#%E3%82%B0%E3%83%A9%E3%83%95%E3%81%AE%E6%97%A5%E6%9C%AC%E8%AA%9E%E8%A1%A8%E7%A4%BA"><i class="fa fa-check"></i><b>2.5.2</b> グラフの日本語表示</a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="04-handling.html"><a href="#r%E3%81%AE%E5%9F%BA%E7%A4%8E"><i class="fa fa-check"></i><b>2.6</b> Rの基礎</a></li>
<li class="chapter" data-level="2.7" data-path="04-handling.html"><a href="#%E3%82%A8%E3%83%A9%E3%83%BC%E3%81%8C%E5%87%BA%E3%81%9F%E3%81%A8%E3%81%8D%E3%81%AB%E7%A2%BA%E8%AA%8D%E3%81%99%E3%82%8B%E7%AE%87%E6%89%80"><i class="fa fa-check"></i><b>2.7</b> エラーが出たときに確認する箇所</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="import.html"><a href="import.html"><i class="fa fa-check"></i><b>3</b> データの読み込み</a>
<ul>
<li class="chapter" data-level="3.1" data-path="04-handling.html"><a href="#r%E3%81%AE%E3%82%B5%E3%83%B3%E3%83%97%E3%83%AB%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AE%E8%AA%AD%E3%81%BF%E8%BE%BC%E3%81%BF"><i class="fa fa-check"></i><b>3.1</b> Rのサンプルデータの読み込み</a></li>
<li class="chapter" data-level="3.2" data-path="04-handling.html"><a href="#%E4%BD%9C%E6%A5%AD%E3%83%87%E3%82%A3%E3%83%AC%E3%82%AF%E3%83%88%E3%83%AA%E4%B8%8A%E3%81%AE%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AE%E8%AA%AD%E3%81%BF%E8%BE%BC%E3%81%BF"><i class="fa fa-check"></i><b>3.2</b> 作業ディレクトリ上のデータの読み込み</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="import.html"><a href="import.html#import_dir"><i class="fa fa-check"></i><b>3.2.1</b> データを置く場所を作る</a></li>
<li class="chapter" data-level="3.2.2" data-path="04-handling.html"><a href="#csv%E5%BD%A2%E5%BC%8F%E3%81%AE%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB"><i class="fa fa-check"></i><b>3.2.2</b> csv形式のファイル</a></li>
<li class="chapter" data-level="3.2.3" data-path="04-handling.html"><a href="#xlsx%E5%BD%A2%E5%BC%8F%E3%81%AE%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB"><i class="fa fa-check"></i><b>3.2.3</b> xlsx形式のファイル</a></li>
<li class="chapter" data-level="3.2.4" data-path="import.html"><a href="import.html#import_rds"><i class="fa fa-check"></i><b>3.2.4</b> rds形式のファイル</a></li>
<li class="chapter" data-level="3.2.5" data-path="04-handling.html"><a href="#sav%E5%BD%A2%E5%BC%8F%E3%81%AE%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB"><i class="fa fa-check"></i><b>3.2.5</b> sav形式のファイル</a></li>
<li class="chapter" data-level="3.2.6" data-path="04-handling.html"><a href="#dta%E5%BD%A2%E5%BC%8F%E3%81%AE%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB"><i class="fa fa-check"></i><b>3.2.6</b> dta形式のファイル</a></li>
<li class="chapter" data-level="3.2.7" data-path="04-handling.html"><a href="#%E6%96%87%E5%AD%97%E3%82%B3%E3%83%BC%E3%83%89%E3%81%AB%E9%96%A2%E3%82%8F%E3%82%8B%E5%95%8F%E9%A1%8C"><i class="fa fa-check"></i><b>3.2.7</b> 文字コードに関わる問題</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="04-handling.html"><a href="#%E3%82%A6%E3%82%A7%E3%83%96%E4%B8%8A%E3%81%AE%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AE%E8%AA%AD%E3%81%BF%E8%BE%BC%E3%81%BF"><i class="fa fa-check"></i><b>3.3</b> ウェブ上のデータの読み込み</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="handling.html"><a href="handling.html"><i class="fa fa-check"></i><b>4</b> データの加工</a>
<ul>
<li class="chapter" data-level="4.1" data-path="04-handling.html"><a href="#%E6%9C%AC%E8%B3%87%E6%96%99%E3%81%A7%E7%94%A8%E3%81%84%E3%82%8B%E3%83%87%E3%83%BC%E3%82%BF"><i class="fa fa-check"></i><b>4.1</b> 本資料で用いるデータ</a></li>
<li class="chapter" data-level="4.2" data-path="04-handling.html"><a href="#%E3%83%91%E3%82%A4%E3%83%97%E6%BC%94%E7%AE%97%E5%AD%90%E3%81%BE%E3%81%9F%E3%81%AF"><i class="fa fa-check"></i><b>4.2</b> パイプ演算子：%&gt;%または|&gt;</a></li>
<li class="chapter" data-level="4.3" data-path="04-handling.html"><a href="#%E3%83%87%E3%83%BC%E3%82%BF%E5%8A%A0%E5%B7%A5%E3%81%AE%E3%82%B9%E3%83%86%E3%83%83%E3%83%97"><i class="fa fa-check"></i><b>4.3</b> データ加工のステップ</a></li>
<li class="chapter" data-level="4.4" data-path="04-handling.html"><a href="#%E5%A4%89%E6%95%B0%E3%81%AE%E4%BD%9C%E6%88%90"><i class="fa fa-check"></i><b>4.4</b> 変数の作成</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="04-handling.html"><a href="#%E5%A4%89%E6%95%B0%E3%81%AE%E5%9E%8B%E3%82%AB%E3%83%86%E3%82%B4%E3%83%AA%E5%A4%89%E6%95%B0%E3%81%A8%E9%80%A3%E7%B6%9A%E5%A4%89%E6%95%B0"><i class="fa fa-check"></i><b>4.4.1</b> 変数の型（カテゴリ変数と連続変数）</a></li>
<li class="chapter" data-level="4.4.2" data-path="04-handling.html"><a href="#%E6%96%B0%E3%81%9F%E3%81%AA%E5%A4%89%E6%95%B0%E3%82%92%E3%81%A4%E3%81%8F%E3%82%8Bmutate"><i class="fa fa-check"></i><b>4.4.2</b> 新たな変数をつくる：mutate()</a></li>
<li class="chapter" data-level="4.4.3" data-path="04-handling.html"><a href="#%E6%9D%A1%E4%BB%B6%E3%81%AE%E6%8C%87%E5%AE%9Aif_else"><i class="fa fa-check"></i><b>4.4.3</b> 条件の指定：if_else()</a></li>
<li class="chapter" data-level="4.4.4" data-path="04-handling.html"><a href="#%E8%A4%87%E6%95%B0%E6%9D%A1%E4%BB%B6%E3%81%AE%E6%8C%87%E5%AE%9Acase_when"><i class="fa fa-check"></i><b>4.4.4</b> 複数条件の指定：case_when()</a></li>
<li class="chapter" data-level="4.4.5" data-path="04-handling.html"><a href="#%E3%82%AB%E3%83%86%E3%82%B4%E3%83%AA%E5%A4%89%E6%95%B0%E3%81%B8%E5%A4%89%E6%8F%9Bfactor"><i class="fa fa-check"></i><b>4.4.5</b> カテゴリ変数へ変換：factor()</a></li>
<li class="chapter" data-level="4.4.6" data-path="04-handling.html"><a href="#%E5%BF%85%E8%A6%81%E3%81%AA%E5%88%97%E3%81%AE%E3%81%BF%E6%8A%BD%E5%87%BAselect"><i class="fa fa-check"></i><b>4.4.6</b> 必要な列のみ抽出：select()</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="handling.html"><a href="handling.html#handling-tips"><i class="fa fa-check"></i><b>4.5</b> 変数の作成についてのtips</a>
<ul>
<li class="chapter" data-level="4.5.1" data-path="04-handling.html"><a href="#%E3%82%AB%E3%83%86%E3%82%B4%E3%83%AA%E3%82%92%E3%81%BE%E3%81%A8%E3%82%81%E3%82%8B"><i class="fa fa-check"></i><b>4.5.1</b> カテゴリをまとめる</a></li>
<li class="chapter" data-level="4.5.2" data-path="04-handling.html"><a href="#%E8%A4%87%E6%95%B0%E3%81%AE%E5%A4%89%E6%95%B0%E3%82%92%E7%B5%84%E3%81%BF%E5%90%88%E3%82%8F%E3%81%9B%E3%81%9F%E5%A4%89%E6%95%B0%E3%82%92%E4%BD%9C%E3%82%8B"><i class="fa fa-check"></i><b>4.5.2</b> 複数の変数を組み合わせた変数を作る</a></li>
<li class="chapter" data-level="4.5.3" data-path="04-handling.html"><a href="#%E5%9D%87%E7%AD%89%E3%81%AA%E9%A0%86%E5%BA%8F%E3%82%92%E4%BB%AE%E5%AE%9A%E3%81%97%E3%81%A6%E9%80%A3%E7%B6%9A%E5%A4%89%E6%95%B0%E3%81%A8%E3%81%99%E3%82%8B"><i class="fa fa-check"></i><b>4.5.3</b> 均等な順序を仮定して連続変数とする</a></li>
<li class="chapter" data-level="4.5.4" data-path="04-handling.html"><a href="#%E7%84%A1%E5%9B%9E%E7%AD%94%E9%9D%9E%E8%A9%B2%E5%BD%93%E3%82%8F%E3%81%8B%E3%82%89%E3%81%AA%E3%81%84%E3%81%AA%E3%81%A9%E3%82%92na%E3%81%AB"><i class="fa fa-check"></i><b>4.5.4</b> 無回答、非該当、「わからない」などをNAに</a></li>
<li class="chapter" data-level="4.5.5" data-path="04-handling.html"><a href="#%E3%82%AB%E3%83%86%E3%82%B4%E3%83%AA%E5%A4%89%E6%95%B0%E3%81%AE%E5%8C%BA%E9%96%93%E3%81%AE%E4%B8%AD%E7%82%B9%E3%82%92%E3%81%A8%E3%81%A3%E3%81%A6%E9%80%A3%E7%B6%9A%E5%A4%89%E6%95%B0%E3%81%A8%E3%81%99%E3%82%8B"><i class="fa fa-check"></i><b>4.5.5</b> カテゴリ変数の区間の中点をとって連続変数とする</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="04-handling.html"><a href="#%E3%82%92%E3%81%A4%E3%81%AA%E3%81%92%E3%81%A6%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89%E3%82%92%E3%81%BE%E3%81%A8%E3%82%81%E3%82%8B"><i class="fa fa-check"></i><b>4.6</b> %&gt;%をつなげてコマンドをまとめる</a></li>
<li class="chapter" data-level="4.7" data-path="handling.html"><a href="handling.html#handling_sample"><i class="fa fa-check"></i><b>4.7</b> サンプルの限定</a>
<ul>
<li class="chapter" data-level="4.7.1" data-path="04-handling.html"><a href="#%E8%A9%B2%E5%BD%93%E3%81%99%E3%82%8B%E3%82%B1%E3%83%BC%E3%82%B9%E3%81%A0%E3%81%91%E3%82%92%E6%AE%8B%E3%81%99filter"><i class="fa fa-check"></i><b>4.7.1</b> 該当するケースだけを残す：filter()</a></li>
<li class="chapter" data-level="4.7.2" data-path="04-handling.html"><a href="#%E6%AC%A0%E6%90%8D%E5%80%A4%E3%81%AE%E6%89%B1%E3%81%84"><i class="fa fa-check"></i><b>4.7.2</b> 欠損値の扱い</a></li>
<li class="chapter" data-level="4.7.3" data-path="04-handling.html"><a href="#%E5%A4%96%E3%82%8C%E5%80%A4%E3%81%AE%E6%89%B1%E3%81%84"><i class="fa fa-check"></i><b>4.7.3</b> 外れ値の扱い</a></li>
<li class="chapter" data-level="4.7.4" data-path="04-handling.html"><a href="#%E5%88%86%E6%9E%90%E7%94%A8%E3%83%87%E3%83%BC%E3%82%BF%E3%82%92%E6%9B%B8%E3%81%8D%E5%87%BA%E3%81%99"><i class="fa fa-check"></i><b>4.7.4</b> 分析用データを書き出す</a></li>
</ul></li>
<li class="chapter" data-level="4.8" data-path="04-handling.html"><a href="#%E7%99%BA%E5%B1%95%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AE%E8%BF%BD%E5%8A%A0"><i class="fa fa-check"></i><b>4.8</b> 【発展】データの追加</a></li>
<li class="chapter" data-level="4.9" data-path="04-handling.html"><a href="#%E6%BC%94%E7%BF%92%E5%95%8F%E9%A1%8C"><i class="fa fa-check"></i><b>4.9</b> 演習問題</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="descriptives.html"><a href="descriptives.html"><i class="fa fa-check"></i><b>5</b> 1変数の集計</a>
<ul>
<li class="chapter" data-level="5.1" data-path="04-handling.html"><a href="#%E9%80%A3%E7%B6%9A%E5%A4%89%E6%95%B0%E3%82%92%E9%9B%86%E8%A8%88%E3%81%99%E3%82%8B"><i class="fa fa-check"></i><b>5.1</b> 連続変数を集計する</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="descriptives.html"><a href="descriptives.html#descriptives_summarize"><i class="fa fa-check"></i><b>5.1.1</b> 要約統計量の計算</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="descriptives.html"><a href="descriptives.html#descriptives_ggplot"><i class="fa fa-check"></i><b>5.2</b> 分布をみる</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="04-handling.html"><a href="#%E3%83%92%E3%82%B9%E3%83%88%E3%82%B0%E3%83%A9%E3%83%A0%E3%81%A8ggplot%E3%81%AE%E5%B0%8E%E5%85%A5"><i class="fa fa-check"></i><b>5.2.1</b> ヒストグラムとggplotの導入</a></li>
<li class="chapter" data-level="5.2.2" data-path="04-handling.html"><a href="#ggplot%E3%81%AE%E8%A8%AD%E5%AE%9A%E6%97%A5%E6%9C%AC%E8%AA%9E%E9%96%A2%E4%BF%82"><i class="fa fa-check"></i><b>5.2.2</b> ggplotの設定（日本語関係）</a></li>
<li class="chapter" data-level="5.2.3" data-path="04-handling.html"><a href="#%E8%BB%B8%E3%81%AB%E5%90%8D%E5%89%8D%E3%82%92%E3%81%A4%E3%81%91%E3%82%8B"><i class="fa fa-check"></i><b>5.2.3</b> 軸に名前をつける</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="04-handling.html"><a href="#%E3%82%AB%E3%83%86%E3%82%B4%E3%83%AA%E5%A4%89%E6%95%B0%E3%82%92%E9%9B%86%E8%A8%88%E3%81%99%E3%82%8B"><i class="fa fa-check"></i><b>5.3</b> カテゴリ変数を集計する</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="descriptives.html"><a href="descriptives.html#descriptives_table"><i class="fa fa-check"></i><b>5.3.1</b> 度数の確認</a></li>
<li class="chapter" data-level="5.3.2" data-path="04-handling.html"><a href="#%E5%88%86%E5%B8%83%E3%81%AE%E5%8F%AF%E8%A6%96%E5%8C%96%E6%A3%92%E3%82%B0%E3%83%A9%E3%83%95"><i class="fa fa-check"></i><b>5.3.2</b> 分布の可視化：棒グラフ</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="descriptives.html"><a href="descriptives.html#descriptives_gtsummary"><i class="fa fa-check"></i><b>5.4</b> 記述統計量の一覧表を作る</a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="04-handling.html"><a href="#%E8%A8%98%E8%BF%B0%E7%B5%B1%E8%A8%88%E9%87%8F%E3%81%AE%E4%B8%80%E8%A6%A7%E8%A1%A8"><i class="fa fa-check"></i><b>5.4.1</b> 記述統計量の一覧表</a></li>
<li class="chapter" data-level="5.4.2" data-path="04-handling.html"><a href="#%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97%E5%88%A5%E3%81%AE%E8%A8%98%E8%BF%B0%E7%B5%B1%E8%A8%88%E9%87%8F%E3%81%AE%E4%B8%80%E8%A6%A7%E8%A1%A8"><i class="fa fa-check"></i><b>5.4.2</b> グループ別の記述統計量の一覧表</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="04-handling.html"><a href="#%E7%B5%90%E6%9E%9C%E3%82%92%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%AB%E6%9B%B8%E3%81%8D%E5%87%BA%E3%81%99"><i class="fa fa-check"></i><b>5.5</b> 結果をファイルに書き出す</a>
<ul>
<li class="chapter" data-level="5.5.1" data-path="04-handling.html"><a href="#%E7%B5%90%E6%9E%9C%E3%82%92%E5%85%A5%E3%82%8C%E3%82%8B%E3%81%9F%E3%82%81%E3%81%AE%E3%83%95%E3%82%A9%E3%83%AB%E3%83%80%E3%82%92%E4%BD%9C%E3%82%8B"><i class="fa fa-check"></i><b>5.5.1</b> 結果を入れるためのフォルダを作る</a></li>
<li class="chapter" data-level="5.5.2" data-path="descriptives.html"><a href="descriptives.html#descriptive_export_ggplot"><i class="fa fa-check"></i><b>5.5.2</b> ggplotで作成した図を書き出す</a></li>
<li class="chapter" data-level="5.5.3" data-path="descriptives.html"><a href="descriptives.html#descriptive_export_tbl_summary"><i class="fa fa-check"></i><b>5.5.3</b> 記述統計の一覧表をwordに書き出す</a></li>
</ul></li>
<li class="chapter" data-level="5.6" data-path="04-handling.html"><a href="#tbl_summary%E3%81%A7%E5%80%A4%E3%81%AE%E5%B0%91%E3%81%AA%E3%81%84%E9%80%A3%E7%B6%9A%E5%A4%89%E6%95%B0%E3%81%8C%E3%82%AB%E3%83%86%E3%82%B4%E3%83%AA%E5%A4%89%E6%95%B0%E3%81%A8%E3%81%97%E3%81%A6%E9%9B%86%E8%A8%88%E3%81%95%E3%82%8C%E3%82%8B%E5%95%8F%E9%A1%8C%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6"><i class="fa fa-check"></i><b>5.6</b> tbl_summary()で値の少ない連続変数がカテゴリ変数として集計される問題について</a></li>
<li class="chapter" data-level="5.7" data-path="04-handling.html"><a href="#%E7%B7%B4%E7%BF%92%E5%95%8F%E9%A1%8C"><i class="fa fa-check"></i><b>5.7</b> 練習問題</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="tabulate.html"><a href="tabulate.html"><i class="fa fa-check"></i><b>6</b> 2変数の集計</a>
<ul>
<li class="chapter" data-level="6.1" data-path="tabulate.html"><a href="tabulate.html#tabulate_summarize"><i class="fa fa-check"></i><b>6.1</b> 平均値の比較</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="04-handling.html"><a href="#%E5%9F%BA%E6%9C%AC"><i class="fa fa-check"></i><b>6.1.1</b> 基本</a></li>
<li class="chapter" data-level="6.1.2" data-path="04-handling.html"><a href="#%E6%A3%92%E3%82%B0%E3%83%A9%E3%83%95%E3%81%AB%E3%82%88%E3%82%8B%E5%8F%AF%E8%A6%96%E5%8C%96"><i class="fa fa-check"></i><b>6.1.2</b> 棒グラフによる可視化</a></li>
<li class="chapter" data-level="6.1.3" data-path="04-handling.html"><a href="#%E8%A4%87%E6%95%B0%E3%82%AB%E3%83%86%E3%82%B4%E3%83%AA%E3%81%AE%E7%B5%84%E3%81%BF%E5%90%88%E3%82%8F%E3%81%9B"><i class="fa fa-check"></i><b>6.1.3</b> 複数カテゴリの組み合わせ</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="tabulate.html"><a href="tabulate.html#tabulate_distribution"><i class="fa fa-check"></i><b>6.2</b> 分布の比較</a></li>
<li class="chapter" data-level="6.3" data-path="tabulate.html"><a href="tabulate.html#cross_tabulation"><i class="fa fa-check"></i><b>6.3</b> クロス表</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="04-handling.html"><a href="#%E5%9F%BA%E6%9C%AC-1"><i class="fa fa-check"></i><b>6.3.1</b> 基本</a></li>
<li class="chapter" data-level="6.3.2" data-path="04-handling.html"><a href="#%E3%82%AB%E3%82%A42%E4%B9%97%E6%A4%9C%E5%AE%9A%E8%A3%9C%E8%B6%B3"><i class="fa fa-check"></i><b>6.3.2</b> カイ2乗検定（補足）</a></li>
<li class="chapter" data-level="6.3.3" data-path="04-handling.html"><a href="#%E3%81%8D%E3%82%8C%E3%81%84%E3%81%AA%E3%82%AF%E3%83%AD%E3%82%B9%E8%A1%A8%E3%82%92%E3%81%A4%E3%81%8F%E3%82%8B---gtsummarytbl_cross"><i class="fa fa-check"></i><b>6.3.3</b> きれいなクロス表をつくる - gtsummary::tbl_cross()</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="04-handling.html"><a href="#%E3%82%AF%E3%83%AD%E3%82%B9%E8%A1%A8%E3%82%92%E5%9B%B3%E7%A4%BA%E3%81%99%E3%82%8B"><i class="fa fa-check"></i><b>6.4</b> クロス表を図示する</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="04-handling.html"><a href="#count%E3%82%92%E5%88%A9%E7%94%A8%E3%81%99%E3%82%8B"><i class="fa fa-check"></i><b>6.4.1</b> count()を利用する</a></li>
<li class="chapter" data-level="6.4.2" data-path="04-handling.html"><a href="#count%E3%81%AE%E6%B3%A8%E6%84%8F%E7%82%B9"><i class="fa fa-check"></i><b>6.4.2</b> count()の注意点</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="tabulate.html"><a href="tabulate.html#scatterplot"><i class="fa fa-check"></i><b>6.5</b> 散布図</a>
<ul>
<li class="chapter" data-level="6.5.1" data-path="04-handling.html"><a href="#%E6%95%A3%E5%B8%83%E5%9B%B3%E3%82%92%E3%81%BF%E3%82%8B"><i class="fa fa-check"></i><b>6.5.1</b> 散布図をみる</a></li>
<li class="chapter" data-level="6.5.2" data-path="04-handling.html"><a href="#%E3%82%AB%E3%83%86%E3%82%B4%E3%83%AA%E3%81%94%E3%81%A8%E3%81%AB%E6%95%A3%E5%B8%83%E5%9B%B3%E3%82%92%E5%88%86%E3%81%91%E3%82%8B"><i class="fa fa-check"></i><b>6.5.2</b> カテゴリごとに散布図を分ける</a></li>
<li class="chapter" data-level="6.5.3" data-path="04-handling.html"><a href="#%E7%9B%B8%E9%96%A2%E4%BF%82%E6%95%B0"><i class="fa fa-check"></i><b>6.5.3</b> 相関係数</a></li>
</ul></li>
<li class="chapter" data-level="6.6" data-path="04-handling.html"><a href="#%E5%A4%89%E6%95%B0%E9%9B%86%E8%A8%88%E3%81%AE%E3%81%A8%E3%81%8D%E3%81%AE%E3%81%8F%E3%81%B5%E3%81%86"><i class="fa fa-check"></i><b>6.6</b> 2変数集計のときのくふう</a>
<ul>
<li class="chapter" data-level="6.6.1" data-path="04-handling.html"><a href="#%E5%80%A4%E3%81%8C%E7%B2%97%E3%81%84%E9%80%A3%E7%B6%9A%E5%A4%89%E6%95%B0%E3%82%92%E6%89%B1%E3%81%86"><i class="fa fa-check"></i><b>6.6.1</b> 値が粗い連続変数を扱う</a></li>
<li class="chapter" data-level="6.6.2" data-path="04-handling.html"><a href="#%E3%82%AB%E3%83%86%E3%82%B4%E3%83%AA%E3%81%8C%E5%A4%9A%E3%81%84%E3%82%AF%E3%83%AD%E3%82%B9%E8%A1%A8%E3%82%92%E6%89%B1%E3%81%86"><i class="fa fa-check"></i><b>6.6.2</b> カテゴリが多いクロス表を扱う</a></li>
</ul></li>
<li class="chapter" data-level="6.7" data-path="04-handling.html"><a href="#%E7%B5%90%E6%9E%9C%E3%82%92%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%AB%E6%9B%B8%E3%81%8D%E5%87%BA%E3%81%99-1"><i class="fa fa-check"></i><b>6.7</b> 結果をファイルに書き出す</a>
<ul>
<li class="chapter" data-level="6.7.1" data-path="04-handling.html"><a href="#ggplot%E3%81%A7%E4%BD%9C%E6%88%90%E3%81%97%E3%81%9F%E5%9B%B3%E3%82%92%E6%9B%B8%E3%81%8D%E5%87%BA%E3%81%99"><i class="fa fa-check"></i><b>6.7.1</b> ggplotで作成した図を書き出す</a></li>
<li class="chapter" data-level="6.7.2" data-path="04-handling.html"><a href="#%E3%82%AF%E3%83%AD%E3%82%B9%E8%A1%A8%E3%82%92word%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%AB%E6%9B%B8%E3%81%8D%E5%87%BA%E3%81%99"><i class="fa fa-check"></i><b>6.7.2</b> クロス表をwordファイルに書き出す</a></li>
</ul></li>
<li class="chapter" data-level="6.8" data-path="04-handling.html"><a href="#%E7%B7%B4%E7%BF%92%E5%95%8F%E9%A1%8C-1"><i class="fa fa-check"></i><b>6.8</b> 練習問題</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="regression_basic.html"><a href="regression_basic.html"><i class="fa fa-check"></i><b>7</b> 回帰分析の基礎</a>
<ul>
<li class="chapter" data-level="7.1" data-path="04-handling.html"><a href="#%E5%9B%9E%E5%B8%B0%E5%88%86%E6%9E%90%E3%81%A8%E3%81%AF%E4%BD%95%E3%81%8B"><i class="fa fa-check"></i><b>7.1</b> 回帰分析とは何か</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="04-handling.html"><a href="#%E6%95%A3%E5%B8%83%E5%9B%B3%E3%82%92%E7%9C%BA%E3%82%81%E3%82%8B"><i class="fa fa-check"></i><b>7.1.1</b> 散布図を眺める</a></li>
<li class="chapter" data-level="7.1.2" data-path="04-handling.html"><a href="#%E5%9B%9E%E5%B8%B0%E5%BC%8F%E3%81%AE%E8%AA%AD%E3%81%BF%E6%96%B9"><i class="fa fa-check"></i><b>7.1.2</b> 回帰式の読み方</a></li>
<li class="chapter" data-level="7.1.3" data-path="regression_basic.html"><a href="regression_basic.html#ordinaryleastsquare"><i class="fa fa-check"></i><b>7.1.3</b> 回帰式の決め方：最小二乗法</a></li>
<li class="chapter" data-level="7.1.4" data-path="04-handling.html"><a href="#%E6%AF%8D%E9%9B%86%E5%9B%A3%E3%81%AB%E3%81%8A%E3%81%91%E3%82%8B%E9%96%A2%E4%BF%82%E3%81%AE%E6%8E%A8%E6%B8%AC"><i class="fa fa-check"></i><b>7.1.4</b> 母集団における関係の推測</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="04-handling.html"><a href="#%E7%8B%AC%E7%AB%8B%E5%A4%89%E6%95%B0%E3%81%8C%E3%82%AB%E3%83%86%E3%82%B4%E3%83%AA%E5%A4%89%E6%95%B0%E3%81%AE%E5%A0%B4%E5%90%88"><i class="fa fa-check"></i><b>7.2</b> 独立変数がカテゴリ変数の場合</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="04-handling.html"><a href="#%E5%80%A4%E3%81%AE%E3%82%AB%E3%83%86%E3%82%B4%E3%83%AA"><i class="fa fa-check"></i><b>7.2.1</b> 2値のカテゴリ</a></li>
<li class="chapter" data-level="7.2.2" data-path="04-handling.html"><a href="#%E5%80%A4%E4%BB%A5%E4%B8%8A%E3%81%AE%E3%82%AB%E3%83%86%E3%82%B4%E3%83%AA"><i class="fa fa-check"></i><b>7.2.2</b> 3値以上のカテゴリ</a></li>
<li class="chapter" data-level="7.2.3" data-path="04-handling.html"><a href="#%E5%A4%89%E6%95%B0%E3%81%8Cfactor%E3%81%A7%E3%81%82%E3%82%8C%E3%81%B0%E8%87%AA%E5%8B%95%E3%81%A7%E3%82%AB%E3%83%86%E3%82%B4%E3%83%AA%E3%81%A8%E3%81%97%E3%81%A6%E6%8A%95%E5%85%A5%E3%81%95%E3%82%8C%E3%82%8B"><i class="fa fa-check"></i><b>7.2.3</b> 変数がfactorであれば自動でカテゴリとして投入される</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="regression_basic.html"><a href="regression_basic.html#regression_basic_binary"><i class="fa fa-check"></i><b>7.3</b> 従属変数が2値のカテゴリ変数（0/1）の場合</a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="04-handling.html"><a href="#%E3%82%AF%E3%83%AD%E3%82%B9%E8%A1%A8%E3%81%A8%E6%AF%94%E8%BC%83%E3%81%97%E3%81%AA%E3%81%8C%E3%82%89%E7%B5%90%E6%9E%9C%E3%82%92%E3%81%BF%E3%82%8B"><i class="fa fa-check"></i><b>7.3.1</b> クロス表と比較しながら結果をみる</a></li>
<li class="chapter" data-level="7.3.2" data-path="04-handling.html"><a href="#%E6%95%A3%E5%B8%83%E5%9B%B3%E3%81%A8%E6%AF%94%E8%BC%83%E3%81%97%E3%81%AA%E3%81%8C%E3%82%89%E7%B5%90%E6%9E%9C%E3%82%92%E3%81%BF%E3%82%8B"><i class="fa fa-check"></i><b>7.3.2</b> 散布図と比較しながら結果をみる</a></li>
<li class="chapter" data-level="7.3.3" data-path="04-handling.html"><a href="#%E6%B3%A8%E6%84%8F%E7%82%B9"><i class="fa fa-check"></i><b>7.3.3</b> 注意点</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="regression_basic.html"><a href="regression_basic.html#regression_basic_log"><i class="fa fa-check"></i><b>7.4</b> 非線形の関連：対数変換</a>
<ul>
<li class="chapter" data-level="7.4.1" data-path="04-handling.html"><a href="#%E5%AF%BE%E6%95%B0%E5%A4%89%E6%8F%9B%E3%81%A8%E3%81%AF"><i class="fa fa-check"></i><b>7.4.1</b> 対数変換とは</a></li>
<li class="chapter" data-level="7.4.2" data-path="04-handling.html"><a href="#%E8%87%AA%E7%84%B6%E5%AF%BE%E6%95%B0%E3%81%A8%E5%AF%BE%E6%95%B0%E9%96%A2%E6%95%B0%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6"><i class="fa fa-check"></i><b>7.4.2</b> 自然対数と対数関数について</a></li>
<li class="chapter" data-level="7.4.3" data-path="04-handling.html"><a href="#%E5%AF%BE%E6%95%B0%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%9F%E5%A0%B4%E5%90%88%E3%81%AE%E5%9B%9E%E5%B8%B0%E5%88%86%E6%9E%90"><i class="fa fa-check"></i><b>7.4.3</b> 対数を使った場合の回帰分析</a></li>
<li class="chapter" data-level="7.4.4" data-path="04-handling.html"><a href="#%E5%BE%93%E5%B1%9E%E5%A4%89%E6%95%B0%E3%81%AE%E5%AF%BE%E6%95%B0%E3%82%92%E5%8F%96%E3%81%A3%E3%81%9F%E3%81%A8%E3%81%8D%E3%81%AE%E7%B5%90%E6%9E%9C%E3%81%AE%E8%A7%A3%E9%87%88"><i class="fa fa-check"></i><b>7.4.4</b> 従属変数の対数を取ったときの結果の解釈</a></li>
<li class="chapter" data-level="7.4.5" data-path="04-handling.html"><a href="#%E5%BE%93%E5%B1%9E%E5%A4%89%E6%95%B0%E3%81%BE%E3%81%9F%E3%81%AF%E7%8B%AC%E7%AB%8B%E5%A4%89%E6%95%B0%E3%82%92%E5%AF%BE%E6%95%B0%E5%A4%89%E6%8F%9B%E3%81%97%E3%81%9F%E3%81%A8%E3%81%8D%E3%81%AE%E8%A7%A3%E9%87%88"><i class="fa fa-check"></i><b>7.4.5</b> 従属変数または独立変数を対数変換したときの解釈</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="regression_basic.html"><a href="regression_basic.html#regression_basic_quadratic"><i class="fa fa-check"></i><b>7.5</b> 非線形の関連：二次曲線型</a>
<ul>
<li class="chapter" data-level="7.5.1" data-path="04-handling.html"><a href="#%E4%BA%8C%E6%AC%A1%E6%9B%B2%E7%B7%9A%E3%81%A8%E3%81%AF"><i class="fa fa-check"></i><b>7.5.1</b> 二次曲線とは</a></li>
<li class="chapter" data-level="7.5.2" data-path="04-handling.html"><a href="#%E5%A4%89%E6%95%B0%E3%81%AE%E4%BD%9C%E6%88%90%E3%81%A8%E7%B5%90%E6%9E%9C%E3%81%AE%E8%A7%A3%E9%87%88"><i class="fa fa-check"></i><b>7.5.2</b> 変数の作成と結果の解釈</a></li>
<li class="chapter" data-level="7.5.3" data-path="04-handling.html"><a href="#%E3%83%A2%E3%83%87%E3%83%AB%E9%81%B8%E6%8A%9E%E3%81%A8f%E6%A4%9C%E5%AE%9A"><i class="fa fa-check"></i><b>7.5.3</b> モデル選択とF検定</a></li>
</ul></li>
<li class="chapter" data-level="7.6" data-path="regression_basic.html"><a href="regression_basic.html#regression_modelsummary"><i class="fa fa-check"></i><b>7.6</b> 回帰分析の結果をきれいに表示する</a></li>
<li class="chapter" data-level="7.7" data-path="regression_basic.html"><a href="regression_basic.html#regression_basic_export"><i class="fa fa-check"></i><b>7.7</b> 結果をファイルに書き出す</a>
<ul>
<li class="chapter" data-level="7.7.1" data-path="04-handling.html"><a href="#word%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%AB%E6%9B%B8%E3%81%8D%E5%87%BA%E3%81%99"><i class="fa fa-check"></i><b>7.7.1</b> Wordファイルに書き出す</a></li>
<li class="chapter" data-level="7.7.2" data-path="regression_basic.html"><a href="regression_basic.html#regression_output_pptx"><i class="fa fa-check"></i><b>7.7.2</b> PowerPointファイルに書き出す</a></li>
</ul></li>
<li class="chapter" data-level="7.8" data-path="04-handling.html"><a href="#%E7%B7%B4%E7%BF%92%E5%95%8F%E9%A1%8C-2"><i class="fa fa-check"></i><b>7.8</b> 練習問題</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="regression_advanced.html"><a href="regression_advanced.html"><i class="fa fa-check"></i><b>8</b> 回帰分析の活用</a>
<ul>
<li class="chapter" data-level="8.1" data-path="04-handling.html"><a href="#%E9%87%8D%E5%9B%9E%E5%B8%B0%E5%88%86%E6%9E%90"><i class="fa fa-check"></i><b>8.1</b> 重回帰分析</a></li>
<li class="chapter" data-level="8.2" data-path="04-handling.html"><a href="#%E4%BA%A4%E7%B5%A1%E8%A6%81%E5%9B%A0%E3%81%AE%E7%B5%B1%E5%88%B6"><i class="fa fa-check"></i><b>8.2</b> 交絡要因の統制</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="04-handling.html"><a href="#%E4%BA%A4%E7%B5%A1%E3%81%A8%E3%81%AF%E4%BD%95%E3%81%8B"><i class="fa fa-check"></i><b>8.2.1</b> 交絡とは何か</a></li>
<li class="chapter" data-level="8.2.2" data-path="04-handling.html"><a href="#%E7%B5%90%E6%9E%9C%E3%81%AE%E6%AF%94%E8%BC%83%E3%81%A8%E8%A7%A3%E9%87%88"><i class="fa fa-check"></i><b>8.2.2</b> 結果の比較と解釈</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="04-handling.html"><a href="#%E7%B5%B1%E5%88%B6%E5%A4%89%E6%95%B0%E3%81%AB%E3%81%AF%E4%BD%95%E3%82%92%E5%90%AB%E3%82%81%E3%82%8B%E3%81%B9%E3%81%8D%E3%81%8B2025-12-01-%E7%8F%BE%E5%9C%A8%E5%8A%A0%E7%AD%86%E4%BF%AE%E6%AD%A3%E4%B8%AD"><i class="fa fa-check"></i><b>8.3</b> 統制変数には何を含めるべきか（2025-12-01 現在加筆修正中）</a>
<ul>
<li class="chapter" data-level="8.3.1" data-path="04-handling.html"><a href="#x%E3%81%A8y%E4%B8%A1%E6%96%B9%E3%81%BE%E3%81%9F%E3%81%AFx%E3%81%AE%E3%81%BF%E3%81%AE%E5%8E%9F%E5%9B%A0%E3%81%A8%E3%81%AA%E3%82%8B%E5%A4%89%E6%95%B0%E4%BA%A4%E7%B5%A1%E8%A6%81%E5%9B%A0%E7%B5%B1%E5%88%B6%E3%81%99%E3%81%B9%E3%81%8D"><i class="fa fa-check"></i><b>8.3.1</b> XとY両方、またはXのみの原因となる変数（交絡要因）：統制すべき</a></li>
<li class="chapter" data-level="8.3.2" data-path="04-handling.html"><a href="#x%E3%81%AE%E7%B5%90%E6%9E%9C%E3%81%A7%E3%81%82%E3%82%8Ay%E3%81%AE%E5%8E%9F%E5%9B%A0%E3%81%A7%E3%81%82%E3%82%8B%E5%A4%89%E6%95%B0%E5%AA%92%E4%BB%8B%E8%A6%81%E5%9B%A0%E5%A0%B4%E5%90%88%E3%81%AB%E3%82%88%E3%82%8B"><i class="fa fa-check"></i><b>8.3.2</b> Xの結果であり、Yの原因である変数（媒介要因）：場合による</a></li>
<li class="chapter" data-level="8.3.3" data-path="04-handling.html"><a href="#x%E3%81%AE%E7%B5%90%E6%9E%9C%E3%81%A7%E3%81%82%E3%82%8Ay%E3%81%AE%E7%B5%90%E6%9E%9C%E3%81%A7%E3%81%82%E3%82%8B%E5%A4%89%E6%95%B0%E5%90%88%E6%B5%81%E7%82%B9%E7%B5%B1%E5%88%B6%E3%81%99%E3%81%B9%E3%81%8D%E3%81%A7%E3%81%AA%E3%81%84"><i class="fa fa-check"></i><b>8.3.3</b> Xの結果であり、Yの結果である変数（合流点）：統制すべきでない</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="04-handling.html"><a href="#%E5%9B%9E%E5%B8%B0%E5%88%86%E6%9E%90%E3%81%AE%E5%AE%9F%E9%9A%9B"><i class="fa fa-check"></i><b>8.4</b> 回帰分析の実際</a>
<ul>
<li class="chapter" data-level="8.4.1" data-path="04-handling.html"><a href="#%E4%BA%A4%E7%B5%A1%E3%81%A8%E5%AA%92%E4%BB%8B"><i class="fa fa-check"></i><b>8.4.1</b> 交絡と媒介</a></li>
<li class="chapter" data-level="8.4.2" data-path="04-handling.html"><a href="#%E5%BE%93%E5%B1%9E%E5%A4%89%E6%95%B0%E3%82%92%E5%AF%BE%E6%95%B0%E5%A4%89%E6%8F%9B%E3%81%97%E3%81%9F%E5%A0%B4%E5%90%88%E3%81%AE%E8%A7%A3%E9%87%88broom%E3%83%91%E3%83%83%E3%82%B1%E3%83%BC%E3%82%B8%E3%81%AE%E6%B4%BB%E7%94%A8"><i class="fa fa-check"></i><b>8.4.2</b> 従属変数を対数変換した場合の解釈：broomパッケージの活用</a></li>
</ul></li>
<li class="chapter" data-level="8.5" data-path="04-handling.html"><a href="#%E5%9B%9E%E5%B8%B0%E5%88%86%E6%9E%90%E3%81%A7%E3%81%82%E3%82%8A%E3%81%8C%E3%81%A1%E3%81%AA%E5%9B%B0%E3%82%8A%E3%81%94%E3%81%A8%E3%81%B8%E3%81%AE%E5%AF%BE%E5%87%A6"><i class="fa fa-check"></i><b>8.5</b> 回帰分析でありがちな困りごとへの対処</a>
<ul>
<li class="chapter" data-level="8.5.1" data-path="04-handling.html"><a href="#%E5%8F%82%E7%85%A7%E3%82%AB%E3%83%86%E3%82%B4%E3%83%AA%E3%81%AE%E5%85%A5%E3%82%8C%E6%9B%BF%E3%81%88"><i class="fa fa-check"></i><b>8.5.1</b> 参照カテゴリの入れ替え</a></li>
<li class="chapter" data-level="8.5.2" data-path="04-handling.html"><a href="#%E5%8D%98%E4%BD%8D%E3%81%AE%E5%A4%89%E6%9B%B4"><i class="fa fa-check"></i><b>8.5.2</b> 単位の変更</a></li>
</ul></li>
<li class="chapter" data-level="8.6" data-path="04-handling.html"><a href="#%E7%B5%90%E6%9E%9C%E3%82%92%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%AB%E6%9B%B8%E3%81%8D%E5%87%BA%E3%81%99-2"><i class="fa fa-check"></i><b>8.6</b> 結果をファイルに書き出す</a></li>
<li class="chapter" data-level="8.7" data-path="04-handling.html"><a href="#%E7%B7%B4%E7%BF%92%E5%95%8F%E9%A1%8C-3"><i class="fa fa-check"></i><b>8.7</b> 練習問題</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="regression_interaction.html"><a href="regression_interaction.html"><i class="fa fa-check"></i><b>9</b> 交互作用</a>
<ul>
<li class="chapter" data-level="9.1" data-path="04-handling.html"><a href="#%E4%BA%A4%E4%BA%92%E4%BD%9C%E7%94%A8%E3%81%A8%E3%81%AF%E3%81%AA%E3%81%AB%E3%81%8B"><i class="fa fa-check"></i><b>9.1</b> 交互作用とはなにか</a></li>
<li class="chapter" data-level="9.2" data-path="04-handling.html"><a href="#x%E3%81%8C%E9%80%A3%E7%B6%9A%E5%A4%89%E6%95%B0z%E3%81%8C%E3%82%AB%E3%83%86%E3%82%B4%E3%83%AA%E5%A4%89%E6%95%B0%E3%81%BE%E3%81%9F%E3%81%AF%E3%81%9D%E3%81%AE%E9%80%86%E3%81%AE%E5%A0%B4%E5%90%88"><i class="fa fa-check"></i><b>9.2</b> xが連続変数、zがカテゴリ変数（またはその逆）の場合</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="04-handling.html"><a href="#%E5%AE%9F%E4%BE%8B%E6%95%B0%E7%9A%84%E6%80%9D%E8%80%83%E5%8A%9B%E3%81%8C%E8%B3%83%E9%87%91%E3%82%92%E9%AB%98%E3%82%81%E3%82%8B%E5%8A%B9%E6%9E%9C%E3%81%AF%E6%80%A7%E5%88%A5%E3%81%AB%E3%82%88%E3%81%A3%E3%81%A6%E7%95%B0%E3%81%AA%E3%82%8B%E3%81%8B"><i class="fa fa-check"></i><b>9.2.1</b> 実例：数的思考力が賃金を高める効果は性別によって異なるか？</a></li>
<li class="chapter" data-level="9.2.2" data-path="04-handling.html"><a href="#%E7%B5%90%E6%9E%9C%E3%82%92%E5%9B%B3%E7%A4%BA%E3%81%99%E3%82%8B"><i class="fa fa-check"></i><b>9.2.2</b> 結果を図示する</a></li>
<li class="chapter" data-level="9.2.3" data-path="04-handling.html"><a href="#x%E3%81%8C%E3%82%AB%E3%83%86%E3%82%B4%E3%83%AA%E5%A4%89%E6%95%B0z%E3%81%8C%E9%80%A3%E7%B6%9A%E5%A4%89%E6%95%B0%E3%81%AE%E5%A0%B4%E5%90%88"><i class="fa fa-check"></i><b>9.2.3</b> xがカテゴリ変数、zが連続変数の場合</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="04-handling.html"><a href="#x%E3%81%8C%E3%82%AB%E3%83%86%E3%82%B4%E3%83%AA%E5%A4%89%E6%95%B0z%E3%81%8C%E3%82%AB%E3%83%86%E3%82%B4%E3%83%AA%E5%A4%89%E6%95%B0%E3%81%AE%E5%A0%B4%E5%90%88"><i class="fa fa-check"></i><b>9.3</b> xがカテゴリ変数、zがカテゴリ変数の場合</a></li>
<li class="chapter" data-level="9.4" data-path="04-handling.html"><a href="#x%E3%81%8C%E9%80%A3%E7%B6%9A%E5%A4%89%E6%95%B0z%E3%81%8C%E9%80%A3%E7%B6%9A%E5%A4%89%E6%95%B0%E3%81%AE%E5%A0%B4%E5%90%88%E4%BD%9C%E6%88%90%E4%B8%AD"><i class="fa fa-check"></i><b>9.4</b> xが連続変数、zが連続変数の場合（作成中）</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="logit.html"><a href="logit.html"><i class="fa fa-check"></i><b>10</b> ロジスティック回帰分析</a>
<ul>
<li class="chapter" data-level="10.1" data-path="04-handling.html"><a href="#%E4%BA%8C%E5%80%A4%E5%A4%89%E6%95%B0%E3%82%92%E5%BE%93%E5%B1%9E%E5%A4%89%E6%95%B0%E3%81%AB%E3%81%99%E3%82%8B%E7%B7%9A%E5%BD%A2%E5%9B%9E%E5%B8%B0%E5%88%86%E6%9E%90%E3%81%AB%E3%82%88%E3%82%8B%E6%96%B9%E6%B3%95"><i class="fa fa-check"></i><b>10.1</b> 二値変数を従属変数にする：線形回帰分析による方法</a>
<ul>
<li class="chapter" data-level="10.1.1" data-path="04-handling.html"><a href="#%E7%B7%9A%E5%BD%A2%E7%A2%BA%E7%8E%87%E3%83%A2%E3%83%87%E3%83%AB"><i class="fa fa-check"></i><b>10.1.1</b> 線形確率モデル</a></li>
<li class="chapter" data-level="10.1.2" data-path="04-handling.html"><a href="#%E3%83%AD%E3%83%90%E3%82%B9%E3%83%88%E6%A8%99%E6%BA%96%E8%AA%A4%E5%B7%AE%E6%AE%8B%E5%B7%AE%E3%81%8C%E6%AD%A3%E8%A6%8F%E5%88%86%E5%B8%83%E3%81%97%E3%81%AA%E3%81%84%E5%95%8F%E9%A1%8C%E3%81%B8%E3%81%AE%E5%AF%BE%E5%87%A6"><i class="fa fa-check"></i><b>10.1.2</b> ロバスト標準誤差：残差が正規分布しない問題への対処</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="04-handling.html"><a href="#%E3%83%AD%E3%82%B8%E3%82%B9%E3%83%86%E3%82%A3%E3%83%83%E3%82%AF%E5%9B%9E%E5%B8%B0%E5%88%86%E6%9E%90%E3%81%A8%E3%81%AF"><i class="fa fa-check"></i><b>10.2</b> ロジスティック回帰分析とは</a>
<ul>
<li class="chapter" data-level="10.2.1" data-path="04-handling.html"><a href="#%E7%B7%9A%E5%BD%A2%E7%A2%BA%E7%8E%87%E3%83%A2%E3%83%87%E3%83%AB%E3%81%AE%E5%95%8F%E9%A1%8C%E7%82%B9"><i class="fa fa-check"></i><b>10.2.1</b> 線形確率モデルの問題点</a></li>
<li class="chapter" data-level="10.2.2" data-path="04-handling.html"><a href="#%E5%AF%BE%E6%95%B0%E3%82%AA%E3%83%83%E3%82%BA%E6%AF%94%E5%8A%B9%E6%9E%9C%E3%82%92%E6%AF%94%E3%81%A7%E6%B8%AC%E5%AE%9A%E3%81%99%E3%82%8B"><i class="fa fa-check"></i><b>10.2.2</b> （対数）オッズ比：効果を「比」で測定する</a></li>
<li class="chapter" data-level="10.2.3" data-path="04-handling.html"><a href="#%E3%83%AD%E3%82%B8%E3%82%B9%E3%83%86%E3%82%A3%E3%83%83%E3%82%AF%E5%9B%9E%E5%B8%B0%E5%88%86%E6%9E%90%E3%83%AD%E3%82%B8%E3%83%83%E3%83%88%E3%83%A2%E3%83%87%E3%83%AB"><i class="fa fa-check"></i><b>10.2.3</b> ロジスティック回帰分析（ロジットモデル）</a></li>
<li class="chapter" data-level="10.2.4" data-path="04-handling.html"><a href="#%E7%9B%B4%E7%B7%9A%E3%81%A8%E3%83%AD%E3%82%B8%E3%82%B9%E3%83%86%E3%82%A3%E3%83%83%E3%82%AF%E6%9B%B2%E7%B7%9A"><i class="fa fa-check"></i><b>10.2.4</b> 直線とロジスティック曲線</a></li>
<li class="chapter" data-level="10.2.5" data-path="04-handling.html"><a href="#%E6%8E%A8%E5%AE%9A"><i class="fa fa-check"></i><b>10.2.5</b> 推定</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="04-handling.html"><a href="#%E6%9C%80%E5%B0%A4%E6%8E%A8%E5%AE%9A%E4%BD%9C%E6%88%90%E4%B8%AD"><i class="fa fa-check"></i><b>10.3</b> 最尤推定（作成中）</a></li>
<li class="chapter" data-level="10.4" data-path="04-handling.html"><a href="#%E8%A7%A3%E9%87%88%E3%82%92%E6%B7%B1%E3%82%81%E3%82%8B"><i class="fa fa-check"></i><b>10.4</b> 解釈を深める</a>
<ul>
<li class="chapter" data-level="10.4.1" data-path="04-handling.html"><a href="#%E7%B7%9A%E5%BD%A2%E7%A2%BA%E7%8E%87%E3%83%A2%E3%83%87%E3%83%AB%E3%81%A8%E3%83%AD%E3%82%B8%E3%83%83%E3%83%88%E3%83%A2%E3%83%87%E3%83%AB%E3%81%AE%E6%AF%94%E8%BC%83"><i class="fa fa-check"></i><b>10.4.1</b> 線形確率モデルとロジットモデルの比較</a></li>
<li class="chapter" data-level="10.4.2" data-path="04-handling.html"><a href="#%E5%B9%B3%E5%9D%87%E9%99%90%E7%95%8C%E5%8A%B9%E6%9E%9C"><i class="fa fa-check"></i><b>10.4.2</b> 平均限界効果</a></li>
<li class="chapter" data-level="10.4.3" data-path="04-handling.html"><a href="#margins%E5%B9%B3%E5%9D%87%E9%99%90%E7%95%8C%E5%8A%B9%E6%9E%9C%E3%82%92%E8%A8%88%E7%AE%97%E3%81%99%E3%82%8B"><i class="fa fa-check"></i><b>10.4.3</b> margins()：平均限界効果を計算する</a></li>
<li class="chapter" data-level="10.4.4" data-path="04-handling.html"><a href="#%E7%B7%9A%E5%BD%A2%E7%A2%BA%E7%8E%87%E3%83%A2%E3%83%87%E3%83%AB%E3%81%AE%E7%B5%90%E6%9E%9C%E3%81%A8%E3%81%AE%E6%AF%94%E8%BC%83"><i class="fa fa-check"></i><b>10.4.4</b> 線形確率モデルの結果との比較</a></li>
<li class="chapter" data-level="10.4.5" data-path="04-handling.html"><a href="#%E3%83%AD%E3%82%B8%E3%83%83%E3%83%88%E3%83%A2%E3%83%87%E3%83%AB%E3%81%AE%E6%B3%A8%E6%84%8F%E7%82%B9%E3%83%A2%E3%83%87%E3%83%AB%E9%96%93%E6%AF%94%E8%BC%83"><i class="fa fa-check"></i><b>10.4.5</b> ロジットモデルの注意点：モデル間比較</a></li>
</ul></li>
<li class="chapter" data-level="10.5" data-path="04-handling.html"><a href="#%E3%81%BE%E3%81%A8%E3%82%81"><i class="fa fa-check"></i><b>10.5</b> まとめ</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="paneldata.html"><a href="paneldata.html"><i class="fa fa-check"></i><b>11</b> パネルデータ分析（作成中）</a>
<ul>
<li class="chapter" data-level="11.1" data-path="04-handling.html"><a href="#%E3%83%91%E3%83%8D%E3%83%AB%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AE%E5%9F%BA%E6%9C%AC%E7%9A%84%E7%89%B9%E5%BE%B4"><i class="fa fa-check"></i><b>11.1</b> パネルデータの基本的特徴</a>
<ul>
<li class="chapter" data-level="11.1.1" data-path="04-handling.html"><a href="#%E3%83%91%E3%83%8D%E3%83%AB%E3%83%87%E3%83%BC%E3%82%BF%E3%81%A8%E3%81%AF"><i class="fa fa-check"></i><b>11.1.1</b> パネルデータとは</a></li>
<li class="chapter" data-level="11.1.2" data-path="04-handling.html"><a href="#wide%E5%BD%A2%E5%BC%8F%E3%81%A8long%E5%BD%A2%E5%BC%8F"><i class="fa fa-check"></i><b>11.1.2</b> wide形式とlong形式</a></li>
<li class="chapter" data-level="11.1.3" data-path="04-handling.html"><a href="#%E6%99%82%E9%96%93%E5%8F%AF%E5%A4%89%E3%81%A8%E6%99%82%E9%96%93%E4%B8%8D%E5%A4%89"><i class="fa fa-check"></i><b>11.1.3</b> 時間可変と時間不変</a></li>
<li class="chapter" data-level="11.1.4" data-path="paneldata.html"><a href="paneldata.html#within_between_variation"><i class="fa fa-check"></i><b>11.1.4</b> 個人内変動と個人間変動</a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="04-handling.html"><a href="#%E3%83%91%E3%83%8D%E3%83%AB%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AE%E7%89%B9%E5%BE%B4%E8%A8%98%E8%BF%B0"><i class="fa fa-check"></i><b>11.2</b> パネルデータの特徴記述</a>
<ul>
<li class="chapter" data-level="11.2.1" data-path="04-handling.html"><a href="#%E3%82%B5%E3%83%B3%E3%83%97%E3%83%AB%E3%83%87%E3%83%BC%E3%82%BF"><i class="fa fa-check"></i><b>11.2.1</b> サンプルデータ</a></li>
<li class="chapter" data-level="11.2.2" data-path="04-handling.html"><a href="#%E3%83%87%E3%83%BC%E3%82%BF%E3%82%92%E6%98%87%E9%A0%86%E3%81%BE%E3%81%9F%E3%81%AF%E9%99%8D%E9%A0%86%E3%81%AB%E4%B8%A6%E3%81%B9%E6%9B%BF%E3%81%88%E3%82%8Barrange"><i class="fa fa-check"></i><b>11.2.2</b> データを昇順または降順に並べ替える：<code>arrange()</code></a></li>
<li class="chapter" data-level="11.2.3" data-path="04-handling.html"><a href="#%E4%B8%8A%E3%81%AE%E8%A1%8C%E4%B8%8B%E3%81%AE%E8%A1%8C%E3%81%AE%E5%80%A4%E3%82%92%E3%82%B3%E3%83%94%E3%83%BC%E3%81%99%E3%82%8Blag-lead"><i class="fa fa-check"></i><b>11.2.3</b> 上の行、下の行の値をコピーする：<code>lag()</code> <code>lead()</code></a></li>
<li class="chapter" data-level="11.2.4" data-path="04-handling.html"><a href="#%E3%83%91%E3%83%8D%E3%83%AB%E3%83%87%E3%83%BC%E3%82%BF%E7%89%B9%E6%9C%89%E3%81%AE%E8%A8%98%E8%BF%B0%E7%B5%B1%E8%A8%88%E9%87%8Fxtsum"><i class="fa fa-check"></i><b>11.2.4</b> パネルデータ特有の記述統計量：<code>xtsum</code></a></li>
</ul></li>
<li class="chapter" data-level="11.3" data-path="paneldata.html"><a href="paneldata.html#pooled-ols"><i class="fa fa-check"></i><b>11.3</b> Pooled OLS</a></li>
<li class="chapter" data-level="11.4" data-path="04-handling.html"><a href="#%E5%9B%BA%E5%AE%9A%E5%8A%B9%E6%9E%9C%E3%83%A2%E3%83%87%E3%83%AB"><i class="fa fa-check"></i><b>11.4</b> 固定効果モデル</a>
<ul>
<li class="chapter" data-level="11.4.1" data-path="04-handling.html"><a href="#%E5%9B%BA%E5%AE%9A%E5%8A%B9%E6%9E%9C%E3%83%A2%E3%83%87%E3%83%AB%E3%81%A8%E3%81%AF"><i class="fa fa-check"></i><b>11.4.1</b> 固定効果モデルとは</a></li>
<li class="chapter" data-level="11.4.2" data-path="04-handling.html"><a href="#%E6%8E%A8%E5%AE%9A%E6%96%B9%E6%B3%95fixestfeols"><i class="fa fa-check"></i><b>11.4.2</b> 推定方法：<code>fixest::feols()</code></a></li>
<li class="chapter" data-level="11.4.3" data-path="04-handling.html"><a href="#%E3%82%AF%E3%83%A9%E3%82%B9%E3%82%BF%E3%83%BC%E3%83%AD%E3%83%90%E3%82%B9%E3%83%88%E6%A8%99%E6%BA%96%E8%AA%A4%E5%B7%AE"><i class="fa fa-check"></i><b>11.4.3</b> クラスター・ロバスト標準誤差</a></li>
<li class="chapter" data-level="11.4.4" data-path="04-handling.html"><a href="#%E4%BA%8C%E6%96%B9%E5%90%91%E5%9B%BA%E5%AE%9A%E5%8A%B9%E6%9E%9C%E3%83%A2%E3%83%87%E3%83%AB"><i class="fa fa-check"></i><b>11.4.4</b> 二方向固定効果モデル</a></li>
</ul></li>
<li class="chapter" data-level="11.5" data-path="04-handling.html"><a href="#%E4%B8%A1%E8%80%85%E3%81%AE%E6%AF%94%E8%BC%83"><i class="fa fa-check"></i><b>11.5</b> 両者の比較</a>
<ul>
<li class="chapter" data-level="11.5.1" data-path="04-handling.html"><a href="#%E5%9B%9E%E3%81%97%E3%81%8B%E8%A6%B3%E5%AF%9F%E3%81%8C%E5%BE%97%E3%82%89%E3%82%8C%E3%81%A6%E3%81%84%E3%81%AA%E3%81%84%E5%80%8B%E4%BA%BA%E3%82%92%E9%99%A4%E5%A4%96%E3%81%99%E3%82%8B"><i class="fa fa-check"></i><b>11.5.1</b> 1回しか観察が得られていない個人を除外する</a></li>
<li class="chapter" data-level="11.5.2" data-path="04-handling.html"><a href="#pooled-ols%E3%81%A8%E5%9B%BA%E5%AE%9A%E5%8A%B9%E6%9E%9C%E3%83%A2%E3%83%87%E3%83%AB%E3%81%AE%E6%AF%94%E8%BC%83"><i class="fa fa-check"></i><b>11.5.2</b> Pooled OLSと固定効果モデルの比較</a></li>
<li class="chapter" data-level="11.5.3" data-path="04-handling.html"><a href="#%E5%80%8B%E4%BA%BA%E9%96%93%E5%8A%B9%E6%9E%9C%E3%81%A8%E5%80%8B%E4%BA%BA%E5%86%85%E5%8A%B9%E6%9E%9C"><i class="fa fa-check"></i><b>11.5.3</b> 個人間効果と個人内効果</a></li>
</ul></li>
<li class="chapter" data-level="11.6" data-path="04-handling.html"><a href="#%E5%9B%BA%E5%AE%9A%E5%8A%B9%E6%9E%9C%E3%83%A2%E3%83%87%E3%83%AB%E3%81%AE%E6%B3%A8%E6%84%8F%E7%82%B9"><i class="fa fa-check"></i><b>11.6</b> 固定効果モデルの注意点</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="domain.html"><a href="domain.html"><i class="fa fa-check"></i><b>12</b> 社会学のデータ分析でよくある処理</a>
<ul>
<li class="chapter" data-level="12.1" data-path="04-handling.html"><a href="#ssm%E8%81%B7%E6%A5%AD%E5%B0%8F%E5%88%86%E9%A1%9E%E3%82%92%E5%A4%A7%E5%88%86%E9%A1%9E%E3%81%AB%E3%81%BE%E3%81%A8%E3%82%81%E3%82%8B"><i class="fa fa-check"></i><b>12.1</b> SSM職業小分類を大分類にまとめる</a>
<ul>
<li class="chapter" data-level="12.1.1" data-path="04-handling.html"><a href="#jgss%E3%81%AE%E5%A0%B4%E5%90%88"><i class="fa fa-check"></i><b>12.1.1</b> JGSSの場合</a></li>
<li class="chapter" data-level="12.1.2" data-path="04-handling.html"><a href="#ssm%E3%81%AE%E5%A0%B4%E5%90%88"><i class="fa fa-check"></i><b>12.1.2</b> SSMの場合</a></li>
</ul></li>
<li class="chapter" data-level="12.2" data-path="04-handling.html"><a href="#%E6%97%A7%E5%88%B6%E5%AD%A6%E6%AD%B4%E3%81%A8%E6%96%B0%E5%88%B6%E5%AD%A6%E6%AD%B4%E3%81%AE%E5%AF%BE%E5%BF%9C"><i class="fa fa-check"></i><b>12.2</b> 旧制学歴と新制学歴の対応</a></li>
<li class="chapter" data-level="12.3" data-path="domain.html"><a href="domain.html#domain_income"><i class="fa fa-check"></i><b>12.3</b> 年収カテゴリを連続変数にする</a>
<ul>
<li class="chapter" data-level="12.3.1" data-path="04-handling.html"><a href="#%E5%B9%B4%E5%8F%8E%E3%82%92%E9%80%A3%E7%B6%9A%E5%A4%89%E6%95%B0%E3%81%AB%E3%81%99%E3%82%8B"><i class="fa fa-check"></i><b>12.3.1</b> 年収を連続変数にする</a></li>
<li class="chapter" data-level="12.3.2" data-path="04-handling.html"><a href="#%E6%99%82%E9%96%93%E3%81%82%E3%81%9F%E3%82%8A%E8%B3%83%E9%87%91%E3%82%92%E4%BD%9C%E6%88%90%E3%81%99%E3%82%8B"><i class="fa fa-check"></i><b>12.3.2</b> 時間あたり賃金を作成する</a></li>
</ul></li>
<li class="chapter" data-level="12.4" data-path="04-handling.html"><a href="#%E9%83%BD%E9%81%93%E5%BA%9C%E7%9C%8C%E5%A4%89%E6%95%B0%E3%81%AE%E5%8A%A0%E5%B7%A5"><i class="fa fa-check"></i><b>12.4</b> 都道府県変数の加工</a>
<ul>
<li class="chapter" data-level="12.4.1" data-path="04-handling.html"><a href="#%E9%83%BD%E9%81%93%E5%BA%9C%E7%9C%8C%E3%81%AB%E3%83%A9%E3%83%99%E3%83%AB%E3%82%92%E3%81%A4%E3%81%91%E3%82%8B"><i class="fa fa-check"></i><b>12.4.1</b> 都道府県にラベルをつける</a></li>
<li class="chapter" data-level="12.4.2" data-path="04-handling.html"><a href="#%E9%83%BD%E9%81%93%E5%BA%9C%E7%9C%8C%E3%83%AC%E3%83%99%E3%83%AB%E3%81%AE%E6%8C%87%E6%A8%99%E3%82%92%E5%A4%96%E6%8C%BF%E3%81%99%E3%82%8B"><i class="fa fa-check"></i><b>12.4.2</b> 都道府県レベルの指標を外挿する</a></li>
</ul></li>
<li class="chapter" data-level="12.5" data-path="04-handling.html"><a href="#ssm%E8%81%B7%E6%AD%B4%E3%83%87%E3%83%BC%E3%82%BF%E3%81%8B%E3%82%89%E7%8F%BE%E8%81%B7%E3%81%AE%E5%8B%A4%E7%B6%9A%E5%B9%B4%E6%95%B0%E3%82%92%E4%BD%9C%E6%88%90%E3%81%99%E3%82%8B"><i class="fa fa-check"></i><b>12.5</b> SSM職歴データから現職の勤続年数を作成する</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="writepaper.html"><a href="writepaper.html"><i class="fa fa-check"></i><b>13</b> 論文のまとめ方</a>
<ul>
<li class="chapter" data-level="13.1" data-path="04-handling.html"><a href="#%E5%85%A8%E4%BD%93%E3%81%AE%E6%A7%8B%E6%88%90"><i class="fa fa-check"></i><b>13.1</b> 全体の構成</a></li>
<li class="chapter" data-level="13.2" data-path="04-handling.html"><a href="#%E3%82%BF%E3%82%A4%E3%83%88%E3%83%AB"><i class="fa fa-check"></i><b>13.2</b> タイトル</a></li>
<li class="chapter" data-level="13.3" data-path="04-handling.html"><a href="#%E8%A6%81%E7%B4%84"><i class="fa fa-check"></i><b>13.3</b> 要約</a></li>
<li class="chapter" data-level="13.4" data-path="04-handling.html"><a href="#%E5%BA%8F%E8%AB%96"><i class="fa fa-check"></i><b>13.4</b> 序論</a>
<ul>
<li class="chapter" data-level="13.4.1" data-path="04-handling.html"><a href="#%E5%95%8F%E9%A1%8C%E8%83%8C%E6%99%AF1%E6%AE%B5%E8%90%BD"><i class="fa fa-check"></i><b>13.4.1</b> 問題背景（1段落）</a></li>
<li class="chapter" data-level="13.4.2" data-path="04-handling.html"><a href="#%E5%85%88%E8%A1%8C%E7%A0%94%E7%A9%B6%E3%81%AE%E6%A4%9C%E8%A8%8E12%E6%AE%B5%E8%90%BD"><i class="fa fa-check"></i><b>13.4.2</b> 先行研究の検討（1–2段落）</a></li>
<li class="chapter" data-level="13.4.3" data-path="04-handling.html"><a href="#%E7%A0%94%E7%A9%B6%E7%9B%AE%E7%9A%84%E3%81%A8%E6%96%B9%E6%B3%9512%E6%AE%B5%E8%90%BD"><i class="fa fa-check"></i><b>13.4.3</b> 研究目的と方法（1–2段落）</a></li>
</ul></li>
<li class="chapter" data-level="13.5" data-path="04-handling.html"><a href="#%E5%85%88%E8%A1%8C%E7%A0%94%E7%A9%B6%E7%90%86%E8%AB%96%E6%9E%A0%E7%B5%84%E3%81%BF%E4%BB%AE%E8%AA%AC"><i class="fa fa-check"></i><b>13.5</b> 先行研究・理論枠組み・仮説</a></li>
<li class="chapter" data-level="13.6" data-path="04-handling.html"><a href="#%E6%96%B9%E6%B3%95"><i class="fa fa-check"></i><b>13.6</b> 方法</a>
<ul>
<li class="chapter" data-level="13.6.1" data-path="04-handling.html"><a href="#%E3%83%87%E3%83%BC%E3%82%BF%E3%81%A8%E5%88%86%E6%9E%90%E5%AF%BE%E8%B1%A1"><i class="fa fa-check"></i><b>13.6.1</b> データと分析対象</a></li>
<li class="chapter" data-level="13.6.2" data-path="04-handling.html"><a href="#%E5%A4%89%E6%95%B0"><i class="fa fa-check"></i><b>13.6.2</b> 変数</a></li>
<li class="chapter" data-level="13.6.3" data-path="04-handling.html"><a href="#%E5%88%86%E6%9E%90%E6%89%8B%E6%B3%95"><i class="fa fa-check"></i><b>13.6.3</b> 分析手法</a></li>
</ul></li>
<li class="chapter" data-level="13.7" data-path="04-handling.html"><a href="#%E7%B5%90%E6%9E%9C"><i class="fa fa-check"></i><b>13.7</b> 結果</a>
<ul>
<li class="chapter" data-level="13.7.1" data-path="04-handling.html"><a href="#%E8%A8%98%E8%BF%B0%E7%9A%84%E5%88%86%E6%9E%90"><i class="fa fa-check"></i><b>13.7.1</b> 記述的分析</a></li>
<li class="chapter" data-level="13.7.2" data-path="04-handling.html"><a href="#%E5%9B%9E%E5%B8%B0%E5%88%86%E6%9E%90"><i class="fa fa-check"></i><b>13.7.2</b> 回帰分析</a></li>
</ul></li>
<li class="chapter" data-level="13.8" data-path="04-handling.html"><a href="#%E7%B5%90%E8%AB%96"><i class="fa fa-check"></i><b>13.8</b> 結論</a>
<ul>
<li class="chapter" data-level="13.8.1" data-path="04-handling.html"><a href="#%E8%83%8C%E6%99%AF%E3%81%A8%E7%9B%AE%E7%9A%84%E3%81%AE%E5%86%8D%E7%A2%BA%E8%AA%8D1%E6%AE%B5%E8%90%BD"><i class="fa fa-check"></i><b>13.8.1</b> 背景と目的の再確認（1段落）</a></li>
<li class="chapter" data-level="13.8.2" data-path="04-handling.html"><a href="#%E5%88%86%E6%9E%90%E7%B5%90%E6%9E%9C%E3%81%AE%E8%A6%81%E7%B4%84%E3%81%A8%E8%A7%A3%E9%87%8824%E6%AE%B5%E8%90%BD"><i class="fa fa-check"></i><b>13.8.2</b> 分析結果の要約と解釈（2–4段落）</a></li>
<li class="chapter" data-level="13.8.3" data-path="04-handling.html"><a href="#%E8%AA%B2%E9%A1%8C%E9%99%90%E7%95%8C1%E6%AE%B5%E8%90%BD"><i class="fa fa-check"></i><b>13.8.3</b> 課題・限界（1段落）</a></li>
<li class="chapter" data-level="13.8.4" data-path="04-handling.html"><a href="#%E3%81%BE%E3%81%A8%E3%82%811%E6%AE%B5%E8%90%BD%E4%BB%BB%E6%84%8F"><i class="fa fa-check"></i><b>13.8.4</b> まとめ（1段落、任意）</a></li>
</ul></li>
<li class="chapter" data-level="13.9" data-path="04-handling.html"><a href="#%E8%AC%9D%E8%BE%9E"><i class="fa fa-check"></i><b>13.9</b> 謝辞</a></li>
<li class="chapter" data-level="13.10" data-path="04-handling.html"><a href="#%E5%8F%82%E8%80%83%E6%96%87%E7%8C%AE"><i class="fa fa-check"></i><b>13.10</b> 参考文献</a>
<ul>
<li class="chapter" data-level="13.10.1" data-path="04-handling.html"><a href="#%E6%9B%B8%E7%B1%8D%E3%81%AE%E5%A0%B4%E5%90%88%E3%81%AE%E6%9B%B8%E3%81%8D%E6%96%B9"><i class="fa fa-check"></i><b>13.10.1</b> 書籍の場合の書き方</a></li>
<li class="chapter" data-level="13.10.2" data-path="04-handling.html"><a href="#%E7%B7%A8%E8%91%97%E6%9B%B8%E7%B1%8D%E4%B8%AD%E3%81%AE%E8%AB%96%E6%96%87%E3%81%AE%E5%A0%B4%E5%90%88%E3%81%AE%E6%9B%B8%E3%81%8D%E6%96%B9"><i class="fa fa-check"></i><b>13.10.2</b> 編著書籍中の論文の場合の書き方</a></li>
<li class="chapter" data-level="13.10.3" data-path="04-handling.html"><a href="#%E6%97%A5%E6%9C%AC%E8%AA%9E%E3%81%AE%E9%9B%91%E8%AA%8C%E8%AB%96%E6%96%87%E3%81%AE%E5%A0%B4%E5%90%88%E3%81%AE%E6%9B%B8%E3%81%8D%E6%96%B9"><i class="fa fa-check"></i><b>13.10.3</b> 日本語の雑誌論文の場合の書き方</a></li>
<li class="chapter" data-level="13.10.4" data-path="04-handling.html"><a href="#%E8%8B%B1%E8%AA%9E%E3%81%AE%E9%9B%91%E8%AA%8C%E8%AB%96%E6%96%87%E3%81%AE%E5%A0%B4%E5%90%88%E3%81%AE%E6%9B%B8%E3%81%8D%E6%96%B9"><i class="fa fa-check"></i><b>13.10.4</b> 英語の雑誌論文の場合の書き方</a></li>
<li class="chapter" data-level="13.10.5" data-path="04-handling.html"><a href="#%E8%8B%B1%E8%AA%9E%E3%81%AE%E6%9B%B8%E7%B1%8D%E3%81%AE%E5%A0%B4%E5%90%88%E3%81%AE%E6%9B%B8%E3%81%8D%E6%96%B9"><i class="fa fa-check"></i><b>13.10.5</b> 英語の書籍の場合の書き方</a></li>
<li class="chapter" data-level="13.10.6" data-path="04-handling.html"><a href="#%E7%BF%BB%E8%A8%B3%E6%9B%B8%E3%81%AE%E5%A0%B4%E5%90%88%E3%81%AE%E6%9B%B8%E3%81%8D%E6%96%B9"><i class="fa fa-check"></i><b>13.10.6</b> 翻訳書の場合の書き方</a></li>
<li class="chapter" data-level="13.10.7" data-path="04-handling.html"><a href="#%E3%82%A6%E3%82%A7%E3%83%96%E3%82%B5%E3%82%A4%E3%83%88%E3%81%AE%E5%A0%B4%E5%90%88%E3%81%AE%E6%9B%B8%E3%81%8D%E6%96%B9"><i class="fa fa-check"></i><b>13.10.7</b> ウェブサイトの場合の書き方</a></li>
</ul></li>
<li class="chapter" data-level="13.11" data-path="04-handling.html"><a href="#%E3%81%9D%E3%81%AE%E3%81%BB%E3%81%8B%E3%81%AE%E5%BD%A2%E5%BC%8F%E4%B8%8A%E3%81%AE%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A0%85"><i class="fa fa-check"></i><b>13.11</b> そのほかの形式上の注意事項</a>
<ul>
<li class="chapter" data-level="13.11.1" data-path="04-handling.html"><a href="#%E6%8E%A8%E5%A5%A8%E3%81%99%E3%82%8Bword%E3%81%AE%E8%A8%AD%E5%AE%9A"><i class="fa fa-check"></i><b>13.11.1</b> 推奨するWordの設定</a></li>
<li class="chapter" data-level="13.11.2" data-path="04-handling.html"><a href="#%E5%BC%95%E7%94%A8%E3%81%AE%E5%BD%A2%E5%BC%8F"><i class="fa fa-check"></i><b>13.11.2</b> 引用の形式</a></li>
<li class="chapter" data-level="13.11.3" data-path="04-handling.html"><a href="#%E5%9B%B3%E8%A1%A8%E3%81%AE%E5%BD%A2%E5%BC%8F"><i class="fa fa-check"></i><b>13.11.3</b> 図表の形式</a></li>
<li class="chapter" data-level="13.11.4" data-path="04-handling.html"><a href="#%E8%84%9A%E6%B3%A8"><i class="fa fa-check"></i><b>13.11.4</b> 脚注</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="14" data-path="presentation.html"><a href="presentation.html"><i class="fa fa-check"></i><b>14</b> 研究発表をする</a>
<ul>
<li class="chapter" data-level="14.1" data-path="04-handling.html"><a href="#%E7%99%BA%E8%A1%A8%E3%81%AE%E6%A7%8B%E6%88%90"><i class="fa fa-check"></i><b>14.1</b> 発表の構成</a>
<ul>
<li class="chapter" data-level="14.1.1" data-path="04-handling.html"><a href="#%E3%82%BF%E3%82%A4%E3%83%88%E3%83%AB-1"><i class="fa fa-check"></i><b>14.1.1</b> タイトル</a></li>
<li class="chapter" data-level="14.1.2" data-path="04-handling.html"><a href="#%E5%BA%8F%E8%AB%96-1"><i class="fa fa-check"></i><b>14.1.2</b> 序論</a></li>
<li class="chapter" data-level="14.1.3" data-path="04-handling.html"><a href="#%E6%96%B9%E6%B3%95-1"><i class="fa fa-check"></i><b>14.1.3</b> 方法</a></li>
<li class="chapter" data-level="14.1.4" data-path="04-handling.html"><a href="#%E5%88%86%E6%9E%90%E7%B5%90%E6%9E%9C"><i class="fa fa-check"></i><b>14.1.4</b> 分析結果</a></li>
<li class="chapter" data-level="14.1.5" data-path="04-handling.html"><a href="#%E7%B5%90%E8%AB%96-1"><i class="fa fa-check"></i><b>14.1.5</b> 結論</a></li>
</ul></li>
<li class="chapter" data-level="14.2" data-path="04-handling.html"><a href="#%E3%81%9D%E3%81%AE%E4%BB%96%E7%99%BA%E8%A1%A8%E3%81%AB%E9%9A%9B%E3%81%97%E3%81%A6%E6%B0%97%E3%82%92%E3%81%A4%E3%81%91%E3%82%8B%E3%81%A8%E3%82%88%E3%81%84%E3%81%93%E3%81%A8"><i class="fa fa-check"></i><b>14.2</b> その他発表に際して気をつけるとよいこと</a>
<ul>
<li class="chapter" data-level="14.2.1" data-path="04-handling.html"><a href="#%E4%BA%8B%E5%89%8D%E3%81%AB%E7%99%BA%E8%A1%A8%E7%B7%B4%E7%BF%92%E3%82%92%E3%81%99%E3%82%8B"><i class="fa fa-check"></i><b>14.2.1</b> 事前に発表練習をする</a></li>
<li class="chapter" data-level="14.2.2" data-path="04-handling.html"><a href="#%E6%96%87%E5%AD%97%E3%81%AF%E5%A4%A7%E3%81%8D%E3%81%8F%E5%B0%91%E3%81%AA%E3%81%8F"><i class="fa fa-check"></i><b>14.2.2</b> 文字は大きく少なく</a></li>
<li class="chapter" data-level="14.2.3" data-path="04-handling.html"><a href="#%E3%82%B9%E3%83%A9%E3%82%A4%E3%83%89%E3%81%AB%E3%81%AF%E3%83%9A%E3%83%BC%E3%82%B8%E6%95%B0%E3%82%92%E6%9B%B8%E3%81%8F"><i class="fa fa-check"></i><b>14.2.3</b> スライドにはページ数を書く</a></li>
<li class="chapter" data-level="14.2.4" data-path="04-handling.html"><a href="#%E3%82%B9%E3%83%A9%E3%82%A4%E3%83%89%E3%81%A4%E3%81%8F%E3%82%8A%E3%81%AE%E5%8F%82%E8%80%83%E8%B3%87%E6%96%99"><i class="fa fa-check"></i><b>14.2.4</b> スライドつくりの参考資料</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="15" data-path="reference.html"><a href="reference.html"><i class="fa fa-check"></i><b>15</b> さらなる学習のための参考文献等</a>
<ul>
<li class="chapter" data-level="15.1" data-path="04-handling.html"><a href="#%E5%AE%9F%E8%A8%BC%E7%A0%94%E7%A9%B6%E3%81%AE%E5%9F%BA%E7%A4%8E%E3%82%B9%E3%82%AD%E3%83%AB"><i class="fa fa-check"></i><b>15.1</b> 実証研究の基礎スキル</a></li>
<li class="chapter" data-level="15.2" data-path="04-handling.html"><a href="#r%E3%81%AE%E4%BD%BF%E3%81%84%E6%96%B9"><i class="fa fa-check"></i><b>15.2</b> Rの使い方</a></li>
<li class="chapter" data-level="15.3" data-path="04-handling.html"><a href="#ggplot%E3%81%AE%E8%A7%A3%E8%AA%AC"><i class="fa fa-check"></i><b>15.3</b> ggplotの解説</a></li>
<li class="chapter" data-level="15.4" data-path="04-handling.html"><a href="#%E7%B5%B1%E8%A8%88%E5%AD%A6%E8%A8%88%E9%87%8F%E5%88%86%E6%9E%90%E3%82%92%E5%AD%A6%E3%81%B6"><i class="fa fa-check"></i><b>15.4</b> 統計学・計量分析を学ぶ</a></li>
<li class="chapter" data-level="15.5" data-path="04-handling.html"><a href="#%E7%B0%A1%E5%8D%98%E3%81%AB%E5%88%A9%E7%94%A8%E3%81%A7%E3%81%8D%E3%82%8B%E5%80%8B%E7%A5%A8%E3%83%87%E3%83%BC%E3%82%BF"><i class="fa fa-check"></i><b>15.5</b> 簡単に利用できる個票データ</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Rによる社会調査データ分析の手引き</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="handling" class="section level1 hasAnchor" number="4">
<h1><span class="header-section-number">Chapter 4</span> データの加工<a href="handling.html#handling" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>この章ではデータの加工方法について説明する。</p>
<p>内容に入る前にいくつか確認しておこう。</p>
<p>第1に、右上のプロジェクトのボックスの横が、<a href="preparation.html#preparation">第2章</a>で作成したプロジェクトの名前（たとえば、seminar_sociology_r）になっているかどうかを確認しておこう。なっていない場合は、右上のボックスをクリックして、「Open Project…」を選択し、前章で作成したRprojファイル（たとえば、seminar_sociology_r.Rprojといったような名前になっている）を選んで、プロジェクトを切り替えよう。</p>
<p>第2に、<a href="import.html#import">第3章</a>で確認したとおり、データを格納するためのフォルダがプロジェクトフォルダ内に準備されていることを確認しよう。作っていない場合には、<a href="import.html#import_dir">データを置く場所を作る</a>を確認し、作成しておこう。</p>
<p>第3に、上記の準備をすませたうえで、以下のとおり<code>tidyverse</code>パッケージを読み込もう。</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="handling.html#cb32-1" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code></pre></div>
<div id="本資料で用いるデータ" class="section level2 hasAnchor" number="4.1">
<h2><span class="header-section-number">4.1</span> 本資料で用いるデータ<a href="#%E6%9C%AC%E8%B3%87%E6%96%99%E3%81%A7%E7%94%A8%E3%81%84%E3%82%8B%E3%83%87%E3%83%BC%E3%82%BF" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>本資料では基本的に、OECDが実施している国際成人力調査<a href="https://www.oecd.org/skills/piaac/">Programme for the International Assessment of Adult Competencies, PIAAC</a>の1st Cycle（2013年実施）の日本版データをサンプルデータとして使用する。</p>
<p>ダウンロード手順は以下のとおり。</p>
<ol style="list-style-type: decimal">
<li><a href="https://www.oecd.org/en/data/datasets/piaac-1st-cycle-database.html">PIAAC 1st Cycle Database</a>のページにアクセス</li>
<li>少し下にある”<strong>Download the datasets (Public Use Files)</strong>”をクリック</li>
<li>規約を読み、ページ下部の<strong>Next</strong>をクリック</li>
<li>「Name」「Institution/Organization」「Email Address」を入力し、「You acknowledge reading the Data Protection Notice and agreeing to comply with the Terms of Use」をクリック。</li>
<li>左列（“Cycle 1”）にあるJapanの”CSV”のリンクをクリックして、ファイルをダウンロードする</li>
<li>ダウンロードしたファイルを自分のPCの「data」のフォルダに入れる</li>
</ol>
<p>「data」のフォルダに入っていることを確認して、データを読み込む。このデータは少し特殊で、数値のほかに文字列などが入っている。そのため、すこしだけ特殊な処理をほどこしてデータを読み込むことにする。</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="handling.html#cb33-1" tabindex="-1"></a>piaac <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;data/prgjpnp1.csv&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb33-2"><a href="handling.html#cb33-2" tabindex="-1"></a>  <span class="fu">mutate_if</span>(is.character, as.numeric) <span class="sc">%&gt;%</span> <span class="co">#すべての文字列変数を小文字に変換</span></span>
<span id="cb33-3"><a href="handling.html#cb33-3" tabindex="-1"></a>  <span class="fu">rename_all</span>(<span class="at">.funs =</span> tolower) <span class="co">#すべての大文字を小文字に変換</span></span></code></pre></div>
<pre><code>## Rows: 5278 Columns: 1328
## ── Column specification ─────────────────────────────────────────────
## Delimiter: &quot;,&quot;
## chr (470): DISP_MAIN, B_Q01a3, B_Q01a3_C, B_Q01b, B_Q01c1, B_Q01c1_C, B_Q01c...
## dbl (656): CNTRYID, CNTRYID_E, SEQID, AGE_R, GENDER_R, DISP_CIBQ, A_N01_T, B...
## lgl (202): DISP_MAINWRC, D_Q16b_T, P901002R, P901002S, P904012R, P904012S, P...
## 
## ℹ Use `spec()` to retrieve the full column specification for this data.
## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<p>通常、SSJDAなどの機関を通して社会調査データをダウンロードしたときに文字列が入っていることはまれなので、あまり心配しなくてよい。</p>
</div>
<div id="パイプ演算子または" class="section level2 hasAnchor" number="4.2">
<h2><span class="header-section-number">4.2</span> パイプ演算子：%&gt;%または|&gt;<a href="#%E3%83%91%E3%82%A4%E3%83%97%E6%BC%94%E7%AE%97%E5%AD%90%E3%81%BE%E3%81%9F%E3%81%AF" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>本章以降は、<code>tidyverse</code>というパッケージに組み込まれたさまざまな関数を活用する。tidyverseの特徴の一つは、パイプ演算子（<code>%&gt;%</code>）を使って命令を書くという点である。</p>
<p>たとえば、読み込んだデータ（piaacとする）の中身を確認する<code>view()</code>コマンドを実行したい場合であれば、次のように書く。</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="handling.html#cb35-1" tabindex="-1"></a><span class="fu">view</span>(piaac) <span class="co"># piaacデータの中身を確認する</span></span>
<span id="cb35-2"><a href="handling.html#cb35-2" tabindex="-1"></a></span>
<span id="cb35-3"><a href="handling.html#cb35-3" tabindex="-1"></a>piaac <span class="sc">%&gt;%</span> <span class="fu">view</span>() <span class="co"># 上記と同じ意味</span></span></code></pre></div>
<p><code>%&gt;%</code> 演算子を改行して書いてもよい。</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="handling.html#cb36-1" tabindex="-1"></a>piaac <span class="sc">%&gt;%</span> <span class="co"># piaacデータフレームに対して、</span></span>
<span id="cb36-2"><a href="handling.html#cb36-2" tabindex="-1"></a>  <span class="fu">view</span>() <span class="co"># viewを実行する</span></span></code></pre></div>
<p>データの上からいくつかの行を見る<code>head()</code>コマンドであれば、次のように書くことができる：</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="handling.html#cb37-1" tabindex="-1"></a>piaac <span class="sc">%&gt;%</span> <span class="co"># piaacデータフレームに対して、</span></span>
<span id="cb37-2"><a href="handling.html#cb37-2" tabindex="-1"></a>  <span class="fu">head</span>() <span class="co"># headを実行</span></span></code></pre></div>
<pre><code>## # A tibble: 6 × 1,328
##   cntryid cntryid_e seqid age_r gender_r disp_cibq disp_main disp_mainwrc
##     &lt;dbl&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt; &lt;lgl&gt;       
## 1     392       392     1    45        2         1         1 NA          
## 2     392       392     2    48        1         1         1 NA          
## 3     392       392     3    47        1         1         1 NA          
## 4     392       392     4    58        1         1         1 NA          
## 5     392       392     5    29        2         1         1 NA          
## 6     392       392     6    35        2         1         1 NA          
## # ℹ 1,320 more variables: a_n01_t &lt;dbl&gt;, b_q01a &lt;dbl&gt;, b_q01a_t &lt;dbl&gt;,
## #   b_q01a3 &lt;dbl&gt;, b_q01a3_c &lt;dbl&gt;, b_q01b &lt;dbl&gt;, b_q01c1 &lt;dbl&gt;,
## #   b_q01c1_c &lt;dbl&gt;, b_q01c1_t &lt;dbl&gt;, b_q01c2 &lt;dbl&gt;, b_q01d &lt;dbl&gt;,
## #   b_d01d &lt;dbl&gt;, b_d01d_c &lt;dbl&gt;, b_q02a &lt;dbl&gt;, b_q02a_t1 &lt;dbl&gt;,
## #   b_q02a_t2 &lt;dbl&gt;, b_q02b &lt;dbl&gt;, b_q02b_c &lt;dbl&gt;, b_q02c &lt;dbl&gt;, b_q03a &lt;dbl&gt;,
## #   b_q03b &lt;dbl&gt;, b_q03b_c &lt;dbl&gt;, b_q03c1 &lt;dbl&gt;, b_q03c1_c &lt;dbl&gt;,
## #   b_q03c2 &lt;dbl&gt;, b_q03d &lt;dbl&gt;, b_d03d &lt;dbl&gt;, b_d03d_c &lt;dbl&gt;, b_q04a &lt;dbl&gt;, …</code></pre>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="handling.html#cb39-1" tabindex="-1"></a>piaac <span class="sc">%&gt;%</span> </span>
<span id="cb39-2"><a href="handling.html#cb39-2" tabindex="-1"></a>  <span class="fu">head</span>(<span class="at">n =</span> <span class="dv">3</span>) <span class="co"># 上から3行のみ表示</span></span></code></pre></div>
<pre><code>## # A tibble: 3 × 1,328
##   cntryid cntryid_e seqid age_r gender_r disp_cibq disp_main disp_mainwrc
##     &lt;dbl&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt; &lt;lgl&gt;       
## 1     392       392     1    45        2         1         1 NA          
## 2     392       392     2    48        1         1         1 NA          
## 3     392       392     3    47        1         1         1 NA          
## # ℹ 1,320 more variables: a_n01_t &lt;dbl&gt;, b_q01a &lt;dbl&gt;, b_q01a_t &lt;dbl&gt;,
## #   b_q01a3 &lt;dbl&gt;, b_q01a3_c &lt;dbl&gt;, b_q01b &lt;dbl&gt;, b_q01c1 &lt;dbl&gt;,
## #   b_q01c1_c &lt;dbl&gt;, b_q01c1_t &lt;dbl&gt;, b_q01c2 &lt;dbl&gt;, b_q01d &lt;dbl&gt;,
## #   b_d01d &lt;dbl&gt;, b_d01d_c &lt;dbl&gt;, b_q02a &lt;dbl&gt;, b_q02a_t1 &lt;dbl&gt;,
## #   b_q02a_t2 &lt;dbl&gt;, b_q02b &lt;dbl&gt;, b_q02b_c &lt;dbl&gt;, b_q02c &lt;dbl&gt;, b_q03a &lt;dbl&gt;,
## #   b_q03b &lt;dbl&gt;, b_q03b_c &lt;dbl&gt;, b_q03c1 &lt;dbl&gt;, b_q03c1_c &lt;dbl&gt;,
## #   b_q03c2 &lt;dbl&gt;, b_q03d &lt;dbl&gt;, b_d03d &lt;dbl&gt;, b_d03d_c &lt;dbl&gt;, b_q04a &lt;dbl&gt;, …</code></pre>
<p>ちなみに、Macであれば<code>Control + Shift + m</code>で、Windowsであれば<code>Ctrl + Shift + m</code>でパイプ演算子を出力することができる。パイプ演算子は多用するので、ショートカットキーは覚えておくとよい。</p>
<p>ちなみに、最近RStudioを新しくインストールした場合だと、上記のショートカットキーを入力すると<code>|&gt;</code>というコマンドが出力されるかもしれない。ふつうに使う分だと、どちらを使ってもとくに支障は生じない。試しに以下の2種類を実行して、どちらも同じものが出力されることを確かめてみよう。</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="handling.html#cb41-1" tabindex="-1"></a>piaac <span class="sc">|&gt;</span> </span>
<span id="cb41-2"><a href="handling.html#cb41-2" tabindex="-1"></a>  <span class="fu">head</span>(<span class="at">n =</span> <span class="dv">3</span>)</span></code></pre></div>
<pre><code>## # A tibble: 3 × 1,328
##   cntryid cntryid_e seqid age_r gender_r disp_cibq disp_main disp_mainwrc
##     &lt;dbl&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt; &lt;lgl&gt;       
## 1     392       392     1    45        2         1         1 NA          
## 2     392       392     2    48        1         1         1 NA          
## 3     392       392     3    47        1         1         1 NA          
## # ℹ 1,320 more variables: a_n01_t &lt;dbl&gt;, b_q01a &lt;dbl&gt;, b_q01a_t &lt;dbl&gt;,
## #   b_q01a3 &lt;dbl&gt;, b_q01a3_c &lt;dbl&gt;, b_q01b &lt;dbl&gt;, b_q01c1 &lt;dbl&gt;,
## #   b_q01c1_c &lt;dbl&gt;, b_q01c1_t &lt;dbl&gt;, b_q01c2 &lt;dbl&gt;, b_q01d &lt;dbl&gt;,
## #   b_d01d &lt;dbl&gt;, b_d01d_c &lt;dbl&gt;, b_q02a &lt;dbl&gt;, b_q02a_t1 &lt;dbl&gt;,
## #   b_q02a_t2 &lt;dbl&gt;, b_q02b &lt;dbl&gt;, b_q02b_c &lt;dbl&gt;, b_q02c &lt;dbl&gt;, b_q03a &lt;dbl&gt;,
## #   b_q03b &lt;dbl&gt;, b_q03b_c &lt;dbl&gt;, b_q03c1 &lt;dbl&gt;, b_q03c1_c &lt;dbl&gt;,
## #   b_q03c2 &lt;dbl&gt;, b_q03d &lt;dbl&gt;, b_d03d &lt;dbl&gt;, b_d03d_c &lt;dbl&gt;, b_q04a &lt;dbl&gt;, …</code></pre>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="handling.html#cb43-1" tabindex="-1"></a>piaac <span class="sc">%&gt;%</span> </span>
<span id="cb43-2"><a href="handling.html#cb43-2" tabindex="-1"></a>  <span class="fu">head</span>(<span class="at">n =</span> <span class="dv">3</span>)</span></code></pre></div>
<pre><code>## # A tibble: 3 × 1,328
##   cntryid cntryid_e seqid age_r gender_r disp_cibq disp_main disp_mainwrc
##     &lt;dbl&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt; &lt;lgl&gt;       
## 1     392       392     1    45        2         1         1 NA          
## 2     392       392     2    48        1         1         1 NA          
## 3     392       392     3    47        1         1         1 NA          
## # ℹ 1,320 more variables: a_n01_t &lt;dbl&gt;, b_q01a &lt;dbl&gt;, b_q01a_t &lt;dbl&gt;,
## #   b_q01a3 &lt;dbl&gt;, b_q01a3_c &lt;dbl&gt;, b_q01b &lt;dbl&gt;, b_q01c1 &lt;dbl&gt;,
## #   b_q01c1_c &lt;dbl&gt;, b_q01c1_t &lt;dbl&gt;, b_q01c2 &lt;dbl&gt;, b_q01d &lt;dbl&gt;,
## #   b_d01d &lt;dbl&gt;, b_d01d_c &lt;dbl&gt;, b_q02a &lt;dbl&gt;, b_q02a_t1 &lt;dbl&gt;,
## #   b_q02a_t2 &lt;dbl&gt;, b_q02b &lt;dbl&gt;, b_q02b_c &lt;dbl&gt;, b_q02c &lt;dbl&gt;, b_q03a &lt;dbl&gt;,
## #   b_q03b &lt;dbl&gt;, b_q03b_c &lt;dbl&gt;, b_q03c1 &lt;dbl&gt;, b_q03c1_c &lt;dbl&gt;,
## #   b_q03c2 &lt;dbl&gt;, b_q03d &lt;dbl&gt;, b_d03d &lt;dbl&gt;, b_d03d_c &lt;dbl&gt;, b_q04a &lt;dbl&gt;, …</code></pre>
<p>どちらを使うかは（ほぼ）好みの問題である<a href="#fn10" class="footnote-ref" id="fnref10"><sup>10</sup></a>。本資料では、たんに麦山が慣れているというきわめて個人的な理由で、<code>%&gt;%</code>を使うことにする。</p>
<p>デフォルトでショートカットキーで入力したときに<code>%&gt;%</code>と<code>|&gt;</code>のどちらが表示されるかは設定で変更することができる。具体的には次のようにする：Edit→Preferences…（ない場合は、Tools→Global options…）を選択する。以下の画面が開いたら、Codeを選択して、以下の「Use native pipe operator, |&gt; (requires R 4.1+)」のチェックを外すと、上記ショートカットキーを入力したときに<code>%&gt;%</code>が表示されるようになる。</p>
<p><img src="images/pipe.jpg" /></p>
</div>
<div id="データ加工のステップ" class="section level2 hasAnchor" number="4.3">
<h2><span class="header-section-number">4.3</span> データ加工のステップ<a href="#%E3%83%87%E3%83%BC%E3%82%BF%E5%8A%A0%E5%B7%A5%E3%81%AE%E3%82%B9%E3%83%86%E3%83%83%E3%83%97" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>いざデータを手に入れて読み込むことができたとしても、そこから分析に至るまでにはデータを加工して、分析の準備をしなくてはならない。このデータ加工は、大きく分けて以下の2つ（3つ）のステップからなる。</p>
<ul>
<li>変数の作成</li>
<li>サンプルの限定</li>
<li>データの追加（該当者のみ。たとえばパネルデータを作ったり、複数時点や複数の国のデータを合併して分析する場合。）</li>
</ul>
<p>データの加工を行う際には、書いているコードがそれぞれ上記3つの作業のうちどの作業に該当するのかを混同しないように注意する。</p>
<p>変数の作成とサンプルの限定とはそれぞれ次のような操作を指す。たとえば、以下のようなデータがあるとする。</p>
<pre><code>## # A tibble: 6 × 3
##      id    x1    x2
##   &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1     1     5     1
## 2     2     8     1
## 3     3     2     1
## 4     4     0     2
## 5     5     6     2
## 6     6     1     2</code></pre>
<p>「変数の作成」は、この元データを加工して、次のような<strong>列</strong>を追加する作業にあたる。</p>
<pre><code>## # A tibble: 6 × 5
##      id    x1    x2    x3 x4   
##   &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;
## 1     1     5     1   500 男性 
## 2     2     8     1   800 男性 
## 3     3     2     1   200 男性 
## 4     4     0     2     0 女性 
## 5     5     6     2   600 女性 
## 6     6     1     2   100 女性</code></pre>
<p>「サンプルの限定」は、データから一部の対象者だけを選ぶ、言い換えれば行を削除する作業にあたる。</p>
<pre><code>## # A tibble: 3 × 5
##      id    x1    x2    x3 x4   
##   &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;
## 1     1     5     1   500 男性 
## 2     2     8     1   800 男性 
## 3     5     6     2   600 女性</code></pre>
</div>
<div id="変数の作成" class="section level2 hasAnchor" number="4.4">
<h2><span class="header-section-number">4.4</span> 変数の作成<a href="#%E5%A4%89%E6%95%B0%E3%81%AE%E4%BD%9C%E6%88%90" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>データを読み込んだとしても、調査で尋ねられた回答（列）をそのまま使えることはまれで、無回答を示す番号（9など）が含まれていたり、数値が意図しているならびと逆向きになっていたりと、そのままでは使えないことが多い。このような場合には、回答を記録した列を加工して、自分で意図した変数へと変換していく必要がある。社会調査データの分析を行う場合、かなり多くの作業がこの「変数の作成」に使われることになる。</p>
<div id="変数の型カテゴリ変数と連続変数" class="section level3 hasAnchor" number="4.4.1">
<h3><span class="header-section-number">4.4.1</span> 変数の型（カテゴリ変数と連続変数）<a href="#%E5%A4%89%E6%95%B0%E3%81%AE%E5%9E%8B%E3%82%AB%E3%83%86%E3%82%B4%E3%83%AA%E5%A4%89%E6%95%B0%E3%81%A8%E9%80%A3%E7%B6%9A%E5%A4%89%E6%95%B0" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>変数は、その種類によって（大きく）<strong>カテゴリ変数（categorical variable）</strong>と<strong>連続変数（continuous variable）</strong>に分けることができる<a href="#fn11" class="footnote-ref" id="fnref11"><sup>11</sup></a>。</p>
<table>
<thead>
<tr class="header">
<th></th>
<th>カテゴリ変数の例</th>
<th>Rで扱うときの型</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>カテゴリ変数</td>
<td>性別、居住地域、職業など</td>
<td>factor</td>
</tr>
<tr class="even">
<td>連続変数</td>
<td>所得、幸福度など</td>
<td>numeric</td>
</tr>
</tbody>
</table>
<p>カテゴリ変数は、グループや属性といったように、足し算や引き算をしたり、平均値を取ったりといった操作に意味のない変数を指す。たとえば居住地域の場合は、「東京都」「京都府」といったふうな値が入っているだろう。この値の平均値というのは、そもそも定義することができない。</p>
<p>連続変数は、足し算や引き算をしたり平均値を取ったりといった操作に意味がある。たとえば所得の場合は、個々人は300万円だったり700万円だったりといった値を取るわけだが、平均値を取れば平均所得という意味のある値になる。</p>
<p>ものによっては、カテゴリ変数とも連続変数ともとれる変数もある。たとえば学歴は、「中学」「高校」「専門」「短大」「高専」「大学」「大学院」と分けるのであればカテゴリ変数であるが、教育年数（何年学校に通ったか）で測定する場合には、9, 12, 14, 16, 18などの値を取る連続変数とみなすことができる。カテゴリ変数とみなすべきか、連続変数とみなすべきかは先行研究での扱いや、問題関心に依存する。くわしくは「<a href="handling.html#handling-tips">変数の作成についてのtips</a>」を参照。</p>
<p>多くの場合、社会調査データの個票でははじめからこれらカテゴリ変数と連続変数が区別されているわけではない。たとえば性別であれば、「男性」であれば1、「女性」であれば2というふうな値が入っている。あるいは所得であれば、「0万円」であれば1、「0〜25万円」であれば2、というふうな値が入っている。また、質問に対する回答であれば、「そう思う」「どちらかといえばそう思う」「どちらかといえばそう思わない」「そう思わない」という選択肢にそれぞれ1、2、3、4、という値が割り当てられている。このように、便宜的に値が振られているさまざまな項目を、自分の目的に照らして適切な型や値へと加工していくことによって、分析に使えるようにしていく必要がある。</p>
</div>
<div id="新たな変数をつくるmutate" class="section level3 hasAnchor" number="4.4.2">
<h3><span class="header-section-number">4.4.2</span> 新たな変数をつくる：mutate()<a href="#%E6%96%B0%E3%81%9F%E3%81%AA%E5%A4%89%E6%95%B0%E3%82%92%E3%81%A4%E3%81%8F%E3%82%8Bmutate" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>データ加工の基本は、すでにある変数を書き換えたりして、自分の関心に即した新しい変数を作ることである。このときに使用するのが<code>mutate()</code>である。変数の加工を行うときには、ほとんどの場合この<code>mutate()</code>を使うことになる。以下に、いくつか簡単な例を挙げる。</p>
<div id="例1-もとの変数の内容をそのままコピーする" class="section level4 hasAnchor" number="4.4.2.1">
<h4><span class="header-section-number">4.4.2.1</span> 例1: もとの変数の内容をそのままコピーする<a href="#%E4%BE%8B1-%E3%82%82%E3%81%A8%E3%81%AE%E5%A4%89%E6%95%B0%E3%81%AE%E5%86%85%E5%AE%B9%E3%82%92%E3%81%9D%E3%81%AE%E3%81%BE%E3%81%BE%E3%82%B3%E3%83%94%E3%83%BC%E3%81%99%E3%82%8B" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>PIAACには、ボーナスの額を含めて、対象者の給与を時給換算した<code>earnhrbonus</code>という変数が含まれている。この変数をそのままコピーして、時給換算した賃金を表す変数<code>wage</code>を作成する。</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="handling.html#cb48-1" tabindex="-1"></a>piaac <span class="sc">%&gt;%</span> </span>
<span id="cb48-2"><a href="handling.html#cb48-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">wage =</span> earnhrbonus)</span></code></pre></div>
<p>このコードは、「<code>piaac</code>というデータフレームに<code>wage</code>という列を追加してね、ちなみにその列には（既存の列である）<code>earnhrbonus</code>の値を入れてね」という命令を表している。</p>
<p>ただしこれだけだと新たに列を追加した結果だけが表示されて、データフレームそのものは更新されることはない。そこで、次のようにして、列を追加した結果を新たなデータフレームに格納してみる。</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="handling.html#cb49-1" tabindex="-1"></a>piaac_new <span class="ot">&lt;-</span> piaac <span class="sc">%&gt;%</span> </span>
<span id="cb49-2"><a href="handling.html#cb49-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">wage =</span> earnhrbonus)</span></code></pre></div>
<p>すると、右側のEnvironmentのウインドウに新たに「piaac_new」というデータフレームが追加される。</p>
<p><img src="images/Rstudio_environment.png" /></p>
<p><code>piaac_new</code> というのが、新たに1つ列を追加したデータフレームである。</p>
<p>もしくは、次のように同じデータフレームに格納してもよい。</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="handling.html#cb50-1" tabindex="-1"></a>piaac <span class="ot">&lt;-</span> piaac <span class="sc">%&gt;%</span> </span>
<span id="cb50-2"><a href="handling.html#cb50-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">wage =</span> earnhrbonus)</span></code></pre></div>
<p>先ほど<code>piaac_new</code> というデータフレームに格納したのが「名前をつけて保存」に当たるとしたら、これは「上書き保存」に当たるようなイメージである。どちらでも、個人の好みに応じて使い分けるとよいだろう。</p>
<p>さて、上記の処理を行った結果、<code>piaac</code>というデータフレームには、<code>earnhrbonus</code>とまったく同じ値が含まれる<code>wage</code>という列が作られたことがわかる。</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="handling.html#cb51-1" tabindex="-1"></a>piaac <span class="sc">%&gt;%</span> </span>
<span id="cb51-2"><a href="handling.html#cb51-2" tabindex="-1"></a>  <span class="fu">select</span>(earnhrbonus, wage) <span class="sc">%&gt;%</span> <span class="co"># select()についてはこのあと解説があります</span></span>
<span id="cb51-3"><a href="handling.html#cb51-3" tabindex="-1"></a>  <span class="fu">head</span>()</span></code></pre></div>
<pre><code>## # A tibble: 6 × 2
##   earnhrbonus  wage
##         &lt;dbl&gt; &lt;dbl&gt;
## 1        793.  793.
## 2       1763. 1763.
## 3       2692. 2692.
## 4       2312. 2312.
## 5         NA    NA 
## 6       5192. 5192.</code></pre>
<p>もとの変数を何ら加工せずにそのまま使うとしても、元々の変数の名前がわかりやすいとはいえない名前になっていることはよくある（たとえば、<code>q31_3</code>、など）。このような場合には、今行ったように、その列が何の変数であるかがすぐに分かるように新たに名前を付けた列を作成すると、後から間違いが少なくなる。</p>
</div>
<div id="例2-もとの変数に何らかの計算を施す" class="section level4 hasAnchor" number="4.4.2.2">
<h4><span class="header-section-number">4.4.2.2</span> 例2: もとの変数に何らかの計算を施す<a href="#%E4%BE%8B2-%E3%82%82%E3%81%A8%E3%81%AE%E5%A4%89%E6%95%B0%E3%81%AB%E4%BD%95%E3%82%89%E3%81%8B%E3%81%AE%E8%A8%88%E7%AE%97%E3%82%92%E6%96%BD%E3%81%99" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>たとえば、時間あたり賃金を尋ねた変数<code>earnhrbonus</code>を1000で割って、単位を円ではなく千円としたいとする。このような場合には次のように計算する。</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="handling.html#cb53-1" tabindex="-1"></a>piaac <span class="ot">&lt;-</span> piaac <span class="sc">%&gt;%</span> </span>
<span id="cb53-2"><a href="handling.html#cb53-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">wage1000 =</span> earnhrbonus <span class="sc">/</span> <span class="dv">1000</span>)</span></code></pre></div>
<p>新しく作った列<code>workhour</code>は、たしかにもともとの変数を5で割った値になっていることがわかる。</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="handling.html#cb54-1" tabindex="-1"></a>piaac <span class="sc">%&gt;%</span> </span>
<span id="cb54-2"><a href="handling.html#cb54-2" tabindex="-1"></a>  <span class="fu">select</span>(earnhrbonus, wage1000) <span class="sc">%&gt;%</span> </span>
<span id="cb54-3"><a href="handling.html#cb54-3" tabindex="-1"></a>  <span class="fu">head</span>()</span></code></pre></div>
<pre><code>## # A tibble: 6 × 2
##   earnhrbonus wage1000
##         &lt;dbl&gt;    &lt;dbl&gt;
## 1        793.    0.793
## 2       1763.    1.76 
## 3       2692.    2.69 
## 4       2312.    2.31 
## 5         NA    NA    
## 6       5192.    5.19</code></pre>
<p>調査時点での就業状態（働いているか否か）を尋ねた項目<code>c_q01a</code>では、働いていれば1、そうでなければ2という値が入っている。これを変換して、働いていれば1、そうでなければ0となるような変数<code>work</code>を作ってみよう。</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="handling.html#cb56-1" tabindex="-1"></a>piaac <span class="ot">&lt;-</span> piaac <span class="sc">%&gt;%</span> </span>
<span id="cb56-2"><a href="handling.html#cb56-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">work =</span> <span class="dv">2</span> <span class="sc">-</span> c_q01a)</span></code></pre></div>
<p>新しく作った列<code>work</code>は、確かにもともとの変数の値が1であれば1、2であれば0となっていることがわかる。</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="handling.html#cb57-1" tabindex="-1"></a>piaac <span class="sc">%&gt;%</span> </span>
<span id="cb57-2"><a href="handling.html#cb57-2" tabindex="-1"></a>  <span class="fu">select</span>(c_q01a, work) <span class="sc">%&gt;%</span> </span>
<span id="cb57-3"><a href="handling.html#cb57-3" tabindex="-1"></a>  <span class="fu">head</span>()</span></code></pre></div>
<pre><code>## # A tibble: 6 × 2
##   c_q01a  work
##    &lt;dbl&gt; &lt;dbl&gt;
## 1      1     1
## 2      1     1
## 3      1     1
## 4      1     1
## 5      2     0
## 6      1     1</code></pre>
</div>
<div id="例3-もとの変数と関係なくまったく新しい変数を作成する" class="section level4 hasAnchor" number="4.4.2.3">
<h4><span class="header-section-number">4.4.2.3</span> 例3: もとの変数と関係なく、まったく新しい変数を作成する<a href="#%E4%BE%8B3-%E3%82%82%E3%81%A8%E3%81%AE%E5%A4%89%E6%95%B0%E3%81%A8%E9%96%A2%E4%BF%82%E3%81%AA%E3%81%8F%E3%81%BE%E3%81%A3%E3%81%9F%E3%81%8F%E6%96%B0%E3%81%97%E3%81%84%E5%A4%89%E6%95%B0%E3%82%92%E4%BD%9C%E6%88%90%E3%81%99%E3%82%8B" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>たとえば、以下のように1ずつ増える変数を作成することもできる。この変数を分析に直接使用するということはないが、通し番号が振ってあると何かと便利なことが多い。</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="handling.html#cb59-1" tabindex="-1"></a>piaac <span class="ot">&lt;-</span> piaac <span class="sc">%&gt;%</span> </span>
<span id="cb59-2"><a href="handling.html#cb59-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">id =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>())</span></code></pre></div>
<p><code>n()</code> はデータフレーム内の行数を返す関数。上記3つの例で作成した変数を並べてみよう：</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="handling.html#cb60-1" tabindex="-1"></a>piaac <span class="sc">%&gt;%</span> </span>
<span id="cb60-2"><a href="handling.html#cb60-2" tabindex="-1"></a>  <span class="fu">select</span>(id, wage, work) <span class="sc">%&gt;%</span> </span>
<span id="cb60-3"><a href="handling.html#cb60-3" tabindex="-1"></a>  <span class="fu">head</span>()</span></code></pre></div>
<pre><code>## # A tibble: 6 × 3
##      id  wage  work
##   &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1     1  793.     1
## 2     2 1763.     1
## 3     3 2692.     1
## 4     4 2312.     1
## 5     5   NA      0
## 6     6 5192.     1</code></pre>
</div>
</div>
<div id="条件の指定if_else" class="section level3 hasAnchor" number="4.4.3">
<h3><span class="header-section-number">4.4.3</span> 条件の指定：if_else()<a href="#%E6%9D%A1%E4%BB%B6%E3%81%AE%E6%8C%87%E5%AE%9Aif_else" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>実際に<code>mutate()</code>で既存の変数の値を書き換えたりする場合には、カテゴリをまとめたり、複数の変数を組み合わせて新しい変数を作成したりすることが多い。そこでよく使う関数が<code>if_else()</code>、<code>case_when()</code>、<code>factor()</code>の3つである。</p>
<div id="if_elseの説明" class="section level4 hasAnchor" number="4.4.3.1">
<h4><span class="header-section-number">4.4.3.1</span> if_else()の説明<a href="#if_else%E3%81%AE%E8%AA%AC%E6%98%8E" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><code>if_else()</code>は、条件を指定し、その条件に合う場合と合わない場合の値を返す関数。<code>if_else(条件, 条件に合う場合の値, 条件に合わない場合の値)</code>、というふうに使う。</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="handling.html#cb62-1" tabindex="-1"></a>piaac <span class="ot">&lt;-</span> piaac <span class="sc">%&gt;%</span> </span>
<span id="cb62-2"><a href="handling.html#cb62-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">gender =</span> <span class="fu">if_else</span>(gender_r <span class="sc">==</span> <span class="dv">1</span>, <span class="st">&quot;男性&quot;</span>, <span class="st">&quot;女性&quot;</span>))</span></code></pre></div>
<p>上記は、<code>gender</code>という列に対して、<code>gender_r</code>の列の値が1ならば”男性”、そうでないならば”女性”という文字列を入れてね、という命令である。</p>
<p>新しく変数を作ったときには、きちんとできているかどうかを逐一確認するのがよい。たとえば以下のように、古い変数と新しい変数の<a href="tabulate.html#tabulate">クロス集計表</a>を作ってみるのが良い方法だろう。</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="handling.html#cb63-1" tabindex="-1"></a>piaac <span class="sc">%&gt;%</span> </span>
<span id="cb63-2"><a href="handling.html#cb63-2" tabindex="-1"></a>  <span class="fu">with</span>(<span class="fu">table</span>(gender_r, gender))</span></code></pre></div>
<pre><code>##         gender
## gender_r 女性 男性
##        1    0 2517
##        2 2761    0</code></pre>
</div>
<div id="論理演算子の説明" class="section level4 hasAnchor" number="4.4.3.2">
<h4><span class="header-section-number">4.4.3.2</span> 論理演算子の説明<a href="#%E8%AB%96%E7%90%86%E6%BC%94%E7%AE%97%E5%AD%90%E3%81%AE%E8%AA%AC%E6%98%8E" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>上記の例のように、条件を指定するときには論理演算子というのを使用する。よく使う論理演算子の意味は次の通り。</p>
<table>
<colgroup>
<col width="22%" />
<col width="22%" />
<col width="22%" />
<col width="33%" />
</colgroup>
<thead>
<tr class="header">
<th>条件記号</th>
<th>意味</th>
<th>コード例</th>
<th>コード例の意味</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>==</code></td>
<td>等しい</td>
<td><code>age == 25</code></td>
<td>年齢が25に等しい</td>
</tr>
<tr class="even">
<td><code>!=</code></td>
<td>ではない</td>
<td><code>age != 25</code></td>
<td>年齢が25ではない</td>
</tr>
<tr class="odd">
<td><code>&gt;</code></td>
<td>より大きい</td>
<td><code>age &gt; 25</code></td>
<td>年齢が25より大きい</td>
</tr>
<tr class="even">
<td><code>&lt;</code></td>
<td>より小さい</td>
<td><code>age &lt; 25</code></td>
<td>年齢が25より小さい</td>
</tr>
<tr class="odd">
<td><code>&gt;=</code></td>
<td>以上</td>
<td><code>age &gt;= 25</code></td>
<td>年齢が25以上（25を含む）</td>
</tr>
<tr class="even">
<td><code>&lt;=</code></td>
<td>以下</td>
<td><code>age &lt;= 25</code></td>
<td>年齢が25以下（25を含む）</td>
</tr>
<tr class="odd">
<td><code>&amp;</code></td>
<td>かつ</td>
<td><code>age &gt;= 25 &amp; age &lt;= 54</code></td>
<td>年齢が25以上54以下</td>
</tr>
<tr class="even">
<td><code>|</code></td>
<td>または</td>
<td><code>age &lt; 35 | age &gt; 54</code></td>
<td>年齢が35より小さいまたは54より大きい</td>
</tr>
</tbody>
</table>
<p>以上、以下のときの不等号の位置（どちらも左側！）、等しいときには=ではなく==、などは間違えやすいので注意しよう。</p>
</div>
</div>
<div id="複数条件の指定case_when" class="section level3 hasAnchor" number="4.4.4">
<h3><span class="header-section-number">4.4.4</span> 複数条件の指定：case_when()<a href="#%E8%A4%87%E6%95%B0%E6%9D%A1%E4%BB%B6%E3%81%AE%E6%8C%87%E5%AE%9Acase_when" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><code>if_else()</code>の場合は条件節は一つだが、複数の条件を指定して、それぞれの条件に対応するときに特定の値を入れたい、というような時がある。このときには、複数条件を指定して値を書き換えるコマンドである、<code>case_when()</code>をつかうとよい。</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="handling.html#cb65-1" tabindex="-1"></a>piaac <span class="ot">&lt;-</span> piaac <span class="sc">%&gt;%</span> </span>
<span id="cb65-2"><a href="handling.html#cb65-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">agegroup =</span> <span class="fu">case_when</span>(</span>
<span id="cb65-3"><a href="handling.html#cb65-3" tabindex="-1"></a>    <span class="dv">25</span> <span class="sc">&lt;=</span> age_r <span class="sc">&amp;</span> age_r <span class="sc">&lt;=</span> <span class="dv">34</span> <span class="sc">~</span> <span class="st">&quot;25-34歳&quot;</span>,</span>
<span id="cb65-4"><a href="handling.html#cb65-4" tabindex="-1"></a>    <span class="dv">35</span> <span class="sc">&lt;=</span> age_r <span class="sc">&amp;</span> age_r <span class="sc">&lt;=</span> <span class="dv">44</span> <span class="sc">~</span> <span class="st">&quot;35-44歳&quot;</span>,</span>
<span id="cb65-5"><a href="handling.html#cb65-5" tabindex="-1"></a>    <span class="dv">45</span> <span class="sc">&lt;=</span> age_r <span class="sc">&amp;</span> age_r <span class="sc">&lt;=</span> <span class="dv">54</span> <span class="sc">~</span> <span class="st">&quot;45-54歳&quot;</span>,</span>
<span id="cb65-6"><a href="handling.html#cb65-6" tabindex="-1"></a>    <span class="dv">55</span> <span class="sc">&lt;=</span> age_r <span class="sc">&amp;</span> age_r <span class="sc">&lt;=</span> <span class="dv">64</span> <span class="sc">~</span> <span class="st">&quot;55-64歳&quot;</span></span>
<span id="cb65-7"><a href="handling.html#cb65-7" tabindex="-1"></a>    ))</span></code></pre></div>
<p>ちゃんとできたかを確認しよう。</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="handling.html#cb66-1" tabindex="-1"></a>piaac <span class="sc">%&gt;%</span> </span>
<span id="cb66-2"><a href="handling.html#cb66-2" tabindex="-1"></a>  <span class="fu">with</span>(<span class="fu">table</span>(age_r, agegroup))</span></code></pre></div>
<pre><code>##      agegroup
## age_r 25-34歳 35-44歳 45-54歳 55-64歳
##    16       0       0       0       0
##    17       0       0       0       0
##    18       0       0       0       0
##    19       0       0       0       0
##    20       0       0       0       0
##    21       0       0       0       0
##    22       0       0       0       0
##    23       0       0       0       0
##    24       0       0       0       0
##    25      70       0       0       0
##    26      86       0       0       0
##    27      83       0       0       0
##    28      77       0       0       0
##    29     104       0       0       0
##    30      86       0       0       0
##    31     105       0       0       0
##    32     106       0       0       0
##    33     106       0       0       0
##    34     110       0       0       0
##    35       0     126       0       0
##    36       0     124       0       0
##    37       0     123       0       0
##    38       0     144       0       0
##    39       0     133       0       0
##    40       0     128       0       0
##    41       0     110       0       0
##    42       0     116       0       0
##    43       0     127       0       0
##    44       0     111       0       0
##    45       0       0      93       0
##    46       0       0     119       0
##    47       0       0     114       0
##    48       0       0     110       0
##    49       0       0     109       0
##    50       0       0      85       0
##    51       0       0      97       0
##    52       0       0     102       0
##    53       0       0     110       0
##    54       0       0      98       0
##    55       0       0       0     103
##    56       0       0       0      95
##    57       0       0       0      88
##    58       0       0       0     133
##    59       0       0       0      98
##    60       0       0       0     136
##    61       0       0       0     138
##    62       0       0       0     132
##    63       0       0       0     143
##    64       0       0       0     145
##    65       0       0       0       0</code></pre>
<p>もともとのデータには年齢が16歳から65歳の人が含まれているが、先ほどのコードでは16歳から24歳、65歳の人が条件に含まれていなかったので、新しく作成した列である<code>agegroup</code>には該当するものがないという結果になっている。このようなケースには<code>NA</code>が与えられる。</p>
<p>実際、<code>NA</code>が与えられているかどうかを確認してみよう。以下のように<code>with(table())</code>にオプション<code>useNA = "always"</code>を指定することで、<code>NA</code>についても集計することができる。</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="handling.html#cb68-1" tabindex="-1"></a>piaac <span class="sc">%&gt;%</span> </span>
<span id="cb68-2"><a href="handling.html#cb68-2" tabindex="-1"></a>  <span class="fu">with</span>(<span class="fu">table</span>(age_r, agegroup, <span class="at">useNA =</span> <span class="st">&quot;always&quot;</span>))</span></code></pre></div>
<pre><code>##       agegroup
## age_r  25-34歳 35-44歳 45-54歳 55-64歳 &lt;NA&gt;
##   16         0       0       0       0  114
##   17         0       0       0       0   90
##   18         0       0       0       0   96
##   19         0       0       0       0   76
##   20         0       0       0       0   90
##   21         0       0       0       0   75
##   22         0       0       0       0   72
##   23         0       0       0       0   88
##   24         0       0       0       0   84
##   25        70       0       0       0    0
##   26        86       0       0       0    0
##   27        83       0       0       0    0
##   28        77       0       0       0    0
##   29       104       0       0       0    0
##   30        86       0       0       0    0
##   31       105       0       0       0    0
##   32       106       0       0       0    0
##   33       106       0       0       0    0
##   34       110       0       0       0    0
##   35         0     126       0       0    0
##   36         0     124       0       0    0
##   37         0     123       0       0    0
##   38         0     144       0       0    0
##   39         0     133       0       0    0
##   40         0     128       0       0    0
##   41         0     110       0       0    0
##   42         0     116       0       0    0
##   43         0     127       0       0    0
##   44         0     111       0       0    0
##   45         0       0      93       0    0
##   46         0       0     119       0    0
##   47         0       0     114       0    0
##   48         0       0     110       0    0
##   49         0       0     109       0    0
##   50         0       0      85       0    0
##   51         0       0      97       0    0
##   52         0       0     102       0    0
##   53         0       0     110       0    0
##   54         0       0      98       0    0
##   55         0       0       0     103    0
##   56         0       0       0      95    0
##   57         0       0       0      88    0
##   58         0       0       0     133    0
##   59         0       0       0      98    0
##   60         0       0       0     136    0
##   61         0       0       0     138    0
##   62         0       0       0     132    0
##   63         0       0       0     143    0
##   64         0       0       0     145    0
##   65         0       0       0       0   70
##   &lt;NA&gt;       0       0       0       0    0</code></pre>
</div>
<div id="カテゴリ変数へ変換factor" class="section level3 hasAnchor" number="4.4.5">
<h3><span class="header-section-number">4.4.5</span> カテゴリ変数へ変換：factor()<a href="#%E3%82%AB%E3%83%86%E3%82%B4%E3%83%AA%E5%A4%89%E6%95%B0%E3%81%B8%E5%A4%89%E6%8F%9Bfactor" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>PIAACには次のように、母親の最終学歴を尋ねた質問項目（j_q06b）がある。</p>
<table>
<thead>
<tr class="header">
<th>選択肢</th>
<th>調査票の番号</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>小学校・中学校</td>
<td>1</td>
</tr>
<tr class="even">
<td>高校（旧制の中学校、高校を含む）</td>
<td>2</td>
</tr>
<tr class="odd">
<td>専門学校、高等専門学校、短大、大学以上</td>
<td>3</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb70-1"><a href="handling.html#cb70-1" tabindex="-1"></a>piaac <span class="sc">%&gt;%</span> <span class="fu">with</span>(<span class="fu">table</span>(j_q06b))</span></code></pre></div>
<pre><code>## j_q06b
##    1    2    3 
## 1553 2303 1098</code></pre>
<p>この数値だけでは、何番が何を指しているのかよくわからない。そこで、この変数の値にそれぞれ名前を付けてカテゴリ変数（factor型）へと変換した変数<code>mothereduc</code>を作成する。</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="handling.html#cb72-1" tabindex="-1"></a>piaac <span class="ot">&lt;-</span> piaac <span class="sc">%&gt;%</span> </span>
<span id="cb72-2"><a href="handling.html#cb72-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">mothereduc =</span> <span class="fu">factor</span>(j_q06b,</span>
<span id="cb72-3"><a href="handling.html#cb72-3" tabindex="-1"></a>                              <span class="at">levels =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>,</span>
<span id="cb72-4"><a href="handling.html#cb72-4" tabindex="-1"></a>                              <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;初等教育&quot;</span>, <span class="st">&quot;中等教育&quot;</span>, <span class="st">&quot;高等教育&quot;</span>)))</span></code></pre></div>
<p>結果を確認：</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="handling.html#cb73-1" tabindex="-1"></a>piaac <span class="sc">%&gt;%</span> <span class="fu">with</span>(<span class="fu">table</span>(j_q06b, mothereduc))</span></code></pre></div>
<pre><code>##       mothereduc
## j_q06b 初等教育 中等教育 高等教育
##      1     1553        0        0
##      2        0     2303        0
##      3        0        0     1098</code></pre>
<p><code>if_else()</code>や<code>case_when()</code>を使って新しくカテゴリ変数を作るとき、カテゴリの順序が意図していたものとは違う順序になってしまうことがある。これは、文字列の場合はアルファベット順、日本語の場合はshift-jis順で並んでしまうことによる。</p>
<p>たとえば、1週間の労働時間（<code>d_q10</code>）に関する変数をもとに、次のように労働時間の長さ別に分けたカテゴリ変数を作成したいと思ったとする。</p>
<table>
<thead>
<tr class="header">
<th>d_q10</th>
<th>workhour_fct</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>35時間より短い</td>
<td>35時間未満</td>
</tr>
<tr class="even">
<td>35時間以上49時間以下</td>
<td>35-49時間</td>
</tr>
<tr class="odd">
<td>50時間以上59時間以下</td>
<td>50-59時間</td>
</tr>
<tr class="even">
<td>60時間以上</td>
<td>60時間以上</td>
</tr>
</tbody>
</table>
<p><code>case_when()</code> を使って作成すると、意図していた順序とは違ったバラバラの順番になってしまう。</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="handling.html#cb75-1" tabindex="-1"></a>piaac <span class="ot">&lt;-</span> piaac <span class="sc">%&gt;%</span> </span>
<span id="cb75-2"><a href="handling.html#cb75-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">workhour_fct =</span> <span class="fu">case_when</span>(</span>
<span id="cb75-3"><a href="handling.html#cb75-3" tabindex="-1"></a>    d_q10 <span class="sc">&lt;</span> <span class="dv">35</span> <span class="sc">~</span> <span class="st">&quot;35時間未満&quot;</span>,</span>
<span id="cb75-4"><a href="handling.html#cb75-4" tabindex="-1"></a>    d_q10 <span class="sc">&gt;=</span> <span class="dv">35</span> <span class="sc">&amp;</span> d_q10 <span class="sc">&lt;=</span> <span class="dv">49</span> <span class="sc">~</span> <span class="st">&quot;35-49時間&quot;</span>,</span>
<span id="cb75-5"><a href="handling.html#cb75-5" tabindex="-1"></a>    d_q10 <span class="sc">&gt;=</span> <span class="dv">50</span> <span class="sc">&amp;</span> d_q10 <span class="sc">&lt;=</span> <span class="dv">59</span> <span class="sc">~</span> <span class="st">&quot;50-59時間&quot;</span>,</span>
<span id="cb75-6"><a href="handling.html#cb75-6" tabindex="-1"></a>    d_q10 <span class="sc">&gt;=</span> <span class="dv">60</span> <span class="sc">~</span> <span class="st">&quot;60時間以上&quot;</span></span>
<span id="cb75-7"><a href="handling.html#cb75-7" tabindex="-1"></a>  ))</span>
<span id="cb75-8"><a href="handling.html#cb75-8" tabindex="-1"></a></span>
<span id="cb75-9"><a href="handling.html#cb75-9" tabindex="-1"></a>piaac <span class="sc">%&gt;%</span> <span class="fu">with</span>(<span class="fu">table</span>(workhour_fct))</span></code></pre></div>
<pre><code>## workhour_fct
##  35-49時間 35時間未満  50-59時間 60時間以上 
##       1848        960        648        396</code></pre>
<p>このような場合には、以下の2つの方法で順序を制御することができる。どちらを使っても良い。</p>
<div id="一度数値変数に変換し数値変数をカテゴリ変数に変換" class="section level4 hasAnchor" number="4.4.5.1">
<h4><span class="header-section-number">4.4.5.1</span> 一度数値変数に変換し、数値変数をカテゴリ変数に変換<a href="#%E4%B8%80%E5%BA%A6%E6%95%B0%E5%80%A4%E5%A4%89%E6%95%B0%E3%81%AB%E5%A4%89%E6%8F%9B%E3%81%97%E6%95%B0%E5%80%A4%E5%A4%89%E6%95%B0%E3%82%92%E3%82%AB%E3%83%86%E3%82%B4%E3%83%AA%E5%A4%89%E6%95%B0%E3%81%AB%E5%A4%89%E6%8F%9B" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>いったん数値の変数を挟んでから<code>factor()</code> を使って変数を作成することで、順番がばらばらになってしまうのを防ぐことができる。</p>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="handling.html#cb77-1" tabindex="-1"></a><span class="co"># 方法1</span></span>
<span id="cb77-2"><a href="handling.html#cb77-2" tabindex="-1"></a>piaac <span class="ot">&lt;-</span> piaac <span class="sc">%&gt;%</span> </span>
<span id="cb77-3"><a href="handling.html#cb77-3" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">workhour_fct =</span> <span class="fu">case_when</span>(</span>
<span id="cb77-4"><a href="handling.html#cb77-4" tabindex="-1"></a>    d_q10 <span class="sc">&lt;</span> <span class="dv">35</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb77-5"><a href="handling.html#cb77-5" tabindex="-1"></a>    d_q10 <span class="sc">&gt;=</span> <span class="dv">35</span> <span class="sc">&amp;</span> d_q10 <span class="sc">&lt;=</span> <span class="dv">49</span> <span class="sc">~</span> <span class="dv">2</span>,</span>
<span id="cb77-6"><a href="handling.html#cb77-6" tabindex="-1"></a>    d_q10 <span class="sc">&gt;=</span> <span class="dv">50</span> <span class="sc">&amp;</span> d_q10 <span class="sc">&lt;=</span> <span class="dv">59</span> <span class="sc">~</span> <span class="dv">3</span>,</span>
<span id="cb77-7"><a href="handling.html#cb77-7" tabindex="-1"></a>    d_q10 <span class="sc">&gt;=</span> <span class="dv">60</span> <span class="sc">~</span> <span class="dv">4</span></span>
<span id="cb77-8"><a href="handling.html#cb77-8" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span> </span>
<span id="cb77-9"><a href="handling.html#cb77-9" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">workhour_fct =</span> <span class="fu">factor</span>(workhour_fct,</span>
<span id="cb77-10"><a href="handling.html#cb77-10" tabindex="-1"></a>                               <span class="at">levels =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>,</span>
<span id="cb77-11"><a href="handling.html#cb77-11" tabindex="-1"></a>                               <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;35時間未満&quot;</span>, <span class="st">&quot;35-49時間&quot;</span>, <span class="st">&quot;50-59時間&quot;</span>, <span class="st">&quot;60時間以上&quot;</span>)))</span>
<span id="cb77-12"><a href="handling.html#cb77-12" tabindex="-1"></a></span>
<span id="cb77-13"><a href="handling.html#cb77-13" tabindex="-1"></a>piaac <span class="sc">%&gt;%</span> <span class="fu">with</span>(<span class="fu">table</span>(workhour_fct)) <span class="co"># 確認</span></span></code></pre></div>
<pre><code>## workhour_fct
## 35時間未満  35-49時間  50-59時間 60時間以上 
##        960       1848        648        396</code></pre>
</div>
<div id="fct_relevel" class="section level4 hasAnchor" number="4.4.5.2">
<h4><span class="header-section-number">4.4.5.2</span> fct_relevel()を使う<a href="handling.html#fct_relevel" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><code>fct_relevel()</code>は、文字列変数の値の順序を任意の順序に並び替えるコマンドである。<code>fct_relevel(変数, "値", "値",...)</code>のようなコードとなる。</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="handling.html#cb79-1" tabindex="-1"></a>piaac <span class="ot">&lt;-</span> piaac <span class="sc">%&gt;%</span> </span>
<span id="cb79-2"><a href="handling.html#cb79-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">workhour_fct =</span> <span class="fu">case_when</span>(</span>
<span id="cb79-3"><a href="handling.html#cb79-3" tabindex="-1"></a>    d_q10 <span class="sc">&lt;</span> <span class="dv">35</span> <span class="sc">~</span> <span class="st">&quot;35時間未満&quot;</span>,</span>
<span id="cb79-4"><a href="handling.html#cb79-4" tabindex="-1"></a>    d_q10 <span class="sc">&gt;=</span> <span class="dv">35</span> <span class="sc">&amp;</span> d_q10 <span class="sc">&lt;=</span> <span class="dv">49</span> <span class="sc">~</span> <span class="st">&quot;35-49時間&quot;</span>,</span>
<span id="cb79-5"><a href="handling.html#cb79-5" tabindex="-1"></a>    d_q10 <span class="sc">&gt;=</span> <span class="dv">50</span> <span class="sc">&amp;</span> d_q10 <span class="sc">&lt;=</span> <span class="dv">59</span> <span class="sc">~</span> <span class="st">&quot;50-59時間&quot;</span>,</span>
<span id="cb79-6"><a href="handling.html#cb79-6" tabindex="-1"></a>    d_q10 <span class="sc">&gt;=</span> <span class="dv">60</span> <span class="sc">~</span> <span class="st">&quot;60時間以上&quot;</span></span>
<span id="cb79-7"><a href="handling.html#cb79-7" tabindex="-1"></a>  ))</span>
<span id="cb79-8"><a href="handling.html#cb79-8" tabindex="-1"></a>piaac <span class="sc">%&gt;%</span> <span class="fu">with</span>(<span class="fu">table</span>(workhour_fct)) <span class="co"># 意図した順番とは違い、「35-49時間」が前に来てしまっている。。</span></span></code></pre></div>
<pre><code>## workhour_fct
##  35-49時間 35時間未満  50-59時間 60時間以上 
##       1848        960        648        396</code></pre>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="handling.html#cb81-1" tabindex="-1"></a>piaac <span class="ot">&lt;-</span> piaac <span class="sc">%&gt;%</span> </span>
<span id="cb81-2"><a href="handling.html#cb81-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">workhour_fct =</span> <span class="fu">fct_relevel</span>(workhour_fct,</span>
<span id="cb81-3"><a href="handling.html#cb81-3" tabindex="-1"></a>                                    <span class="st">&quot;35時間未満&quot;</span>,</span>
<span id="cb81-4"><a href="handling.html#cb81-4" tabindex="-1"></a>                                    <span class="st">&quot;35-49時間&quot;</span>,</span>
<span id="cb81-5"><a href="handling.html#cb81-5" tabindex="-1"></a>                                    <span class="st">&quot;50-59時間&quot;</span>,</span>
<span id="cb81-6"><a href="handling.html#cb81-6" tabindex="-1"></a>                                    <span class="st">&quot;60時間以上&quot;</span>))</span>
<span id="cb81-7"><a href="handling.html#cb81-7" tabindex="-1"></a></span>
<span id="cb81-8"><a href="handling.html#cb81-8" tabindex="-1"></a>piaac <span class="sc">%&gt;%</span> <span class="fu">with</span>(<span class="fu">table</span>(workhour_fct)) <span class="co"># 確認。確かに並びがかわっている。</span></span></code></pre></div>
<pre><code>## workhour_fct
## 35時間未満  35-49時間  50-59時間 60時間以上 
##        960       1848        648        396</code></pre>
</div>
</div>
<div id="必要な列のみ抽出select" class="section level3 hasAnchor" number="4.4.6">
<h3><span class="header-section-number">4.4.6</span> 必要な列のみ抽出：select()<a href="#%E5%BF%85%E8%A6%81%E3%81%AA%E5%88%97%E3%81%AE%E3%81%BF%E6%8A%BD%E5%87%BAselect" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>このコマンドは「変数の作成」の節で扱ったコマンドと比べるとやや特殊で、列を追加するのではなく、列を<strong>削除する</strong>という操作を行う。普通に分析をする限りは列を削除する必要はないが、一部の列だけを取り出してどのようになっているのかを確認したりしたいときなどに使う。</p>
<p>このときに使うコマンドが<code>select()</code>である。</p>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="handling.html#cb83-1" tabindex="-1"></a>piaac_sub <span class="ot">&lt;-</span> piaac <span class="sc">%&gt;%</span> </span>
<span id="cb83-2"><a href="handling.html#cb83-2" tabindex="-1"></a>  <span class="fu">select</span>(gender, wage) <span class="co">#gender, wageの列を抽出</span></span></code></pre></div>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="handling.html#cb84-1" tabindex="-1"></a>piaac_sub <span class="ot">&lt;-</span> piaac <span class="sc">%&gt;%</span> </span>
<span id="cb84-2"><a href="handling.html#cb84-2" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>gender, <span class="sc">-</span>wage) <span class="co">#gender, wage「以外」の列を抽出</span></span></code></pre></div>
</div>
</div>
<div id="handling-tips" class="section level2 hasAnchor" number="4.5">
<h2><span class="header-section-number">4.5</span> 変数の作成についてのtips<a href="handling.html#handling-tips" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="カテゴリをまとめる" class="section level3 hasAnchor" number="4.5.1">
<h3><span class="header-section-number">4.5.1</span> カテゴリをまとめる<a href="#%E3%82%AB%E3%83%86%E3%82%B4%E3%83%AA%E3%82%92%E3%81%BE%E3%81%A8%E3%82%81%E3%82%8B" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>たとえば、親の職業（階級）によって、対象者の学歴がどの程度異なるのかを知りたいとする。このとき、学歴を「中学」「高校」「短大高専」「大学大学院」という4つのカテゴリで定義しているとする。この場合には、たとえば「大学大学院」を1、それ以外を0とすることで、大学以上か大学未満か、という2値のカテゴリにする。</p>
<p>一つひとつのカテゴリに該当する人数が少ないときや、議論を単純化したいときに有効な方法といえる。</p>
</div>
<div id="複数の変数を組み合わせた変数を作る" class="section level3 hasAnchor" number="4.5.2">
<h3><span class="header-section-number">4.5.2</span> 複数の変数を組み合わせた変数を作る<a href="#%E8%A4%87%E6%95%B0%E3%81%AE%E5%A4%89%E6%95%B0%E3%82%92%E7%B5%84%E3%81%BF%E5%90%88%E3%82%8F%E3%81%9B%E3%81%9F%E5%A4%89%E6%95%B0%E3%82%92%E4%BD%9C%E3%82%8B" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>PIAACでは、父親および母親の学歴を「初等教育」「中等教育」「高等教育」の3つの選択肢から選ぶ形式で尋ねている。この項目をもとに、父親と母親のうちどちらか高い方のの学歴を採用して、親学歴に関する変数を作りたいとする。ただし、どちらかが欠損の場合には、わかっているほうの学歴を採用することとする。この場合の対応表は以下のとおり：</p>
<table>
<caption>父親学歴と母親学歴のうち高いほうをとって親学歴を作成する</caption>
<colgroup>
<col width="21%" />
<col width="21%" />
<col width="21%" />
<col width="21%" />
<col width="14%" />
</colgroup>
<thead>
<tr class="header">
<th></th>
<th>母親学歴</th>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>父親学歴</strong></td>
<td>1（初等教育）</td>
<td>2（中等教育）</td>
<td>3（高等教育）</td>
<td>NA</td>
</tr>
<tr class="even">
<td>1（初等教育）</td>
<td>初等教育</td>
<td>中等教育</td>
<td>高等教育</td>
<td>初等教育</td>
</tr>
<tr class="odd">
<td>2（中等教育）</td>
<td>中等教育</td>
<td>中等教育</td>
<td>高等教育</td>
<td>中等教育</td>
</tr>
<tr class="even">
<td>3（高等教育）</td>
<td>高等教育</td>
<td>高等教育</td>
<td>高等教育</td>
<td>高等教育</td>
</tr>
<tr class="odd">
<td>NA</td>
<td>初等教育</td>
<td>中等教育</td>
<td>高等教育</td>
<td>NA</td>
</tr>
</tbody>
</table>
<p>このようにやや複雑な変換に対しても<code>case_when()</code> が利用可能である。具体的には、以下のようにする。また、作成した変数にはやはり<code>factor()</code>をつかってカテゴリ変数（factor型）へ変換し、ラベルを付けておこう。</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="handling.html#cb85-1" tabindex="-1"></a>piaac <span class="ot">&lt;-</span> piaac <span class="sc">%&gt;%</span> </span>
<span id="cb85-2"><a href="handling.html#cb85-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">parenteduc =</span> <span class="fu">case_when</span>(</span>
<span id="cb85-3"><a href="handling.html#cb85-3" tabindex="-1"></a>    j_q07b <span class="sc">&gt;=</span> j_q06b <span class="sc">~</span> j_q07b,</span>
<span id="cb85-4"><a href="handling.html#cb85-4" tabindex="-1"></a>    j_q07b <span class="sc">&lt;</span> j_q06b <span class="sc">~</span> j_q06b,</span>
<span id="cb85-5"><a href="handling.html#cb85-5" tabindex="-1"></a>    <span class="fu">is.na</span>(j_q07b) <span class="sc">==</span> <span class="cn">TRUE</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(j_q06b) <span class="sc">==</span> <span class="cn">FALSE</span> <span class="sc">~</span> j_q06b,</span>
<span id="cb85-6"><a href="handling.html#cb85-6" tabindex="-1"></a>    <span class="fu">is.na</span>(j_q06b) <span class="sc">==</span> <span class="cn">TRUE</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(j_q07b) <span class="sc">==</span> <span class="cn">FALSE</span> <span class="sc">~</span> j_q07b</span>
<span id="cb85-7"><a href="handling.html#cb85-7" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span> </span>
<span id="cb85-8"><a href="handling.html#cb85-8" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">parenteduc =</span> <span class="fu">factor</span>(parenteduc,</span>
<span id="cb85-9"><a href="handling.html#cb85-9" tabindex="-1"></a>                             <span class="at">levels =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>,</span>
<span id="cb85-10"><a href="handling.html#cb85-10" tabindex="-1"></a>                             <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;初等教育&quot;</span>, <span class="st">&quot;中等教育&quot;</span>, <span class="st">&quot;高等教育&quot;</span>)))</span></code></pre></div>
</div>
<div id="均等な順序を仮定して連続変数とする" class="section level3 hasAnchor" number="4.5.3">
<h3><span class="header-section-number">4.5.3</span> 均等な順序を仮定して連続変数とする<a href="#%E5%9D%87%E7%AD%89%E3%81%AA%E9%A0%86%E5%BA%8F%E3%82%92%E4%BB%AE%E5%AE%9A%E3%81%97%E3%81%A6%E9%80%A3%E7%B6%9A%E5%A4%89%E6%95%B0%E3%81%A8%E3%81%99%E3%82%8B" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>ある程度均等な順序があると仮定できるならば、数値として扱うことを考えてみるとよい。JGSSでは、「現在の仕事にどの程度満足していますか」という質問（ST5JOB）で、仕事への満足度が尋ねられている。選択肢は「満足している」「どちらかといえば満足している」「どちらともいえない」「どちらかといえば不満である」「不満である」という5つから1つを選択する形式である（わからないや無回答もあるが（後述）、ここでは省略する）。このようなときには、以下のように数値を割り当てることで、値が高いほど満足していることを表す連続変数に見立てることができる。もちろん、選択肢間の間隔がどれも同じ1であるというのはあくまで仮定であり本当は違うかもしれないということには注意が必要だが、解釈はわかりやすくなるというメリットがある。</p>
<table>
<thead>
<tr class="header">
<th>選択肢</th>
<th>調査票上の番号</th>
<th>数値化例</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>満足している</td>
<td>1</td>
<td>5</td>
</tr>
<tr class="even">
<td>どちらかといえば満足している</td>
<td>2</td>
<td>4</td>
</tr>
<tr class="odd">
<td>どちらでもない</td>
<td>3</td>
<td>3</td>
</tr>
<tr class="even">
<td>どちらかといえば不満である</td>
<td>4</td>
<td>2</td>
</tr>
<tr class="odd">
<td>不満である</td>
<td>5</td>
<td>1</td>
</tr>
</tbody>
</table>
<p>以下のように架空のデータがあるとする（例なので実行する必要はない）。</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb86-1"><a href="handling.html#cb86-1" tabindex="-1"></a>jgss <span class="co">#元のデータ（架空例）</span></span></code></pre></div>
<pre><code>## # A tibble: 6 × 1
##   ST5JOB
##    &lt;dbl&gt;
## 1      1
## 2      5
## 3      4
## 4      2
## 5      1
## 6      3</code></pre>
<p>このデータの場合は、以下のようにして値を変えた変数を作成することができる（例なので実行する必要はない）。</p>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb88-1"><a href="handling.html#cb88-1" tabindex="-1"></a>jgss <span class="ot">&lt;-</span> jgss <span class="sc">%&gt;%</span> </span>
<span id="cb88-2"><a href="handling.html#cb88-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">jobsatis =</span> <span class="dv">6</span> <span class="sc">-</span> ST5JOB)</span>
<span id="cb88-3"><a href="handling.html#cb88-3" tabindex="-1"></a></span>
<span id="cb88-4"><a href="handling.html#cb88-4" tabindex="-1"></a>jgss</span></code></pre></div>
<pre><code>## # A tibble: 6 × 2
##   ST5JOB jobsatis
##    &lt;dbl&gt;    &lt;dbl&gt;
## 1      1        5
## 2      5        1
## 3      4        2
## 4      2        4
## 5      1        5
## 6      3        3</code></pre>
<p>なお、こうした扱いが認められるかどうかは扱う変数によって異なるので、先行研究での定義を参考にするとよい。たとえば今回のような仕事への満足度についてはおおむねこのような処理は認められているが、「中学」に1、「高校」に2、「短大高専」に3、「大学大学院」に4を振る、というような処理はあまり認められていない。しかしながら、受けた教育年数として、「中学」に9、「高校」に12、「短大高専」に14、「大学」に16、「大学院」に18（など）といった値を振ることはある程度認められている。このあたりは先行研究の操作化を参考にしつつ、最終的には自分たちの関心によって決めるとよいだろう。</p>
</div>
<div id="無回答非該当わからないなどをnaに" class="section level3 hasAnchor" number="4.5.4">
<h3><span class="header-section-number">4.5.4</span> 無回答、非該当、「わからない」などをNAに<a href="#%E7%84%A1%E5%9B%9E%E7%AD%94%E9%9D%9E%E8%A9%B2%E5%BD%93%E3%82%8F%E3%81%8B%E3%82%89%E3%81%AA%E3%81%84%E3%81%AA%E3%81%A9%E3%82%92na%E3%81%AB" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>JGSSでは「夫は外で働き、妻は家庭を守るべきだ」という意見に対して賛成か反対かを4つの選択肢を設けて尋ねている。ただし、この質問に（何らかの理由で）回答していない者もおり、そのような場合には9という値が便宜的に振られている。</p>
<p>この質問に対する回答を連続値とみなして集計したりしたいとする。このような場合、無回答の9という値は計算から除外したいので、9という値ではなくNAとしたい。</p>
<p>以下のように架空のデータがあるとする（例なので実行する必要はない）。</p>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb90-1"><a href="handling.html#cb90-1" tabindex="-1"></a>jgss <span class="co">#元のデータ（架空例）</span></span></code></pre></div>
<pre><code>## # A tibble: 6 × 1
##   Q4WWHHX
##     &lt;dbl&gt;
## 1       1
## 2       9
## 3       4
## 4       3
## 5       2
## 6       1</code></pre>
<p>以下のようにして9をNAに置き換えた変数を作成することができる（例なので実行する必要はない）。</p>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb92-1"><a href="handling.html#cb92-1" tabindex="-1"></a>jgss <span class="ot">&lt;-</span> jgss <span class="sc">%&gt;%</span> </span>
<span id="cb92-2"><a href="handling.html#cb92-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">genderrole =</span> <span class="fu">if_else</span>(Q4WWHHX <span class="sc">==</span> <span class="dv">9</span>, <span class="cn">NA</span>, Q4WWHHX))  <span class="co"># 9をNAに置換</span></span>
<span id="cb92-3"><a href="handling.html#cb92-3" tabindex="-1"></a></span>
<span id="cb92-4"><a href="handling.html#cb92-4" tabindex="-1"></a>jgss <span class="co">#変換後のデータ</span></span></code></pre></div>
<pre><code>## # A tibble: 6 × 2
##   Q4WWHHX genderrole
##     &lt;dbl&gt;      &lt;dbl&gt;
## 1       1          1
## 2       9         NA
## 3       4          4
## 4       3          3
## 5       2          2
## 6       1          1</code></pre>
<p>調査によってはこのように無回答やあるいは「わからない」という選択肢に対して便宜的に99という数字が振られていたり、非該当（たとえば結婚している人に対してのみ尋ねる質問の場合、結婚していない人はその質問に回答しない。このような場合には、回答対象ではないという意味で、非該当とされる）のケースに対して便宜的に8888や9999といったような数字が振られていることがある。このような場合にも同じようにNAに変換する。この作業を忘れて平均値などを計算するととんでもない間違いを犯してしまうことになるため、忘れないようにしっかりチェックしておきたい<a href="#fn12" class="footnote-ref" id="fnref12"><sup>12</sup></a>。</p>
<p>それぞれの値がそれぞれどのような意味に対応しているかは、社会調査データを取得した際に合わせて配布される対応表（コードブック、値ラベルなどともいう）を参照する。分析に用いる変数については平均値だけではなく、分布や実際の値、調査票の文言などをきちんとチェックしておき、ミスが起こらないようにしたい。</p>
</div>
<div id="カテゴリ変数の区間の中点をとって連続変数とする" class="section level3 hasAnchor" number="4.5.5">
<h3><span class="header-section-number">4.5.5</span> カテゴリ変数の区間の中点をとって連続変数とする<a href="#%E3%82%AB%E3%83%86%E3%82%B4%E3%83%AA%E5%A4%89%E6%95%B0%E3%81%AE%E5%8C%BA%E9%96%93%E3%81%AE%E4%B8%AD%E7%82%B9%E3%82%92%E3%81%A8%E3%81%A3%E3%81%A6%E9%80%A3%E7%B6%9A%E5%A4%89%E6%95%B0%E3%81%A8%E3%81%99%E3%82%8B" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>なんらかの区間をとって尋ねられている場合、その区間の中点をとって、連続変数とみなす。たとえば、日本家族社会学会が行っている2008年全国家族調査（NFRJ08）では、「あなたご自身…は、次にあげる…家事を現在どのくらいの頻度で行っていますか」という質問項目で、たとえば「食事の用意」について、以下のような選択肢で家事頻度を尋ねている。</p>
<table>
<thead>
<tr class="header">
<th>選択肢</th>
<th>調査票上の番号</th>
<th>数値化例</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ほぼ毎日（週6〜7回）</td>
<td>1</td>
<td>6.5</td>
</tr>
<tr class="even">
<td>1週間に4〜5回</td>
<td>2</td>
<td>4.5</td>
</tr>
<tr class="odd">
<td>1週間に2〜3回</td>
<td>3</td>
<td>2.5</td>
</tr>
<tr class="even">
<td>1週間に1回くらい</td>
<td>4</td>
<td>1</td>
</tr>
<tr class="odd">
<td>ほとんど行わない</td>
<td>5</td>
<td>0</td>
</tr>
</tbody>
</table>
<p>このような場合、週6〜7回という区間の中点をとって6.5、週4〜5回という区間の中点をとって4.5、、etcとすることで、1週間当たりの家事頻度を表す連続変数と見立てることができる。</p>
<p>こうした扱いがどの程度許容されるかについては、先行研究での定義を参照するとよい。</p>
<p>年収などもこうした区間で扱われることがあるが、この場合は中点を定義できない選択肢が設けられていることがある（例：2050万円以上）。こうした場合の扱いについては諸説あり、<a href="#domain_wage">こちら</a>にも少しそのことを記載している。</p>
</div>
</div>
<div id="をつなげてコマンドをまとめる" class="section level2 hasAnchor" number="4.6">
<h2><span class="header-section-number">4.6</span> %&gt;%をつなげてコマンドをまとめる<a href="#%E3%82%92%E3%81%A4%E3%81%AA%E3%81%92%E3%81%A6%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89%E3%82%92%E3%81%BE%E3%81%A8%E3%82%81%E3%82%8B" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>変数を作成する過程では、正しく変数を作れているかどうかを一つひとつ確認しながら進めていくことが必須である。しかし、正しく作成できたことが確認できたら、<code>with(table())</code>などを使って確認するコードは必ずしもスクリプトに残しておく必要はない。分析に使う変数が固まってきたら、変数を作成するためのコードを（ある程度）まとめておくと、コードがシンプルになってよいだろう。このようなときに、パイプ演算子を使った記法は有用である。</p>
<p>上記で作成した変数も含めて、本資料で使う変数をまとめて作成するためのコードを以下に記した。</p>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb94-1"><a href="handling.html#cb94-1" tabindex="-1"></a>piaac <span class="ot">&lt;-</span> piaac <span class="sc">%&gt;%</span> </span>
<span id="cb94-2"><a href="handling.html#cb94-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">id =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb94-3"><a href="handling.html#cb94-3" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">wage =</span> earnhrbonus) <span class="sc">%&gt;%</span> </span>
<span id="cb94-4"><a href="handling.html#cb94-4" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">logwage =</span> <span class="fu">log</span>(wage)) <span class="sc">%&gt;%</span> </span>
<span id="cb94-5"><a href="handling.html#cb94-5" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">gender =</span> <span class="fu">factor</span>(gender_r, <span class="at">level =</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">1</span>, <span class="at">label =</span> <span class="fu">c</span>(<span class="st">&quot;女性&quot;</span>,<span class="st">&quot;男性&quot;</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb94-6"><a href="handling.html#cb94-6" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">age =</span> age_r) <span class="sc">%&gt;%</span> </span>
<span id="cb94-7"><a href="handling.html#cb94-7" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">work =</span> <span class="dv">2</span> <span class="sc">-</span> c_q01a) <span class="sc">%&gt;%</span> </span>
<span id="cb94-8"><a href="handling.html#cb94-8" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">workhour =</span> d_q10) <span class="sc">%&gt;%</span> </span>
<span id="cb94-9"><a href="handling.html#cb94-9" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">workhour_fct =</span> <span class="fu">case_when</span>(</span>
<span id="cb94-10"><a href="handling.html#cb94-10" tabindex="-1"></a>    d_q10 <span class="sc">&lt;</span> <span class="dv">35</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb94-11"><a href="handling.html#cb94-11" tabindex="-1"></a>    d_q10 <span class="sc">&gt;=</span> <span class="dv">35</span> <span class="sc">&amp;</span> d_q10 <span class="sc">&lt;=</span> <span class="dv">49</span> <span class="sc">~</span> <span class="dv">2</span>,</span>
<span id="cb94-12"><a href="handling.html#cb94-12" tabindex="-1"></a>    d_q10 <span class="sc">&gt;=</span> <span class="dv">50</span> <span class="sc">&amp;</span> d_q10 <span class="sc">&lt;=</span> <span class="dv">59</span> <span class="sc">~</span> <span class="dv">3</span>,</span>
<span id="cb94-13"><a href="handling.html#cb94-13" tabindex="-1"></a>    d_q10 <span class="sc">&gt;=</span> <span class="dv">60</span> <span class="sc">~</span> <span class="dv">4</span></span>
<span id="cb94-14"><a href="handling.html#cb94-14" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span> </span>
<span id="cb94-15"><a href="handling.html#cb94-15" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">workhour_fct =</span> <span class="fu">factor</span>(workhour_fct,</span>
<span id="cb94-16"><a href="handling.html#cb94-16" tabindex="-1"></a>                               <span class="at">levels =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>,</span>
<span id="cb94-17"><a href="handling.html#cb94-17" tabindex="-1"></a>                               <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;35時間未満&quot;</span>, <span class="st">&quot;35-49時間&quot;</span>, <span class="st">&quot;50-59時間&quot;</span>, <span class="st">&quot;60時間以上&quot;</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb94-18"><a href="handling.html#cb94-18" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">educ =</span> <span class="fu">case_when</span>(</span>
<span id="cb94-19"><a href="handling.html#cb94-19" tabindex="-1"></a>    edcat8 <span class="sc">==</span> <span class="dv">1</span> <span class="sc">|</span> edcat8 <span class="sc">==</span> <span class="dv">2</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb94-20"><a href="handling.html#cb94-20" tabindex="-1"></a>    edcat8 <span class="sc">==</span> <span class="dv">3</span> <span class="sc">~</span> <span class="dv">2</span>,</span>
<span id="cb94-21"><a href="handling.html#cb94-21" tabindex="-1"></a>    edcat8 <span class="sc">==</span> <span class="dv">4</span> <span class="sc">|</span> edcat8 <span class="sc">==</span> <span class="dv">5</span> <span class="sc">~</span> <span class="dv">3</span>,</span>
<span id="cb94-22"><a href="handling.html#cb94-22" tabindex="-1"></a>    edcat8 <span class="sc">==</span> <span class="dv">6</span> <span class="sc">|</span> edcat8 <span class="sc">==</span> <span class="dv">7</span> <span class="sc">|</span> edcat8 <span class="sc">==</span> <span class="dv">8</span> <span class="sc">~</span> <span class="dv">4</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb94-23"><a href="handling.html#cb94-23" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">educ =</span> <span class="fu">factor</span>(educ, <span class="at">levels =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>,</span>
<span id="cb94-24"><a href="handling.html#cb94-24" tabindex="-1"></a>                       <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;中学&quot;</span>, <span class="st">&quot;高校&quot;</span>, <span class="st">&quot;短大高専&quot;</span>, <span class="st">&quot;大学大学院&quot;</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb94-25"><a href="handling.html#cb94-25" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">mothereduc =</span> <span class="fu">factor</span>(j_q06b,</span>
<span id="cb94-26"><a href="handling.html#cb94-26" tabindex="-1"></a>                             <span class="at">levels =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>,</span>
<span id="cb94-27"><a href="handling.html#cb94-27" tabindex="-1"></a>                             <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;初等教育&quot;</span>, <span class="st">&quot;中等教育&quot;</span>, <span class="st">&quot;高等教育&quot;</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb94-28"><a href="handling.html#cb94-28" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fathereduc =</span> <span class="fu">factor</span>(j_q07b,</span>
<span id="cb94-29"><a href="handling.html#cb94-29" tabindex="-1"></a>                             <span class="at">levels =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>,</span>
<span id="cb94-30"><a href="handling.html#cb94-30" tabindex="-1"></a>                             <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;初等教育&quot;</span>, <span class="st">&quot;中等教育&quot;</span>, <span class="st">&quot;高等教育&quot;</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb94-31"><a href="handling.html#cb94-31" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">parenteduc =</span> <span class="fu">case_when</span>(</span>
<span id="cb94-32"><a href="handling.html#cb94-32" tabindex="-1"></a>    j_q07b <span class="sc">&gt;=</span> j_q06b <span class="sc">~</span> j_q07b,</span>
<span id="cb94-33"><a href="handling.html#cb94-33" tabindex="-1"></a>    j_q07b <span class="sc">&lt;</span> j_q06b <span class="sc">~</span> j_q06b,</span>
<span id="cb94-34"><a href="handling.html#cb94-34" tabindex="-1"></a>    <span class="fu">is.na</span>(j_q07b) <span class="sc">==</span> <span class="cn">TRUE</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(j_q06b) <span class="sc">==</span> <span class="cn">FALSE</span> <span class="sc">~</span> j_q06b,</span>
<span id="cb94-35"><a href="handling.html#cb94-35" tabindex="-1"></a>    <span class="fu">is.na</span>(j_q06b) <span class="sc">==</span> <span class="cn">TRUE</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(j_q07b) <span class="sc">==</span> <span class="cn">FALSE</span> <span class="sc">~</span> j_q07b</span>
<span id="cb94-36"><a href="handling.html#cb94-36" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span> </span>
<span id="cb94-37"><a href="handling.html#cb94-37" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">parenteduc =</span> <span class="fu">factor</span>(parenteduc,</span>
<span id="cb94-38"><a href="handling.html#cb94-38" tabindex="-1"></a>                             <span class="at">levels =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>,</span>
<span id="cb94-39"><a href="handling.html#cb94-39" tabindex="-1"></a>                             <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;初等教育&quot;</span>, <span class="st">&quot;中等教育&quot;</span>, <span class="st">&quot;高等教育&quot;</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb94-40"><a href="handling.html#cb94-40" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">occupation =</span> <span class="fu">factor</span>(isco1c,</span>
<span id="cb94-41"><a href="handling.html#cb94-41" tabindex="-1"></a>                             <span class="at">levels =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">9</span>,</span>
<span id="cb94-42"><a href="handling.html#cb94-42" tabindex="-1"></a>                             <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;管理職&quot;</span>,<span class="st">&quot;専門職&quot;</span>,<span class="st">&quot;技術職・准専門職&quot;</span>,<span class="st">&quot;事務補助&quot;</span>,<span class="st">&quot;サービス・販売&quot;</span>,<span class="st">&quot;農林漁業&quot;</span>,<span class="st">&quot;技能工&quot;</span>,<span class="st">&quot;設備・機械運転・組立&quot;</span>,<span class="st">&quot;単純作業&quot;</span>)</span>
<span id="cb94-43"><a href="handling.html#cb94-43" tabindex="-1"></a>)) <span class="sc">%&gt;%</span> </span>
<span id="cb94-44"><a href="handling.html#cb94-44" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">numeracy =</span> pvnum1) <span class="sc">%&gt;%</span> </span>
<span id="cb94-45"><a href="handling.html#cb94-45" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ojt =</span> <span class="dv">2</span> <span class="sc">-</span> b_q12c) <span class="sc">%&gt;%</span> </span>
<span id="cb94-46"><a href="handling.html#cb94-46" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">health =</span> <span class="dv">6</span> <span class="sc">-</span> i_q08) <span class="sc">%&gt;%</span> </span>
<span id="cb94-47"><a href="handling.html#cb94-47" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">learning =</span> i_q04d) <span class="sc">%&gt;%</span> </span>
<span id="cb94-48"><a href="handling.html#cb94-48" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">readwork =</span> readwork) <span class="sc">%&gt;%</span> </span>
<span id="cb94-49"><a href="handling.html#cb94-49" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">numwork =</span> numwork)</span></code></pre></div>
<p>このようにして作成した変数のみを残したデータに、<code>piaac_variable</code>という名前をつけて、別途データフレームとして残しておこう。</p>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb95-1"><a href="handling.html#cb95-1" tabindex="-1"></a>piaac_variable <span class="ot">&lt;-</span> piaac <span class="sc">%&gt;%</span> </span>
<span id="cb95-2"><a href="handling.html#cb95-2" tabindex="-1"></a>  <span class="fu">select</span>(id, wage, logwage, gender, age, work, workhour, workhour_fct, educ, mothereduc, fathereduc, parenteduc, occupation, numeracy, ojt, health, learning, readwork, numwork)</span></code></pre></div>
</div>
<div id="handling_sample" class="section level2 hasAnchor" number="4.7">
<h2><span class="header-section-number">4.7</span> サンプルの限定<a href="handling.html#handling_sample" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>社会調査データを分析する場合、調査対象者をすべて分析対象に含めるわけではなく、年齢を限定したり、働いている人だけに限定したりといったふうに、分析対象を一部に限定することが多い。このときに使うコードや注意点について記す。</p>
<div id="該当するケースだけを残すfilter" class="section level3 hasAnchor" number="4.7.1">
<h3><span class="header-section-number">4.7.1</span> 該当するケースだけを残す：filter()<a href="#%E8%A9%B2%E5%BD%93%E3%81%99%E3%82%8B%E3%82%B1%E3%83%BC%E3%82%B9%E3%81%A0%E3%81%91%E3%82%92%E6%AE%8B%E3%81%99filter" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>関心によっては、若年の人だけ分析したいとか、高齢の人だけ分析したいとか、女性（男性）だけ分析したいというときがある。それ以外にも、使う変数にNAが含まれているケースをあらかじめ除外するということはふつうにある。このようなときには、<code>filter()</code>を使う。</p>
<p>性別（<code>gender</code>）が男性のケースのみを抽出し、抽出したデータに新しい名前（<code>piaac_male</code>）をつける場合には次のようにする。</p>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb96-1"><a href="handling.html#cb96-1" tabindex="-1"></a>piaac_male <span class="ot">&lt;-</span> piaac_variable <span class="sc">%&gt;%</span> </span>
<span id="cb96-2"><a href="handling.html#cb96-2" tabindex="-1"></a>  <span class="fu">filter</span>(gender <span class="sc">==</span> <span class="st">&quot;男性&quot;</span>)</span></code></pre></div>
<p>年齢が25歳以上34歳以下のケースのみを抽出し、抽出したデータに新しい名前（<code>piaac_young</code>）をつける。</p>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb97-1"><a href="handling.html#cb97-1" tabindex="-1"></a>piaac_young <span class="ot">&lt;-</span> piaac_variable <span class="sc">%&gt;%</span> </span>
<span id="cb97-2"><a href="handling.html#cb97-2" tabindex="-1"></a>  <span class="fu">filter</span>(age <span class="sc">&gt;=</span> <span class="dv">25</span> <span class="sc">&amp;</span> age <span class="sc">&lt;=</span> <span class="dv">34</span>)</span></code></pre></div>
<p>今回の資料では、「25歳以上64歳以下の有業者」に対象を限定する。そのため、次のように条件を指定する。作成したデータフレームは別途<code>piaac_sample</code>という名前をつけて保存しておくことにしよう。</p>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb98-1"><a href="handling.html#cb98-1" tabindex="-1"></a>piaac_sample <span class="ot">&lt;-</span> piaac_variable <span class="sc">%&gt;%</span> </span>
<span id="cb98-2"><a href="handling.html#cb98-2" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="dv">25</span> <span class="sc">&lt;=</span> age <span class="sc">&amp;</span> age <span class="sc">&lt;=</span> <span class="dv">64</span>) <span class="sc">%&gt;%</span> <span class="co"># 25歳以上64歳以下の個人を抽出</span></span>
<span id="cb98-3"><a href="handling.html#cb98-3" tabindex="-1"></a>  <span class="fu">filter</span>(work <span class="sc">==</span> <span class="dv">1</span>) <span class="co"># 働いている人をチュ出</span></span></code></pre></div>
</div>
<div id="欠損値の扱い" class="section level3 hasAnchor" number="4.7.2">
<h3><span class="header-section-number">4.7.2</span> 欠損値の扱い<a href="#%E6%AC%A0%E6%90%8D%E5%80%A4%E3%81%AE%E6%89%B1%E3%81%84" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>さて、上記のように分析対象を限定した。このデータに含まれる人数を確認してみる。<code>nrow()</code>を使うと、データフレーム（あるいはベクトル）の長さを調べることができる。</p>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb99-1"><a href="handling.html#cb99-1" tabindex="-1"></a>piaac_sample <span class="sc">%&gt;%</span> <span class="fu">nrow</span>()</span></code></pre></div>
<pre><code>## [1] 3330</code></pre>
<p>このように、3330行からなるデータであることがわかる。しかしながら、回答者がすべての質問について回答しているわけではなく、回答を拒否したり、当該質問項目の対象者に当てはまらない（非該当）ために、値が入っていない（NAとなっている）場合がある。今回の資料で用いる変数について、<code>NA</code>となっている回答がどの程度あるかをみてみよう。</p>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb101-1"><a href="handling.html#cb101-1" tabindex="-1"></a>piaac_sample <span class="sc">%&gt;%</span> <span class="fu">summary</span>()</span></code></pre></div>
<pre><code>##        id            wage              logwage        gender    
##  Min.   :   1   Min.   :     0.06   Min.   :-2.851   女性:1508  
##  1st Qu.:1310   1st Qu.:   937.50   1st Qu.: 6.843   男性:1822  
##  Median :2654   Median :  1445.09   Median : 7.276              
##  Mean   :2650   Mean   :  2027.32   Mean   : 7.311              
##  3rd Qu.:4008   3rd Qu.:  2224.38   3rd Qu.: 7.707              
##  Max.   :5278   Max.   :266666.67   Max.   :12.494              
##                 NA&#39;s   :464         NA&#39;s   :464                 
##       age             work      workhour          workhour_fct 
##  Min.   :25.00   Min.   :1   Min.   :  1.00   35時間未満: 721  
##  1st Qu.:36.00   1st Qu.:1   1st Qu.: 35.00   35-49時間 :1643  
##  Median :44.00   Median :1   Median : 40.00   50-59時間 : 590  
##  Mean   :44.66   Mean   :1   Mean   : 41.36   60時間以上: 368  
##  3rd Qu.:54.00   3rd Qu.:1   3rd Qu.: 50.00   NA&#39;s      :   8  
##  Max.   :64.00   Max.   :1   Max.   :112.00                    
##                              NA&#39;s   :8                         
##          educ         mothereduc      fathereduc      parenteduc  
##  中学      : 305   初等教育:1112   初等教育:1110   初等教育: 853  
##  高校      :1187   中等教育:1504   中等教育:1305   中等教育:1411  
##  短大高専  : 793   高等教育: 583   高等教育: 760   高等教育: 977  
##  大学大学院:1044   NA&#39;s    : 131   NA&#39;s    : 155   NA&#39;s    :  89  
##  NA&#39;s      :   1                                                  
##                                                                   
##                                                                   
##             occupation     numeracy          ojt             health     
##  サービス・販売  :712   Min.   :103.4   Min.   :0.0000   Min.   :1.000  
##  技術職・准専門職:532   1st Qu.:266.6   1st Qu.:0.0000   1st Qu.:2.000  
##  専門職          :512   Median :296.3   Median :0.0000   Median :3.000  
##  事務補助        :491   Mean   :293.6   Mean   :0.3459   Mean   :3.038  
##  技能工          :349   3rd Qu.:323.2   3rd Qu.:1.0000   3rd Qu.:4.000  
##  (Other)         :713   Max.   :440.9   Max.   :1.0000   Max.   :5.000  
##  NA&#39;s            : 21                                                   
##     learning        readwork          numwork       
##  Min.   :1.000   Min.   :-0.9555   Min.   :-0.0902  
##  1st Qu.:3.000   1st Qu.: 1.6390   1st Qu.: 1.2468  
##  Median :3.000   Median : 2.1992   Median : 1.7690  
##  Mean   :3.323   Mean   : 2.2236   Mean   : 1.9018  
##  3rd Qu.:4.000   3rd Qu.: 2.7557   3rd Qu.: 2.3693  
##  Max.   :5.000   Max.   : 7.0208   Max.   : 6.0499  
##  NA&#39;s   :1       NA&#39;s   :174       NA&#39;s   :420</code></pre>
<p><code>NA's</code>と書かれているのが、各変数でNAとなっている行の数である。項目によってはNAがない変数もあるし、たくさんNAがある変数もある。</p>
<p>NAが含まれている変数は分析の際に集計が面倒だったりして、色々と取り扱いが難しい。そこで、分析に使う変数にNAが含まれている行はサンプルから除外しておくと集計が楽になる。<code>filter()</code>を使って、educ, parenteduc, occupation, wageの4つの変数についてNAが含まれている行を除外したデータフレームを作成しよう。</p>
<div class="sourceCode" id="cb103"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb103-1"><a href="handling.html#cb103-1" tabindex="-1"></a>piaac_sample_nona <span class="ot">&lt;-</span> piaac_sample <span class="sc">%&gt;%</span> </span>
<span id="cb103-2"><a href="handling.html#cb103-2" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">is.na</span>(educ) <span class="sc">==</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb103-3"><a href="handling.html#cb103-3" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">is.na</span>(parenteduc) <span class="sc">==</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb103-4"><a href="handling.html#cb103-4" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">is.na</span>(occupation) <span class="sc">==</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb103-5"><a href="handling.html#cb103-5" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">is.na</span>(wage) <span class="sc">==</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<p><code>is.na()</code>は値がNAであれば<code>TRUE</code>、NAでなければ<code>FALSE</code>を返す関数である。<code>filter(is.na(educ) == FALSE)</code>とすると、educがNA<strong>ではない</strong>ケースだけを残してね、という命令になる。上記のコードを実行したあとの回答を再度チェックしてみよう：</p>
<div class="sourceCode" id="cb104"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb104-1"><a href="handling.html#cb104-1" tabindex="-1"></a>piaac_sample_nona <span class="sc">%&gt;%</span> <span class="fu">nrow</span>()</span></code></pre></div>
<pre><code>## [1] 2783</code></pre>
<div class="sourceCode" id="cb106"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb106-1"><a href="handling.html#cb106-1" tabindex="-1"></a>piaac_sample_nona <span class="sc">%&gt;%</span> <span class="fu">summary</span>()</span></code></pre></div>
<pre><code>##        id            wage              logwage        gender    
##  Min.   :   1   Min.   :     0.06   Min.   :-2.851   女性:1309  
##  1st Qu.:1306   1st Qu.:   940.00   1st Qu.: 6.846   男性:1474  
##  Median :2663   Median :  1445.09   Median : 7.276              
##  Mean   :2653   Mean   :  2040.36   Mean   : 7.315              
##  3rd Qu.:3987   3rd Qu.:  2240.80   3rd Qu.: 7.715              
##  Max.   :5278   Max.   :266666.67   Max.   :12.494              
##                                                                 
##       age             work      workhour          workhour_fct 
##  Min.   :25.00   Min.   :1   Min.   :  1.00   35時間未満: 610  
##  1st Qu.:35.00   1st Qu.:1   1st Qu.: 35.00   35-49時間 :1419  
##  Median :43.00   Median :1   Median : 40.00   50-59時間 : 490  
##  Mean   :43.95   Mean   :1   Mean   : 40.94   60時間以上: 264  
##  3rd Qu.:53.00   3rd Qu.:1   3rd Qu.: 50.00                    
##  Max.   :64.00   Max.   :1   Max.   :108.00                    
##                                                                
##          educ        mothereduc      fathereduc      parenteduc  
##  中学      :230   初等教育: 931   初等教育: 931   初等教育: 711  
##  高校      :972   中等教育:1305   中等教育:1141   中等教育:1228  
##  短大高専  :690   高等教育: 511   高等教育: 653   高等教育: 844  
##  大学大学院:891   NA&#39;s    :  36   NA&#39;s    :  58                  
##                                                                  
##                                                                  
##                                                                  
##             occupation     numeracy          ojt             health     
##  サービス・販売  :587   Min.   :127.3   Min.   :0.0000   Min.   :1.000  
##  事務補助        :450   1st Qu.:267.7   1st Qu.:0.0000   1st Qu.:2.000  
##  技術職・准専門職:445   Median :297.2   Median :0.0000   Median :3.000  
##  専門職          :425   Mean   :294.7   Mean   :0.3672   Mean   :3.046  
##  技能工          :272   3rd Qu.:324.0   3rd Qu.:1.0000   3rd Qu.:4.000  
##  管理職          :227   Max.   :440.9   Max.   :1.0000   Max.   :5.000  
##  (Other)         :377                                                   
##     learning        readwork          numwork       
##  Min.   :1.000   Min.   :-0.9555   Min.   :-0.0902  
##  1st Qu.:3.000   1st Qu.: 1.6240   1st Qu.: 1.2244  
##  Median :3.000   Median : 2.1789   Median : 1.7651  
##  Mean   :3.312   Mean   : 2.1966   Mean   : 1.9057  
##  3rd Qu.:4.000   3rd Qu.: 2.7169   3rd Qu.: 2.3798  
##  Max.   :5.000   Max.   : 7.0208   Max.   : 6.0499  
##                  NA&#39;s   :149       NA&#39;s   :365</code></pre>
<p>データの行数は先ほどよりも減っており、またwage, educ, occupationに含まれていたNA’sの表記が消えていることがわかる。</p>
<p>このように、変数に欠損が含まれるケースを除外するような処理の仕方をさして、<strong>リストワイズ削除 listwise delition</strong>という。</p>
<p>なお、欠損値があまりに多い場合には、何らかのデータ操作のミス、調査のうえでの何らかの問題、そのほかの理由が考えられる。欠損の数がどれくらいあるのか（<code>filter</code>で限定する前と後とではどれくらいデータに含まれる人数が減るのか）は、注意深く見ておくとよいだろう。</p>
</div>
<div id="外れ値の扱い" class="section level3 hasAnchor" number="4.7.3">
<h3><span class="header-section-number">4.7.3</span> 外れ値の扱い<a href="#%E5%A4%96%E3%82%8C%E5%80%A4%E3%81%AE%E6%89%B1%E3%81%84" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>上記のように欠損値を除いたサンプルを作成したあと、さらに考慮すべきは、外れ値の問題である。連続変数を分析に用いる場合、このような外れ値が結果に大きな影響をおよぼす場合がある。その一例として、時給換算した賃金について考えてみよう。この変数の分布をみると、常識的には理解しがたい高い値、あるいは低い値をとっているケースが存在することがわかる（ggplotの使い方については第5章で解説する）。たとえば以下のように、時間あたり賃金が極端に低かったり（300円未満など）、逆に極端に高かったり（20000円以上など）するケースが存在している。</p>
<div class="sourceCode" id="cb108"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb108-1"><a href="handling.html#cb108-1" tabindex="-1"></a>piaac_sample_nona <span class="sc">%&gt;%</span> </span>
<span id="cb108-2"><a href="handling.html#cb108-2" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> wage)) <span class="sc">+</span></span>
<span id="cb108-3"><a href="handling.html#cb108-3" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">100</span>) <span class="sc">+</span> </span>
<span id="cb108-4"><a href="handling.html#cb108-4" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="dv">0</span>, <span class="dv">800</span>)</span></code></pre></div>
<p><img src="seminar_doc_files/figure-html/unnamed-chunk-73-1.png" width="672" /></p>
<div class="sourceCode" id="cb109"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb109-1"><a href="handling.html#cb109-1" tabindex="-1"></a>piaac_sample_nona <span class="sc">%&gt;%</span> </span>
<span id="cb109-2"><a href="handling.html#cb109-2" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> wage)) <span class="sc">+</span></span>
<span id="cb109-3"><a href="handling.html#cb109-3" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">100</span>) <span class="sc">+</span> </span>
<span id="cb109-4"><a href="handling.html#cb109-4" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="dv">5000</span>, <span class="dv">100000</span>)</span></code></pre></div>
<p><img src="seminar_doc_files/figure-html/unnamed-chunk-74-1.png" width="672" /></p>
<p>このようなケースが発生する理由はいくつかあるのだが、分析上は、たとえば平均値を計算したりする場合に、これらの外れ値があることによって結果がこうした極端に高い・低い人によって大きく左右されるという問題がある。そこで、こうした極端に高いあるいは低いケースを除外することはしばしば有効になる。時給換算した賃金の場合にはたとえば、上位1%、下位1%のサンプルを除外するという処理を行うことが多い。このように上位1%、下位1%のサンプルを除外するときの方法について記す。</p>
<p>まず、<code>ntile()</code>関数を使って、賃金の分位数を表す変数を作成する。</p>
<div class="sourceCode" id="cb110"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb110-1"><a href="handling.html#cb110-1" tabindex="-1"></a>piaac_sample_nona <span class="ot">&lt;-</span> piaac_sample_nona <span class="sc">%&gt;%</span> </span>
<span id="cb110-2"><a href="handling.html#cb110-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">wage_tile =</span> <span class="fu">ntile</span>(wage, <span class="dv">100</span>))</span></code></pre></div>
<p>下位1%と上位1%のケースにはどこからどこまでの値が含まれているのかチェックしてみよう：</p>
<div class="sourceCode" id="cb111"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb111-1"><a href="handling.html#cb111-1" tabindex="-1"></a>piaac_sample_nona <span class="sc">%&gt;%</span> </span>
<span id="cb111-2"><a href="handling.html#cb111-2" tabindex="-1"></a>  <span class="fu">filter</span>(wage_tile <span class="sc">==</span> <span class="dv">1</span> <span class="sc">|</span> wage_tile <span class="sc">==</span> <span class="dv">100</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb111-3"><a href="handling.html#cb111-3" tabindex="-1"></a>  <span class="fu">group_by</span>(wage_tile) <span class="sc">%&gt;%</span> </span>
<span id="cb111-4"><a href="handling.html#cb111-4" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">min =</span> <span class="fu">min</span>(wage), </span>
<span id="cb111-5"><a href="handling.html#cb111-5" tabindex="-1"></a>            <span class="at">max =</span> <span class="fu">max</span>(wage))</span></code></pre></div>
<pre><code>## # A tibble: 2 × 3
##   wage_tile       min     max
##       &lt;int&gt;     &lt;dbl&gt;   &lt;dbl&gt;
## 1         1    0.0578    462.
## 2       100 9760.     266667.</code></pre>
<p>このように、下位1%には462円以下のケースが含まれ、上位1%には9760円以上のケースが含まれていることがわかる。これらのケースを除外して、分析に使用するためのサンプルを作ろう。</p>
<div class="sourceCode" id="cb113"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb113-1"><a href="handling.html#cb113-1" tabindex="-1"></a>piaac_sample_analytic <span class="ot">&lt;-</span> piaac_sample_nona <span class="sc">%&gt;%</span> </span>
<span id="cb113-2"><a href="handling.html#cb113-2" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="dv">2</span> <span class="sc">&lt;=</span> wage_tile <span class="sc">&amp;</span> wage_tile <span class="sc">&lt;=</span> <span class="dv">99</span>)</span></code></pre></div>
<p>このように極端に低いケースと極端に高いケースを除外することで、外れ値の影響を除いた賃金の分布を得ることができる。</p>
<div class="sourceCode" id="cb114"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb114-1"><a href="handling.html#cb114-1" tabindex="-1"></a>piaac_sample_analytic <span class="sc">%&gt;%</span> </span>
<span id="cb114-2"><a href="handling.html#cb114-2" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> wage)) <span class="sc">+</span></span>
<span id="cb114-3"><a href="handling.html#cb114-3" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">100</span>)</span></code></pre></div>
<p><img src="seminar_doc_files/figure-html/unnamed-chunk-79-1.png" width="672" /></p>
<p>このように、分析に連続変数を用いる場合には、外れ値がないかどうか、外れ値を含むことで結果が大きく変わってしまわないかをチェックしておく必要がある。</p>
</div>
<div id="分析用データを書き出す" class="section level3 hasAnchor" number="4.7.4">
<h3><span class="header-section-number">4.7.4</span> 分析用データを書き出す<a href="#%E5%88%86%E6%9E%90%E7%94%A8%E3%83%87%E3%83%BC%E3%82%BF%E3%82%92%E6%9B%B8%E3%81%8D%E5%87%BA%E3%81%99" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>上記のような手順を経て、ようやく分析することのできるデータを準備することができた。準備できたデータを、新しいデータとして保存しておこう。<code>readr::write_excel_csv()</code>を使うと、データフレームを<a href="import.html#import_rds">rds形式</a>で書き出すことができる。</p>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb115-1"><a href="handling.html#cb115-1" tabindex="-1"></a><span class="fu">write_rds</span>(piaac_sample_analytic, <span class="at">file =</span> <span class="st">&quot;data/piaac_sample_analytic.rds&quot;</span>)</span></code></pre></div>
<p>このように、元々のデータから種々のデータ加工を行い、分析のために使用することにしたデータは、元々のデータとは別に保存しておくことで、データの加工のプロセスとデータの分析のプロセスを明示的に分けることにつながり、エラーを減らすことができる。</p>
<p>以降では、このデータを使って分析を行っていく。</p>
</div>
</div>
<div id="発展データの追加" class="section level2 hasAnchor" number="4.8">
<h2><span class="header-section-number">4.8</span> 【発展】データの追加<a href="#%E7%99%BA%E5%B1%95%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AE%E8%BF%BD%E5%8A%A0" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>たとえば複数の社会調査データを合併したり、複数時点のデータを合併して時系列比較、あるいはパネルデータとして分析をしたいといったことがあるかもしれない。このような場合の処理について記しておく。</p>
<p>以下のような2つのデータがあるとする。</p>
<div class="sourceCode" id="cb116"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb116-1"><a href="handling.html#cb116-1" tabindex="-1"></a>df1</span></code></pre></div>
<pre><code>## # A tibble: 6 × 4
##      id    x1    x2 data  
##   &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; 
## 1     1     5     1 data 1
## 2     2     8     1 data 1
## 3     3     2     1 data 1
## 4     4     0     2 data 1
## 5     5     6     2 data 1
## 6     6     1     2 data 1</code></pre>
<div class="sourceCode" id="cb118"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb118-1"><a href="handling.html#cb118-1" tabindex="-1"></a>df2</span></code></pre></div>
<pre><code>## # A tibble: 4 × 4
##      id    x1    x2 data  
##   &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; 
## 1     7     9     2 data 2
## 2     8     4     1 data 2
## 3     9     0     2 data 2
## 4    10     2     1 data 2</code></pre>
<p>この2つのデータを合併したいときには、<code>dplyr::bind_rows()</code>を使う。</p>
<div class="sourceCode" id="cb120"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb120-1"><a href="handling.html#cb120-1" tabindex="-1"></a>df <span class="ot">&lt;-</span> df1 <span class="sc">%&gt;%</span> </span>
<span id="cb120-2"><a href="handling.html#cb120-2" tabindex="-1"></a>  <span class="fu">bind_rows</span>(df2) <span class="co"># df2を縦方向に結合</span></span></code></pre></div>
<p>これで、以下のように2つのデータを合併して行が増えたデータが得られる。</p>
<div class="sourceCode" id="cb121"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb121-1"><a href="handling.html#cb121-1" tabindex="-1"></a>df</span></code></pre></div>
<pre><code>## # A tibble: 10 × 4
##       id    x1    x2 data  
##    &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; 
##  1     1     5     1 data 1
##  2     2     8     1 data 1
##  3     3     2     1 data 1
##  4     4     0     2 data 1
##  5     5     6     2 data 1
##  6     6     1     2 data 1
##  7     7     9     2 data 2
##  8     8     4     1 data 2
##  9     9     0     2 data 2
## 10    10     2     1 data 2</code></pre>
</div>
<div id="演習問題" class="section level2 hasAnchor" number="4.9">
<h2><span class="header-section-number">4.9</span> 演習問題<a href="#%E6%BC%94%E7%BF%92%E5%95%8F%E9%A1%8C" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>上記コードをすべて実行して、<code>piaac_sample_analytic.rds</code>ファイルを作成したものとする。一度RStudioを閉じたうえで再度開き、以下のコードを実行してデータを読み込んで下さい。</p>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb123-1"><a href="handling.html#cb123-1" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb123-2"><a href="handling.html#cb123-2" tabindex="-1"></a>piaac <span class="ot">&lt;-</span> <span class="fu">read_rds</span>(<span class="st">&quot;data/piaac_sample_analytic.rds&quot;</span>)</span></code></pre></div>
<p>そのうえで、以下の問題に答えてください。</p>
<ol style="list-style-type: decimal">
<li>一週間の労働時間（<code>workhour</code>）に50をかけて、1年間の労働時間を表す変数（<code>yearlyworkhour</code>という名前をつけてください）を作成してください。</li>
<li>年齢（<code>age</code>）を25–44歳、45–64歳の2つのカテゴリに分けた変数（<code>agecat</code>という名前をつけてください）を作成してください。</li>
<li>主観的健康度（<code>health</code>）に対して、1ならば「とても悪い」、2ならば「悪い」、3ならば「どちらでもない」、4ならば「良い」、5ならば「とても良い」という値を割り当てたカテゴリ変数（<code>health_factor</code>という名前をつけてください）を作成してください。</li>
<li>学歴（<code>educ</code>）が「大学・大学院卒」のケースだけを抽出して、<code>piaac_univ</code>というデータフレームに格納してください。</li>
</ol>

</div>
</div>
<div class="footnotes">
<hr />
<ol start="10">
<li id="fn10"><p>実際にはわずかに違いがあるようである。参考）「<a href="https://speakerdeck.com/s_uryu/r-native-pipe?slide=15">R 4.1.0で導入された パイプ演算子 (|&gt;)の紹介 / r_native_pipe</a>」<a href="handling.html#fnref10" class="footnote-back">↩︎</a></p></li>
<li id="fn11"><p>テキストによっては前者を「質的変数」、後者を「量的変数」と表記しているものもある。しかしこの呼び方は「質的研究」「量的研究」などと混同しやすいうえ、その数を数えられるという意味では「質的変数」を「量的」に扱えるというよくわからない事態が生じる。そこでここでは一貫して「カテゴリ変数」「連続変数」と表記する。また、尺度水準（比例尺度、間隔尺度、順序尺度、名義尺度）について紹介しているテキストもあるが、これらを区別しても分析上あまり意味はないのでここでは扱わない。<a href="handling.html#fnref11" class="footnote-back">↩︎</a></p></li>
<li id="fn12"><p>実際、ある査読付き雑誌に掲載された論文が、売上高がわからないケースに対して付されていた88,888,888,888という値をNAにすることなく分析していたのではないか（実際、それをNAにすると分析の結果はまったく違うものになる）という<a href="https://doi.org/10.1177/0003122417714422">指摘</a>がなされたことがある。院生のころは「先行研究で言われていないような意外な結果が出たら、たいていはプログラムが間違っているものだ（だからちゃんとチェックしなさい）」とよく言われたものだった。<a href="handling.html#fnref12" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="import.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="descriptives.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
  "sharing": {
    "github": false,
    "facebook": true,
    "twitter": true,
    "linkedin": false,
    "weibo": false,
    "instapaper": false,
    "vk": false,
    "whatsapp": false,
    "all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
  },
  "fontsettings": {
    "theme": "white",
    "family": "sans",
    "size": 2
  },
  "edit": {
    "link": null,
    "text": null
  },
  "history": {
    "link": null,
    "text": null
  },
  "view": {
    "link": null,
    "text": null
  },
  "download": null,
  "search": {
    "engine": "fuse",
    "options": null
  },
  "toc": {
    "collapse": "subsection"
  }
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
