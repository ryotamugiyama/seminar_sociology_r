<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 4 データの加工 | 社会調査データ分析のためのRの手引き</title>
  <meta name="description" content="This is the document for the class Seminar in Sociology held in Department of Political Studies, Gakushuin University. Anyone can freely use this as reference." />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 4 データの加工 | 社会調査データ分析のためのRの手引き" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is the document for the class Seminar in Sociology held in Department of Political Studies, Gakushuin University. Anyone can freely use this as reference." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 4 データの加工 | 社会調査データ分析のためのRの手引き" />
  
  <meta name="twitter:description" content="This is the document for the class Seminar in Sociology held in Department of Political Studies, Gakushuin University. Anyone can freely use this as reference." />
  

<meta name="author" content="Ryota Mugiyama (Department of Political Studies, Gakushuin University)" />


<meta name="date" content="2022-02-16" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="import.html"/>
<link rel="next" href="descriptives.html"/>
<script src="libs/header-attrs-2.11/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">社会調査データ分析のためのRの手引き</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>まえがき</a></li>
<li class="chapter" data-level="1" data-path="plan.html"><a href="plan.html"><i class="fa fa-check"></i><b>1</b> 研究計画を立てる</a>
<ul>
<li class="chapter" data-level="1.1" data-path="plan.html"><a href="plan.html#研究計画とは"><i class="fa fa-check"></i><b>1.1</b> 研究計画とは</a></li>
<li class="chapter" data-level="1.2" data-path="plan.html"><a href="plan.html#研究背景"><i class="fa fa-check"></i><b>1.2</b> 研究背景</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="plan.html"><a href="plan.html#問題背景1段落程度"><i class="fa fa-check"></i><b>1.2.1</b> 問題背景（1段落程度）</a></li>
<li class="chapter" data-level="1.2.2" data-path="plan.html"><a href="plan.html#先行研究の整理13段落程度"><i class="fa fa-check"></i><b>1.2.2</b> 先行研究の整理（1–3段落程度）</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="plan.html"><a href="plan.html#研究目的問い"><i class="fa fa-check"></i><b>1.3</b> 研究目的・問い</a>
<ul>
<li class="chapter" data-level="1.3.1" data-path="plan.html"><a href="plan.html#研究目的問い12段落程度"><i class="fa fa-check"></i><b>1.3.1</b> 研究目的・問い（1–2段落程度）</a></li>
<li class="chapter" data-level="1.3.2" data-path="plan.html"><a href="plan.html#仮説1段落程度あれば"><i class="fa fa-check"></i><b>1.3.2</b> 仮説（1段落程度、あれば）</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="plan.html"><a href="plan.html#方法"><i class="fa fa-check"></i><b>1.4</b> 方法</a>
<ul>
<li class="chapter" data-level="1.4.1" data-path="plan.html"><a href="plan.html#データ"><i class="fa fa-check"></i><b>1.4.1</b> データ</a></li>
<li class="chapter" data-level="1.4.2" data-path="plan.html"><a href="plan.html#分析対象"><i class="fa fa-check"></i><b>1.4.2</b> 分析対象</a></li>
<li class="chapter" data-level="1.4.3" data-path="plan.html"><a href="plan.html#使用する変数"><i class="fa fa-check"></i><b>1.4.3</b> 使用する変数</a></li>
<li class="chapter" data-level="1.4.4" data-path="plan.html"><a href="plan.html#分析方法"><i class="fa fa-check"></i><b>1.4.4</b> 分析方法</a></li>
</ul></li>
<li class="chapter" data-level="1.5" data-path="plan.html"><a href="plan.html#参考文献"><i class="fa fa-check"></i><b>1.5</b> 参考文献</a></li>
<li class="chapter" data-level="1.6" data-path="plan.html"><a href="plan.html#使用する調査データの選定"><i class="fa fa-check"></i><b>1.6</b> 使用する調査データの選定</a>
<ul>
<li class="chapter" data-level="1.6.1" data-path="plan.html"><a href="plan.html#個票データとは何か"><i class="fa fa-check"></i><b>1.6.1</b> 個票データとは何か</a></li>
<li class="chapter" data-level="1.6.2" data-path="plan.html"><a href="plan.html#jgss"><i class="fa fa-check"></i><b>1.6.2</b> JGSS</a></li>
<li class="chapter" data-level="1.6.3" data-path="plan.html"><a href="plan.html#jgss以外の日本の社会調査"><i class="fa fa-check"></i><b>1.6.3</b> JGSS以外の日本の社会調査</a></li>
<li class="chapter" data-level="1.6.4" data-path="plan.html"><a href="plan.html#日本以外の社会調査データ"><i class="fa fa-check"></i><b>1.6.4</b> 日本以外の社会調査データ</a></li>
</ul></li>
<li class="chapter" data-level="1.7" data-path="plan.html"><a href="plan.html#先行研究を探す"><i class="fa fa-check"></i><b>1.7</b> 先行研究を探す</a>
<ul>
<li class="chapter" data-level="1.7.1" data-path="plan.html"><a href="plan.html#査読つき論文"><i class="fa fa-check"></i><b>1.7.1</b> 査読つき論文</a></li>
<li class="chapter" data-level="1.7.2" data-path="plan.html"><a href="plan.html#研究の流れをつかむ"><i class="fa fa-check"></i><b>1.7.2</b> 研究の流れをつかむ</a></li>
<li class="chapter" data-level="1.7.3" data-path="plan.html"><a href="plan.html#英語論文"><i class="fa fa-check"></i><b>1.7.3</b> 英語論文</a></li>
<li class="chapter" data-level="1.7.4" data-path="plan.html"><a href="plan.html#先行研究の重要性"><i class="fa fa-check"></i><b>1.7.4</b> 先行研究の重要性</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="preparation.html"><a href="preparation.html"><i class="fa fa-check"></i><b>2</b> RとRStudioの下準備</a>
<ul>
<li class="chapter" data-level="2.1" data-path="preparation.html"><a href="preparation.html#rとrstudioのインストール方法"><i class="fa fa-check"></i><b>2.1</b> RとRStudioのインストール方法</a></li>
<li class="chapter" data-level="2.2" data-path="preparation.html"><a href="preparation.html#データ分析のワークフロー"><i class="fa fa-check"></i><b>2.2</b> データ分析のワークフロー</a></li>
<li class="chapter" data-level="2.3" data-path="preparation.html"><a href="preparation.html#preparation_project"><i class="fa fa-check"></i><b>2.3</b> プロジェクトの作成</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="preparation.html"><a href="preparation.html#rstudioを開いてみよう"><i class="fa fa-check"></i><b>2.3.1</b> RStudioを開いてみよう</a></li>
<li class="chapter" data-level="2.3.2" data-path="preparation.html"><a href="preparation.html#授業用のフォルダを作ろう"><i class="fa fa-check"></i><b>2.3.2</b> 授業用のフォルダを作ろう</a></li>
<li class="chapter" data-level="2.3.3" data-path="preparation.html"><a href="preparation.html#ファイルパスと作業ディレクトリ"><i class="fa fa-check"></i><b>2.3.3</b> ファイルパスと作業ディレクトリ</a></li>
<li class="chapter" data-level="2.3.4" data-path="preparation.html"><a href="preparation.html#プロジェクト作成の手順"><i class="fa fa-check"></i><b>2.3.4</b> プロジェクト作成の手順</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="preparation.html"><a href="preparation.html#基本的な操作"><i class="fa fa-check"></i><b>2.4</b> 基本的な操作</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="preparation.html"><a href="preparation.html#スクリプトファイル"><i class="fa fa-check"></i><b>2.4.1</b> スクリプトファイル</a></li>
<li class="chapter" data-level="2.4.2" data-path="preparation.html"><a href="preparation.html#スクリプトファイルを保存する"><i class="fa fa-check"></i><b>2.4.2</b> スクリプトファイルを保存する</a></li>
<li class="chapter" data-level="2.4.3" data-path="preparation.html"><a href="preparation.html#パッケージのインストール"><i class="fa fa-check"></i><b>2.4.3</b> パッケージのインストール</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="preparation.html"><a href="preparation.html#データ読み込み以前のrの基礎"><i class="fa fa-check"></i><b>2.5</b> データ読み込み以前のRの基礎</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="import.html"><a href="import.html"><i class="fa fa-check"></i><b>3</b> データの読み込み</a>
<ul>
<li class="chapter" data-level="3.1" data-path="import.html"><a href="import.html#rのサンプルデータの読み込み"><i class="fa fa-check"></i><b>3.1</b> Rのサンプルデータの読み込み</a></li>
<li class="chapter" data-level="3.2" data-path="import.html"><a href="import.html#作業ディレクトリ上のデータの読み込み"><i class="fa fa-check"></i><b>3.2</b> 作業ディレクトリ上のデータの読み込み</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="import.html"><a href="import.html#import_dir"><i class="fa fa-check"></i><b>3.2.1</b> データを置く場所を作る</a></li>
<li class="chapter" data-level="3.2.2" data-path="import.html"><a href="import.html#csv形式のファイル"><i class="fa fa-check"></i><b>3.2.2</b> csv形式のファイル</a></li>
<li class="chapter" data-level="3.2.3" data-path="import.html"><a href="import.html#xlsx形式のファイル"><i class="fa fa-check"></i><b>3.2.3</b> xlsx形式のファイル</a></li>
<li class="chapter" data-level="3.2.4" data-path="import.html"><a href="import.html#import_rds"><i class="fa fa-check"></i><b>3.2.4</b> rds形式のファイル</a></li>
<li class="chapter" data-level="3.2.5" data-path="import.html"><a href="import.html#sav形式のファイル"><i class="fa fa-check"></i><b>3.2.5</b> sav形式のファイル</a></li>
<li class="chapter" data-level="3.2.6" data-path="import.html"><a href="import.html#dta形式のファイル"><i class="fa fa-check"></i><b>3.2.6</b> dta形式のファイル</a></li>
<li class="chapter" data-level="3.2.7" data-path="import.html"><a href="import.html#文字コードに関わる問題"><i class="fa fa-check"></i><b>3.2.7</b> 文字コードに関わる問題</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="import.html"><a href="import.html#ウェブ上のデータの読み込み"><i class="fa fa-check"></i><b>3.3</b> ウェブ上のデータの読み込み</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="handling.html"><a href="handling.html"><i class="fa fa-check"></i><b>4</b> データの加工</a>
<ul>
<li class="chapter" data-level="4.1" data-path="handling.html"><a href="handling.html#本資料で用いるデータ"><i class="fa fa-check"></i><b>4.1</b> 本資料で用いるデータ</a></li>
<li class="chapter" data-level="4.2" data-path="handling.html"><a href="handling.html#データ加工のステップ"><i class="fa fa-check"></i><b>4.2</b> データ加工のステップ</a></li>
<li class="chapter" data-level="4.3" data-path="handling.html"><a href="handling.html#変数の作成"><i class="fa fa-check"></i><b>4.3</b> 変数の作成</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="handling.html"><a href="handling.html#変数の型数値か文字列か"><i class="fa fa-check"></i><b>4.3.1</b> 変数の型（数値か、文字列か）</a></li>
<li class="chapter" data-level="4.3.2" data-path="handling.html"><a href="handling.html#新たな変数をつくるmutate"><i class="fa fa-check"></i><b>4.3.2</b> 新たな変数をつくる：mutate()</a></li>
<li class="chapter" data-level="4.3.3" data-path="handling.html"><a href="handling.html#条件の指定if_else"><i class="fa fa-check"></i><b>4.3.3</b> 条件の指定：if_else()</a></li>
<li class="chapter" data-level="4.3.4" data-path="handling.html"><a href="handling.html#複数条件の指定case_when"><i class="fa fa-check"></i><b>4.3.4</b> 複数条件の指定：case_when()</a></li>
<li class="chapter" data-level="4.3.5" data-path="handling.html"><a href="handling.html#カテゴリ変数へ変換factor"><i class="fa fa-check"></i><b>4.3.5</b> カテゴリ変数へ変換：factor()</a></li>
<li class="chapter" data-level="4.3.6" data-path="handling.html"><a href="handling.html#必要な列のみ抽出select"><i class="fa fa-check"></i><b>4.3.6</b> 必要な列のみ抽出：select()</a></li>
<li class="chapter" data-level="4.3.7" data-path="handling.html"><a href="handling.html#をつなげてコマンドをまとめる"><i class="fa fa-check"></i><b>4.3.7</b> %&gt;%をつなげてコマンドをまとめる</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="handling.html"><a href="handling.html#変数の作成についてのtips"><i class="fa fa-check"></i><b>4.4</b> 変数の作成についてのtips</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="handling.html"><a href="handling.html#カテゴリをまとめる"><i class="fa fa-check"></i><b>4.4.1</b> カテゴリをまとめる</a></li>
<li class="chapter" data-level="4.4.2" data-path="handling.html"><a href="handling.html#均等な順序を仮定して連続変数とする"><i class="fa fa-check"></i><b>4.4.2</b> 均等な順序を仮定して連続変数とする</a></li>
<li class="chapter" data-level="4.4.3" data-path="handling.html"><a href="handling.html#無回答非該当わからないなどをnaに"><i class="fa fa-check"></i><b>4.4.3</b> 無回答、非該当、「わからない」などをNAに</a></li>
<li class="chapter" data-level="4.4.4" data-path="handling.html"><a href="handling.html#カテゴリ変数の区間の中点をとって連続変数とする"><i class="fa fa-check"></i><b>4.4.4</b> カテゴリ変数の区間の中点をとって連続変数とする</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="handling.html"><a href="handling.html#handling_sample"><i class="fa fa-check"></i><b>4.5</b> サンプルの限定</a>
<ul>
<li class="chapter" data-level="4.5.1" data-path="handling.html"><a href="handling.html#該当するケースだけを残すfilter"><i class="fa fa-check"></i><b>4.5.1</b> 該当するケースだけを残す：filter()</a></li>
<li class="chapter" data-level="4.5.2" data-path="handling.html"><a href="handling.html#欠損値の扱い"><i class="fa fa-check"></i><b>4.5.2</b> 欠損値の扱い</a></li>
<li class="chapter" data-level="4.5.3" data-path="handling.html"><a href="handling.html#外れ値の扱い"><i class="fa fa-check"></i><b>4.5.3</b> 外れ値の扱い</a></li>
<li class="chapter" data-level="4.5.4" data-path="handling.html"><a href="handling.html#分析用データを書き出す"><i class="fa fa-check"></i><b>4.5.4</b> 分析用データを書き出す</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="handling.html"><a href="handling.html#データの追加複数のデータを合併し行を追加する該当者のみ"><i class="fa fa-check"></i><b>4.6</b> データの追加：複数のデータを合併し、行を追加する（該当者のみ）</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="descriptives.html"><a href="descriptives.html"><i class="fa fa-check"></i><b>5</b> 1変数の集計</a>
<ul>
<li class="chapter" data-level="5.1" data-path="descriptives.html"><a href="descriptives.html#連続変数を集計する"><i class="fa fa-check"></i><b>5.1</b> 連続変数を集計する</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="descriptives.html"><a href="descriptives.html#要約統計量の計算"><i class="fa fa-check"></i><b>5.1.1</b> 要約統計量の計算</a></li>
<li class="chapter" data-level="5.1.2" data-path="descriptives.html"><a href="descriptives.html#分布の可視化ヒストグラム"><i class="fa fa-check"></i><b>5.1.2</b> 分布の可視化：ヒストグラム</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="descriptives.html"><a href="descriptives.html#カテゴリ変数の集計"><i class="fa fa-check"></i><b>5.2</b> カテゴリ変数の集計</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="descriptives.html"><a href="descriptives.html#度数の確認"><i class="fa fa-check"></i><b>5.2.1</b> 度数の確認</a></li>
<li class="chapter" data-level="5.2.2" data-path="descriptives.html"><a href="descriptives.html#分布の可視化棒グラフ"><i class="fa fa-check"></i><b>5.2.2</b> 分布の可視化：棒グラフ</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="descriptives.html"><a href="descriptives.html#記述統計量の一覧表を作る"><i class="fa fa-check"></i><b>5.3</b> 記述統計量の一覧表を作る</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="descriptives.html"><a href="descriptives.html#変数にラベル名前をつける"><i class="fa fa-check"></i><b>5.3.1</b> 変数にラベル（名前）をつける</a></li>
<li class="chapter" data-level="5.3.2" data-path="descriptives.html"><a href="descriptives.html#連続変数は平均値標準偏差を表示する"><i class="fa fa-check"></i><b>5.3.2</b> 連続変数は平均値・標準偏差を表示する</a></li>
<li class="chapter" data-level="5.3.3" data-path="descriptives.html"><a href="descriptives.html#左上のヘッダーの編集"><i class="fa fa-check"></i><b>5.3.3</b> 左上のヘッダーの編集</a></li>
<li class="chapter" data-level="5.3.4" data-path="descriptives.html"><a href="descriptives.html#グループ別の記述統計量の一覧表"><i class="fa fa-check"></i><b>5.3.4</b> グループ別の記述統計量の一覧表</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="descriptives.html"><a href="descriptives.html#結果をファイルに書き出す"><i class="fa fa-check"></i><b>5.4</b> 結果をファイルに書き出す</a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="descriptives.html"><a href="descriptives.html#結果を入れるためのフォルダを作る"><i class="fa fa-check"></i><b>5.4.1</b> 結果を入れるためのフォルダを作る</a></li>
<li class="chapter" data-level="5.4.2" data-path="descriptives.html"><a href="descriptives.html#ggplotで作成した図を書き出す"><i class="fa fa-check"></i><b>5.4.2</b> ggplotで作成した図を書き出す</a></li>
<li class="chapter" data-level="5.4.3" data-path="descriptives.html"><a href="descriptives.html#記述統計の一覧表をwordに書き出す"><i class="fa fa-check"></i><b>5.4.3</b> 記述統計の一覧表をwordに書き出す</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="tabulate.html"><a href="tabulate.html"><i class="fa fa-check"></i><b>6</b> 2変数の集計</a>
<ul>
<li class="chapter" data-level="6.1" data-path="tabulate.html"><a href="tabulate.html#平均値の比較"><i class="fa fa-check"></i><b>6.1</b> 平均値の比較</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="tabulate.html"><a href="tabulate.html#基本"><i class="fa fa-check"></i><b>6.1.1</b> 基本</a></li>
<li class="chapter" data-level="6.1.2" data-path="tabulate.html"><a href="tabulate.html#棒グラフによる可視化"><i class="fa fa-check"></i><b>6.1.2</b> 棒グラフによる可視化</a></li>
<li class="chapter" data-level="6.1.3" data-path="tabulate.html"><a href="tabulate.html#複数カテゴリの組み合わせ"><i class="fa fa-check"></i><b>6.1.3</b> 複数カテゴリの組み合わせ</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="tabulate.html"><a href="tabulate.html#分布の比較"><i class="fa fa-check"></i><b>6.2</b> 分布の比較</a></li>
<li class="chapter" data-level="6.3" data-path="tabulate.html"><a href="tabulate.html#クロス集計"><i class="fa fa-check"></i><b>6.3</b> クロス集計</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="tabulate.html"><a href="tabulate.html#基本-1"><i class="fa fa-check"></i><b>6.3.1</b> 基本</a></li>
<li class="chapter" data-level="6.3.2" data-path="tabulate.html"><a href="tabulate.html#きれいなクロス表をつくる---gtsummarytbl_cross"><i class="fa fa-check"></i><b>6.3.2</b> きれいなクロス表をつくる - gtsummary::tbl_cross()</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="tabulate.html"><a href="tabulate.html#クロス集計表を図示する"><i class="fa fa-check"></i><b>6.4</b> クロス集計表を図示する</a></li>
<li class="chapter" data-level="6.5" data-path="tabulate.html"><a href="tabulate.html#散布図"><i class="fa fa-check"></i><b>6.5</b> 散布図</a>
<ul>
<li class="chapter" data-level="6.5.1" data-path="tabulate.html"><a href="tabulate.html#散布図をみる"><i class="fa fa-check"></i><b>6.5.1</b> 散布図をみる</a></li>
<li class="chapter" data-level="6.5.2" data-path="tabulate.html"><a href="tabulate.html#カテゴリごとに散布図を分ける"><i class="fa fa-check"></i><b>6.5.2</b> カテゴリごとに散布図を分ける</a></li>
<li class="chapter" data-level="6.5.3" data-path="tabulate.html"><a href="tabulate.html#相関係数"><i class="fa fa-check"></i><b>6.5.3</b> 相関係数</a></li>
</ul></li>
<li class="chapter" data-level="6.6" data-path="tabulate.html"><a href="tabulate.html#値が粗い連続変数を扱う"><i class="fa fa-check"></i><b>6.6</b> 値が粗い連続変数を扱う</a></li>
<li class="chapter" data-level="6.7" data-path="tabulate.html"><a href="tabulate.html#結果をファイルに書き出す-1"><i class="fa fa-check"></i><b>6.7</b> 結果をファイルに書き出す</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="regression_basic.html"><a href="regression_basic.html"><i class="fa fa-check"></i><b>7</b> 回帰分析の基礎</a>
<ul>
<li class="chapter" data-level="7.1" data-path="regression_basic.html"><a href="regression_basic.html#説明"><i class="fa fa-check"></i><b>7.1</b> 説明</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="regression_basic.html"><a href="regression_basic.html#散布図と回帰分析"><i class="fa fa-check"></i><b>7.1.1</b> 散布図と回帰分析</a></li>
<li class="chapter" data-level="7.1.2" data-path="regression_basic.html"><a href="regression_basic.html#回帰式の読み方"><i class="fa fa-check"></i><b>7.1.2</b> 回帰式の読み方</a></li>
<li class="chapter" data-level="7.1.3" data-path="regression_basic.html"><a href="regression_basic.html#母集団における関係の推測"><i class="fa fa-check"></i><b>7.1.3</b> 母集団における関係の推測</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="regression_basic.html"><a href="regression_basic.html#独立変数がカテゴリ変数の場合"><i class="fa fa-check"></i><b>7.2</b> 独立変数がカテゴリ変数の場合</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="regression_basic.html"><a href="regression_basic.html#値のカテゴリ"><i class="fa fa-check"></i><b>7.2.1</b> 2値のカテゴリ</a></li>
<li class="chapter" data-level="7.2.2" data-path="regression_basic.html"><a href="regression_basic.html#値以上のカテゴリ"><i class="fa fa-check"></i><b>7.2.2</b> 3値以上のカテゴリ</a></li>
<li class="chapter" data-level="7.2.3" data-path="regression_basic.html"><a href="regression_basic.html#変数がfactorであれば自動でカテゴリとして投入される"><i class="fa fa-check"></i><b>7.2.3</b> 変数がfactorであれば自動でカテゴリとして投入される</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="regression_basic.html"><a href="regression_basic.html#従属変数が2値のカテゴリ変数01の場合"><i class="fa fa-check"></i><b>7.3</b> 従属変数が2値のカテゴリ変数（0/1）の場合</a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="regression_basic.html"><a href="regression_basic.html#クロス集計と比較しながら結果をみる"><i class="fa fa-check"></i><b>7.3.1</b> クロス集計と比較しながら結果をみる</a></li>
<li class="chapter" data-level="7.3.2" data-path="regression_basic.html"><a href="regression_basic.html#散布図と比較しながら結果をみる"><i class="fa fa-check"></i><b>7.3.2</b> 散布図と比較しながら結果をみる</a></li>
<li class="chapter" data-level="7.3.3" data-path="regression_basic.html"><a href="regression_basic.html#注意点"><i class="fa fa-check"></i><b>7.3.3</b> 注意点</a></li>
<li class="chapter" data-level="7.3.4" data-path="regression_basic.html"><a href="regression_basic.html#発展ロバスト標準誤差"><i class="fa fa-check"></i><b>7.3.4</b> （発展）ロバスト標準誤差</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="regression_basic.html"><a href="regression_basic.html#非線形の関連"><i class="fa fa-check"></i><b>7.4</b> 非線形の関連</a>
<ul>
<li class="chapter" data-level="7.4.1" data-path="regression_basic.html"><a href="regression_basic.html#対数変換"><i class="fa fa-check"></i><b>7.4.1</b> 対数変換</a></li>
<li class="chapter" data-level="7.4.2" data-path="regression_basic.html"><a href="regression_basic.html#次関数型"><i class="fa fa-check"></i><b>7.4.2</b> 2次関数型</a></li>
<li class="chapter" data-level="7.4.3" data-path="regression_basic.html"><a href="regression_basic.html#回帰分析の結果をきれいに表示する"><i class="fa fa-check"></i><b>7.4.3</b> 回帰分析の結果をきれいに表示する</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="regression_basic.html"><a href="regression_basic.html#regression_basic_export"><i class="fa fa-check"></i><b>7.5</b> 結果をファイルに書き出す</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="regression_advanced.html"><a href="regression_advanced.html"><i class="fa fa-check"></i><b>8</b> 回帰分析の活用</a>
<ul>
<li class="chapter" data-level="8.1" data-path="regression_advanced.html"><a href="regression_advanced.html#重回帰分析"><i class="fa fa-check"></i><b>8.1</b> 重回帰分析</a></li>
<li class="chapter" data-level="8.2" data-path="regression_advanced.html"><a href="regression_advanced.html#交絡要因の統制"><i class="fa fa-check"></i><b>8.2</b> 交絡要因の統制</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="regression_advanced.html"><a href="regression_advanced.html#交絡とは何か"><i class="fa fa-check"></i><b>8.2.1</b> 交絡とは何か</a></li>
<li class="chapter" data-level="8.2.2" data-path="regression_advanced.html"><a href="regression_advanced.html#結果の比較と解釈"><i class="fa fa-check"></i><b>8.2.2</b> 結果の比較と解釈</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="regression_advanced.html"><a href="regression_advanced.html#媒介分析要因分解"><i class="fa fa-check"></i><b>8.3</b> 媒介分析／要因分解</a>
<ul>
<li class="chapter" data-level="8.3.1" data-path="regression_advanced.html"><a href="regression_advanced.html#なぜ関連が生じるのかを掘り下げる"><i class="fa fa-check"></i><b>8.3.1</b> なぜ関連が生じるのかを掘り下げる</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="regression_advanced.html"><a href="regression_advanced.html#回帰分析の実際"><i class="fa fa-check"></i><b>8.4</b> 回帰分析の実際</a></li>
<li class="chapter" data-level="8.5" data-path="regression_advanced.html"><a href="regression_advanced.html#結果をファイルに書き出す-2"><i class="fa fa-check"></i><b>8.5</b> 結果をファイルに書き出す</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="logit.html"><a href="logit.html"><i class="fa fa-check"></i><b>9</b> ロジスティック回帰分析（作成中）</a>
<ul>
<li class="chapter" data-level="9.1" data-path="logit.html"><a href="logit.html#従属変数が2値の場合の回帰分析---再確認"><i class="fa fa-check"></i><b>9.1</b> 従属変数が2値の場合の回帰分析 - 再確認</a></li>
<li class="chapter" data-level="9.2" data-path="logit.html"><a href="logit.html#ロジスティック回帰分析の考えかた"><i class="fa fa-check"></i><b>9.2</b> ロジスティック回帰分析の考えかた</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="logit.html"><a href="logit.html#オッズと対数オッズ"><i class="fa fa-check"></i><b>9.2.1</b> オッズと対数オッズ</a></li>
<li class="chapter" data-level="9.2.2" data-path="logit.html"><a href="logit.html#lpmとlogitの解釈の比較"><i class="fa fa-check"></i><b>9.2.2</b> LPMとLogitの解釈の比較</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="logit.html"><a href="logit.html#限界効果を計算する"><i class="fa fa-check"></i><b>9.3</b> 限界効果を計算する</a>
<ul>
<li class="chapter" data-level="9.3.1" data-path="logit.html"><a href="logit.html#平均限界効果average-marginal-effect"><i class="fa fa-check"></i><b>9.3.1</b> 平均限界効果（Average Marginal Effect）</a></li>
<li class="chapter" data-level="9.3.2" data-path="logit.html"><a href="logit.html#lpmとameの結果の比較"><i class="fa fa-check"></i><b>9.3.2</b> LPMとAMEの結果の比較</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="logit.html"><a href="logit.html#結果をファイルに書き出す-3"><i class="fa fa-check"></i><b>9.4</b> 結果をファイルに書き出す</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="domain.html"><a href="domain.html"><i class="fa fa-check"></i><b>10</b> 社会学のデータ分析でよくある処理</a>
<ul>
<li class="chapter" data-level="10.1" data-path="domain.html"><a href="domain.html#ssm職業小分類を大分類にまとめる"><i class="fa fa-check"></i><b>10.1</b> SSM職業小分類を大分類にまとめる</a>
<ul>
<li class="chapter" data-level="10.1.1" data-path="domain.html"><a href="domain.html#jgssの場合"><i class="fa fa-check"></i><b>10.1.1</b> JGSSの場合</a></li>
<li class="chapter" data-level="10.1.2" data-path="domain.html"><a href="domain.html#ssmの場合"><i class="fa fa-check"></i><b>10.1.2</b> SSMの場合</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="domain.html"><a href="domain.html#旧制学歴と新制学歴の対応"><i class="fa fa-check"></i><b>10.2</b> 旧制学歴と新制学歴の対応</a></li>
<li class="chapter" data-level="10.3" data-path="domain.html"><a href="domain.html#domain_wage"><i class="fa fa-check"></i><b>10.3</b> 年収と労働時間から時間給を作成する</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="writepaper.html"><a href="writepaper.html"><i class="fa fa-check"></i><b>11</b> 論文のまとめ方</a>
<ul>
<li class="chapter" data-level="11.1" data-path="writepaper.html"><a href="writepaper.html#全体の構成"><i class="fa fa-check"></i><b>11.1</b> 全体の構成</a></li>
<li class="chapter" data-level="11.2" data-path="writepaper.html"><a href="writepaper.html#タイトル"><i class="fa fa-check"></i><b>11.2</b> タイトル</a></li>
<li class="chapter" data-level="11.3" data-path="writepaper.html"><a href="writepaper.html#要約"><i class="fa fa-check"></i><b>11.3</b> 要約</a></li>
<li class="chapter" data-level="11.4" data-path="writepaper.html"><a href="writepaper.html#序論"><i class="fa fa-check"></i><b>11.4</b> 序論</a>
<ul>
<li class="chapter" data-level="11.4.1" data-path="writepaper.html"><a href="writepaper.html#問題背景1段落"><i class="fa fa-check"></i><b>11.4.1</b> 問題背景（1段落）</a></li>
<li class="chapter" data-level="11.4.2" data-path="writepaper.html"><a href="writepaper.html#先行研究の検討12段落"><i class="fa fa-check"></i><b>11.4.2</b> 先行研究の検討（1–2段落）</a></li>
<li class="chapter" data-level="11.4.3" data-path="writepaper.html"><a href="writepaper.html#研究目的12段落"><i class="fa fa-check"></i><b>11.4.3</b> 研究目的（1–2段落）</a></li>
<li class="chapter" data-level="11.4.4" data-path="writepaper.html"><a href="writepaper.html#本文の構成1段落任意"><i class="fa fa-check"></i><b>11.4.4</b> 本文の構成（1段落、任意）</a></li>
</ul></li>
<li class="chapter" data-level="11.5" data-path="writepaper.html"><a href="writepaper.html#先行研究理論枠組みあるいは仮説"><i class="fa fa-check"></i><b>11.5</b> 先行研究・理論枠組みあるいは仮説</a></li>
<li class="chapter" data-level="11.6" data-path="writepaper.html"><a href="writepaper.html#方法-1"><i class="fa fa-check"></i><b>11.6</b> 方法</a>
<ul>
<li class="chapter" data-level="11.6.1" data-path="writepaper.html"><a href="writepaper.html#データと分析対象"><i class="fa fa-check"></i><b>11.6.1</b> データと分析対象</a></li>
<li class="chapter" data-level="11.6.2" data-path="writepaper.html"><a href="writepaper.html#変数"><i class="fa fa-check"></i><b>11.6.2</b> 変数</a></li>
<li class="chapter" data-level="11.6.3" data-path="writepaper.html"><a href="writepaper.html#分析手法任意"><i class="fa fa-check"></i><b>11.6.3</b> 分析手法（任意）</a></li>
</ul></li>
<li class="chapter" data-level="11.7" data-path="writepaper.html"><a href="writepaper.html#結果"><i class="fa fa-check"></i><b>11.7</b> 結果</a>
<ul>
<li class="chapter" data-level="11.7.1" data-path="writepaper.html"><a href="writepaper.html#記述的分析"><i class="fa fa-check"></i><b>11.7.1</b> 記述的分析</a></li>
<li class="chapter" data-level="11.7.2" data-path="writepaper.html"><a href="writepaper.html#回帰分析"><i class="fa fa-check"></i><b>11.7.2</b> 回帰分析</a></li>
</ul></li>
<li class="chapter" data-level="11.8" data-path="writepaper.html"><a href="writepaper.html#結論"><i class="fa fa-check"></i><b>11.8</b> 結論</a>
<ul>
<li class="chapter" data-level="11.8.1" data-path="writepaper.html"><a href="writepaper.html#背景と目的の再確認1段落"><i class="fa fa-check"></i><b>11.8.1</b> 背景と目的の再確認（1段落）</a></li>
<li class="chapter" data-level="11.8.2" data-path="writepaper.html"><a href="writepaper.html#分析結果の要約と解釈23段落"><i class="fa fa-check"></i><b>11.8.2</b> 分析結果の要約と解釈（2–3段落）</a></li>
<li class="chapter" data-level="11.8.3" data-path="writepaper.html"><a href="writepaper.html#含意示唆12段落"><i class="fa fa-check"></i><b>11.8.3</b> 含意・示唆（1–2段落）</a></li>
<li class="chapter" data-level="11.8.4" data-path="writepaper.html"><a href="writepaper.html#課題限界1段落"><i class="fa fa-check"></i><b>11.8.4</b> 課題・限界（1段落）</a></li>
<li class="chapter" data-level="11.8.5" data-path="writepaper.html"><a href="writepaper.html#まとめ1段落任意"><i class="fa fa-check"></i><b>11.8.5</b> まとめ（1段落、任意）</a></li>
</ul></li>
<li class="chapter" data-level="11.9" data-path="writepaper.html"><a href="writepaper.html#謝辞"><i class="fa fa-check"></i><b>11.9</b> 謝辞</a></li>
<li class="chapter" data-level="11.10" data-path="writepaper.html"><a href="writepaper.html#参考文献-1"><i class="fa fa-check"></i><b>11.10</b> 参考文献</a></li>
<li class="chapter" data-level="11.11" data-path="writepaper.html"><a href="writepaper.html#形式上の注意事項"><i class="fa fa-check"></i><b>11.11</b> 形式上の注意事項</a>
<ul>
<li class="chapter" data-level="11.11.1" data-path="writepaper.html"><a href="writepaper.html#推奨するwordの設定"><i class="fa fa-check"></i><b>11.11.1</b> 推奨するWordの設定</a></li>
<li class="chapter" data-level="11.11.2" data-path="writepaper.html"><a href="writepaper.html#引用の形式"><i class="fa fa-check"></i><b>11.11.2</b> 引用の形式</a></li>
<li class="chapter" data-level="11.11.3" data-path="writepaper.html"><a href="writepaper.html#図表の形式"><i class="fa fa-check"></i><b>11.11.3</b> 図表の形式</a></li>
<li class="chapter" data-level="11.11.4" data-path="writepaper.html"><a href="writepaper.html#脚注"><i class="fa fa-check"></i><b>11.11.4</b> 脚注</a></li>
<li class="chapter" data-level="11.11.5" data-path="writepaper.html"><a href="writepaper.html#参考文献の記載例"><i class="fa fa-check"></i><b>11.11.5</b> 参考文献の記載例</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="12" data-path="reference.html"><a href="reference.html"><i class="fa fa-check"></i><b>12</b> さらなる学習のための参考文献</a>
<ul>
<li class="chapter" data-level="12.1" data-path="reference.html"><a href="reference.html#rの使い方"><i class="fa fa-check"></i><b>12.1</b> Rの使い方</a></li>
<li class="chapter" data-level="12.2" data-path="reference.html"><a href="reference.html#ggplotの解説"><i class="fa fa-check"></i><b>12.2</b> ggplotの解説</a></li>
<li class="chapter" data-level="12.3" data-path="reference.html"><a href="reference.html#統計学計量分析を学ぶ"><i class="fa fa-check"></i><b>12.3</b> 統計学・計量分析を学ぶ</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">社会調査データ分析のためのRの手引き</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="handling" class="section level1" number="4">
<h1><span class="header-section-number">Chapter 4</span> データの加工</h1>
<p>この章ではデータの加工方法について説明します。まずは以下のとおり<code>tidyverse</code>パッケージを読み込んでおきましょう。</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="handling.html#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code></pre></div>
<div id="本資料で用いるデータ" class="section level2" number="4.1">
<h2><span class="header-section-number">4.1</span> 本資料で用いるデータ</h2>
<p>ここでの説明は以下の各章とも関係します。</p>
<p>この資料では基本的に、OECDが実施している国際成人力調査<a href="https://www.oecd.org/skills/piaac/">Programme for the International Assessment of Adult Competencies, PIAAC</a>の日本版データをサンプルデータとして使用する。</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="handling.html#cb38-1" aria-hidden="true" tabindex="-1"></a>file_url <span class="ot">&lt;-</span> <span class="st">&quot;https://webfs.oecd.org/piaac/puf-data/CSV/prgjpnp1.csv&quot;</span></span>
<span id="cb38-2"><a href="handling.html#cb38-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-3"><a href="handling.html#cb38-3" aria-hidden="true" tabindex="-1"></a><span class="fu">download.file</span>(<span class="at">url =</span> file_url, <span class="at">destfile =</span> <span class="st">&quot;data/prgjpnp1.csv&quot;</span>)</span></code></pre></div>
<p>上記のコードだと、時間がかかってしまってダウンロードできないことがある。このような場合は、<a href="https://www.oecd.org/skills/piaac/data/">Data</a>のページから”Download the datasets (Public Use Files)” &gt; “csv” &gt; “prgjpnp1.csv”を選択して、ファイルをダウンロードしよう。</p>
<p>ダウンロードしたら、データを読み込む。このデータは少し特殊で、数値のほかに文字列などが入っている。そのため、すこしだけ特殊な処理をほどこしてデータを読み込むことにする。</p>
<p>通常、SSJDAなどの機関を通して社会調査データをダウンロードしたときに文字列が入っていることはまれなので、あまり心配しなくてよい。</p>
</div>
<div id="データ加工のステップ" class="section level2" number="4.2">
<h2><span class="header-section-number">4.2</span> データ加工のステップ</h2>
<p>いざデータを手に入れて読み込むことができたとしても、そこから分析に至るまでにはデータを加工して、分析の準備をしなくてはならない。このデータ加工は、大きく分けて以下の2つ（3つ）のステップからなる。</p>
<ul>
<li>変数の作成</li>
<li>サンプルの限定</li>
<li>データの追加（該当者のみ）</li>
</ul>
<p>データの加工を行う際には、今書いているコードがそれぞれ上記3つの作業のうちどの作業に該当するのかを混同しないように注意する。</p>
<p>変数の作成とサンプルの限定とはそれぞれ次のような操作を指す。たとえば、以下のようなデータがあるとする。</p>
<pre><code>## # A tibble: 6 × 3
##      id    x1    x2
##   &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1     1     5     1
## 2     2     8     1
## 3     3     2     1
## 4     4     0     2
## 5     5     6     2
## 6     6     1     2</code></pre>
<p>「変数の作成」では、この元データを加工して、次のような<strong>列</strong>を追加する作業にあたる。</p>
<pre><code>## # A tibble: 6 × 5
##      id    x1    x2    x3 x4   
##   &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;
## 1     1     5     1   500 男性 
## 2     2     8     1   800 男性 
## 3     3     2     1   200 男性 
## 4     4     0     2     0 女性 
## 5     5     6     2   600 女性 
## 6     6     1     2   100 女性</code></pre>
<p>「サンプルの限定」は、データから一部の対象者だけを選ぶ、言い換えれば行を削除する作業にあたる。</p>
<pre><code>## # A tibble: 3 × 5
##      id    x1    x2    x3 x4   
##   &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;
## 1     1     5     1   500 男性 
## 2     2     8     1   800 男性 
## 3     5     6     2   600 女性</code></pre>
</div>
<div id="変数の作成" class="section level2" number="4.3">
<h2><span class="header-section-number">4.3</span> 変数の作成</h2>
<p>データを読み込んだとしても、調査で尋ねられた回答（列）をそのまま使えることはまれで、無回答を示す番号（9など）が含まれていたり、数値が意図しているならびと逆向きになっていたりと、そのままでは使えないことが多い。このような場合には、回答を記録した列を加工して、自分で意図した変数へと変換していく必要がある。社会調査データの分析を行う場合、かなり多くの作業がこの「変数の作成」に使われることになる。</p>
<div id="変数の型数値か文字列か" class="section level3" number="4.3.1">
<h3><span class="header-section-number">4.3.1</span> 変数の型（数値か、文字列か）</h3>
<p>変数は、その種類によって（大きく）カテゴリ変数と量的変数に分けることができる。これを、「尺度水準」ということもある。</p>
<p>カテゴリ変数：性別、居住地域、職業など</p>
<p>量的変数：所得、幸福度など</p>
<p>カテゴリ変数は足し算引き算をしたり平均値を取ったりという操作にあまり意味はない。データによってはたとえば男性 = 1、女性 = 2のように（文字でなく）数値で記録されていることはよくある。これはあくまで便宜上の数値であって、数値であるから足し算とかをしてもよいというわけではない。</p>
<p>ものによっては、カテゴリ変数とも量的変数ともとれる変数もある。たとえば学歴は、「中学」「高校」「専門」「短大」「高専」「大学」「大学院」と分けるのであればカテゴリ変数であるが、教育年数（何年学校に通ったか）で測定する場合には、9, 12, 14, 16, 18などの値を取る量的変数とみなすことができる。カテゴリ変数とみなすべきか、量的変数とみなすべきかは先行研究での扱いや、問題関心に依存する。</p>
</div>
<div id="新たな変数をつくるmutate" class="section level3" number="4.3.2">
<h3><span class="header-section-number">4.3.2</span> 新たな変数をつくる：mutate()</h3>
<p>データ操作の基本は、すでにある変数を書き換えたりして、自分の関心に即した新しい変数を作ることである。このときに使用するのが<code>mutate()</code>。変数の加工を行うときには、ほとんどの場合この<code>mutate()</code>を使うことになる。以下に、いくつか簡単な例を挙げる。</p>
<div id="例1-もとの変数の内容をそのままコピーする" class="section level4" number="4.3.2.1">
<h4><span class="header-section-number">4.3.2.1</span> 例1: もとの変数の内容をそのままコピーする</h4>
<p>PIAACには、ボーナスの額を含めて、対象者の給与を時給換算した<code>earnhrbonus</code>という変数が含まれている。この変数をそのままコピーして、時給換算した賃金を表す変数<code>wage</code>を作成する。</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="handling.html#cb42-1" aria-hidden="true" tabindex="-1"></a>piaac <span class="sc">%&gt;%</span> </span>
<span id="cb42-2"><a href="handling.html#cb42-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">wage =</span> earnhrbonus)</span></code></pre></div>
<p>このコードは、「<code>piaac</code>というデータフレームに<code>wage</code>という列を追加してね、ちなみにその列には（既存の列である）<code>earnhrbonus</code>の値を入れてね」という命令を表している。</p>
<p>ただしこれだけだと新たに列を追加した結果だけが表示されて、データフレームそのものは更新されることはない。そこで、次のようにして、列を追加した結果を新たなデータフレームに格納してみる。</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="handling.html#cb43-1" aria-hidden="true" tabindex="-1"></a>piaac_new <span class="ot">&lt;-</span> piaac <span class="sc">%&gt;%</span> </span>
<span id="cb43-2"><a href="handling.html#cb43-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">wage =</span> earnhrbonus)</span></code></pre></div>
<p>すると、右側のEnvironmentのウインドウに新たに「piaac_new」というデータフレームが追加される。</p>
<p><img src="images/Rstudio_environment.png" /></p>
<p><code>piaac_new</code> というのが、新たに1つ列を追加したデータフレームである。</p>
<p>もしくは、次のように同じデータフレームに格納してもよい。</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="handling.html#cb44-1" aria-hidden="true" tabindex="-1"></a>piaac <span class="ot">&lt;-</span> piaac <span class="sc">%&gt;%</span> </span>
<span id="cb44-2"><a href="handling.html#cb44-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">wage =</span> earnhrbonus)</span></code></pre></div>
<p>先ほど<code>piaac_new</code> というデータフレームに格納したのが「名前をつけて保存」に当たるとしたら、これは「上書き保存」に当たるようなイメージである。どちらでも、個人の好みに応じて使い分けるとよいだろう。</p>
<p>さて、上記の処理を行った結果、<code>piaac</code>というデータフレームには、<code>earnhrbonus</code>とまったく同じ値が含まれる<code>wage</code>という列が作られたことがわかる。</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="handling.html#cb45-1" aria-hidden="true" tabindex="-1"></a>piaac <span class="sc">%&gt;%</span> </span>
<span id="cb45-2"><a href="handling.html#cb45-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(earnhrbonus, wage) <span class="sc">%&gt;%</span> <span class="co"># select()についてはこのあと解説があります</span></span>
<span id="cb45-3"><a href="handling.html#cb45-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>()</span></code></pre></div>
<pre><code>## # A tibble: 6 × 2
##   earnhrbonus  wage
##         &lt;dbl&gt; &lt;dbl&gt;
## 1        793.  793.
## 2       1763. 1763.
## 3       2692. 2692.
## 4       2312. 2312.
## 5         NA    NA 
## 6       5192. 5192.</code></pre>
<p>もとの変数を何ら加工せずにそのまま使うとしても、元々の変数の名前がわかりやすいとはいえない名前になっていることはよくある（たとえば、<code>q31_3</code>、など）。このような場合には、今行ったように、その列が何の変数であるかがすぐに分かるように新たに名前を付けた列を作成すると、後から間違いが少なくなる。</p>
</div>
<div id="例2-もとの変数に何らかの計算を施す" class="section level4" number="4.3.2.2">
<h4><span class="header-section-number">4.3.2.2</span> 例2: もとの変数に何らかの計算を施す</h4>
<p>たとえば、1週間の労働時間を尋ねた変数<code>d_q10</code>を5で割って、平日1日あたりの労働時間に変換した列を作りたいというときがあるだろう。このような場合には次のように計算する。</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="handling.html#cb47-1" aria-hidden="true" tabindex="-1"></a>piaac <span class="ot">&lt;-</span> piaac <span class="sc">%&gt;%</span> </span>
<span id="cb47-2"><a href="handling.html#cb47-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">workhour =</span> d_q10 <span class="sc">/</span> <span class="dv">5</span>)</span></code></pre></div>
<p>新しく作った列<code>workhour</code>は、たしかにもともとの変数を5で割った値になっていることがわかる。</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="handling.html#cb48-1" aria-hidden="true" tabindex="-1"></a>piaac <span class="sc">%&gt;%</span> </span>
<span id="cb48-2"><a href="handling.html#cb48-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(d_q10, workhour) <span class="sc">%&gt;%</span> </span>
<span id="cb48-3"><a href="handling.html#cb48-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>()</span></code></pre></div>
<pre><code>## # A tibble: 6 × 2
##   d_q10 workhour
##   &lt;dbl&gt;    &lt;dbl&gt;
## 1    48      9.6
## 2    60     12  
## 3    50     10  
## 4    60     12  
## 5    NA     NA  
## 6    40      8</code></pre>
<p>調査時点での就業状態（働いているか否か）を尋ねた項目<code>c_q01a</code>では、働いていれば1、そうでなければ2という値が入っている。これを変換して、働いていれば1、そうでなければ0となるような変数<code>work</code>を作ってみよう。</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="handling.html#cb50-1" aria-hidden="true" tabindex="-1"></a>piaac <span class="ot">&lt;-</span> piaac <span class="sc">%&gt;%</span> </span>
<span id="cb50-2"><a href="handling.html#cb50-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">work =</span> <span class="dv">2</span> <span class="sc">-</span> c_q01a)</span></code></pre></div>
<p>新しく作った列<code>work</code>は、確かにもともとの変数の値が1であれば1、2であれば0となっていることがわかる。</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="handling.html#cb51-1" aria-hidden="true" tabindex="-1"></a>piaac <span class="sc">%&gt;%</span> </span>
<span id="cb51-2"><a href="handling.html#cb51-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(c_q01a, work) <span class="sc">%&gt;%</span> </span>
<span id="cb51-3"><a href="handling.html#cb51-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>()</span></code></pre></div>
<pre><code>## # A tibble: 6 × 2
##   c_q01a  work
##    &lt;dbl&gt; &lt;dbl&gt;
## 1      1     1
## 2      1     1
## 3      1     1
## 4      1     1
## 5      2     0
## 6      1     1</code></pre>
</div>
<div id="例3-もとの変数と関係なくまったく新しい変数を作成する" class="section level4" number="4.3.2.3">
<h4><span class="header-section-number">4.3.2.3</span> 例3: もとの変数と関係なく、まったく新しい変数を作成する</h4>
<p>たとえば、以下のように1ずつ増える変数を作成することもできる。この変数を分析に直接使用するということはないが、通し番号が振ってあると何かと便利なことが多い。</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="handling.html#cb53-1" aria-hidden="true" tabindex="-1"></a>piaac <span class="ot">&lt;-</span> piaac <span class="sc">%&gt;%</span> </span>
<span id="cb53-2"><a href="handling.html#cb53-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">id =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>())</span></code></pre></div>
<p><code>n()</code> はデータフレーム内の行数を返す関数。上記3つの例で作成した変数を並べてみよう：</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="handling.html#cb54-1" aria-hidden="true" tabindex="-1"></a>piaac <span class="sc">%&gt;%</span> </span>
<span id="cb54-2"><a href="handling.html#cb54-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(id, wage, workhour) <span class="sc">%&gt;%</span> </span>
<span id="cb54-3"><a href="handling.html#cb54-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>()</span></code></pre></div>
<pre><code>## # A tibble: 6 × 3
##      id  wage workhour
##   &lt;int&gt; &lt;dbl&gt;    &lt;dbl&gt;
## 1     1  793.      9.6
## 2     2 1763.     12  
## 3     3 2692.     10  
## 4     4 2312.     12  
## 5     5   NA      NA  
## 6     6 5192.      8</code></pre>
</div>
</div>
<div id="条件の指定if_else" class="section level3" number="4.3.3">
<h3><span class="header-section-number">4.3.3</span> 条件の指定：if_else()</h3>
<p>実際に<code>mutate()</code>で既存の変数の値を書き換えたりする場合には、カテゴリをまとめたり、複数の変数を組み合わせて新しい変数を作成したりすることが多い。そこでよく使う関数が<code>if_else()</code>、<code>case_when()</code>、<code>factor()</code>の3つである。</p>
<div id="if_elseの説明" class="section level4" number="4.3.3.1">
<h4><span class="header-section-number">4.3.3.1</span> if_else()の説明</h4>
<p><code>if_else()</code>は、条件を指定し、その条件に合う場合と合わない場合の値を返す関数。<code>if_else(条件, 条件に合う場合の値, 条件に合わない場合の値)</code>、というふうに使う。</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="handling.html#cb56-1" aria-hidden="true" tabindex="-1"></a>piaac <span class="ot">&lt;-</span> piaac <span class="sc">%&gt;%</span> </span>
<span id="cb56-2"><a href="handling.html#cb56-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">gender =</span> <span class="fu">if_else</span>(gender_r <span class="sc">==</span> <span class="dv">1</span>, <span class="st">&quot;男性&quot;</span>, <span class="st">&quot;女性&quot;</span>))</span></code></pre></div>
<p>上記は、<code>gender</code>という列に対して、<code>gender_r</code>の列の値が1ならば”男性”、そうでないならば”女性”という文字列を入れてね、という命令である。</p>
<p>新しく変数を作ったときには、きちんとできているかどうかを逐一確認するのがよい。たとえば以下のように、古い変数と新しい変数の<a href="tabulate.html#tabulate">クロス集計表</a>を作ってみるのが良い方法だろう。</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="handling.html#cb57-1" aria-hidden="true" tabindex="-1"></a>piaac <span class="sc">%&gt;%</span> </span>
<span id="cb57-2"><a href="handling.html#cb57-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">with</span>(<span class="fu">table</span>(gender_r, gender))</span></code></pre></div>
<pre><code>##         gender
## gender_r 女性 男性
##        1    0 2517
##        2 2761    0</code></pre>
</div>
<div id="論理演算子の説明" class="section level4" number="4.3.3.2">
<h4><span class="header-section-number">4.3.3.2</span> 論理演算子の説明</h4>
<p>上記の例のように、条件を指定するときには論理演算子というのを使用する。よく使う論理演算子の意味は次の通り。</p>
<table>
<colgroup>
<col width="12%" />
<col width="14%" />
<col width="29%" />
<col width="43%" />
</colgroup>
<thead>
<tr class="header">
<th>条件記号</th>
<th>意味</th>
<th>コード例</th>
<th>コード例の意味</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>==</code></td>
<td>等しい</td>
<td><code>age == 25</code></td>
<td>年齢が25に等しい</td>
</tr>
<tr class="even">
<td><code>!=</code></td>
<td>ではない</td>
<td><code>age != 25</code></td>
<td>年齢が25ではない</td>
</tr>
<tr class="odd">
<td><code>&gt;</code></td>
<td>より大きい</td>
<td><code>age &gt; 25</code></td>
<td>年齢が25より大きい</td>
</tr>
<tr class="even">
<td><code>&lt;</code></td>
<td>より小さい</td>
<td><code>age &lt; 25</code></td>
<td>年齢が25より小さい</td>
</tr>
<tr class="odd">
<td><code>&gt;=</code></td>
<td>以上</td>
<td><code>age &gt;= 25</code></td>
<td>年齢が25以上（25を含む）</td>
</tr>
<tr class="even">
<td><code>&lt;=</code></td>
<td>以下</td>
<td><code>age &lt;= 25</code></td>
<td>年齢が25以下（25を含む）</td>
</tr>
<tr class="odd">
<td><code>&amp;</code></td>
<td>かつ</td>
<td><code>age &gt;= 25 &amp; age &lt;= 54</code></td>
<td>年齢が25以上54以下</td>
</tr>
<tr class="even">
<td><code>|</code></td>
<td>または</td>
<td><code>age &lt; 35 | age &gt; 54</code></td>
<td>年齢が35より小さいまたは54より大きい</td>
</tr>
</tbody>
</table>
<p>以上、以下のときの不等号の位置（どちらも左側！）、等しいときには=ではなく==、などは間違えやすいので注意しよう。</p>
</div>
</div>
<div id="複数条件の指定case_when" class="section level3" number="4.3.4">
<h3><span class="header-section-number">4.3.4</span> 複数条件の指定：case_when()</h3>
<p><code>if_else()</code>の場合は条件節は一つだが、複数の条件を指定して、それぞれの条件に対応するときに特定の値を入れたい、というような時がある。このときには、複数条件を指定して値を書き換えるコマンドである、<code>case_when()</code>をつかうとよい。</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="handling.html#cb59-1" aria-hidden="true" tabindex="-1"></a>piaac <span class="ot">&lt;-</span> piaac <span class="sc">%&gt;%</span> </span>
<span id="cb59-2"><a href="handling.html#cb59-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">agegroup =</span> <span class="fu">case_when</span>(</span>
<span id="cb59-3"><a href="handling.html#cb59-3" aria-hidden="true" tabindex="-1"></a>    <span class="dv">25</span> <span class="sc">&lt;=</span> age_r <span class="sc">&amp;</span> age_r <span class="sc">&lt;=</span> <span class="dv">34</span> <span class="sc">~</span> <span class="st">&quot;25-34歳&quot;</span>,</span>
<span id="cb59-4"><a href="handling.html#cb59-4" aria-hidden="true" tabindex="-1"></a>    <span class="dv">35</span> <span class="sc">&lt;=</span> age_r <span class="sc">&amp;</span> age_r <span class="sc">&lt;=</span> <span class="dv">44</span> <span class="sc">~</span> <span class="st">&quot;35-44歳&quot;</span>,</span>
<span id="cb59-5"><a href="handling.html#cb59-5" aria-hidden="true" tabindex="-1"></a>    <span class="dv">45</span> <span class="sc">&lt;=</span> age_r <span class="sc">&amp;</span> age_r <span class="sc">&lt;=</span> <span class="dv">54</span> <span class="sc">~</span> <span class="st">&quot;45-54歳&quot;</span>,</span>
<span id="cb59-6"><a href="handling.html#cb59-6" aria-hidden="true" tabindex="-1"></a>    <span class="dv">55</span> <span class="sc">&lt;=</span> age_r <span class="sc">&amp;</span> age_r <span class="sc">&lt;=</span> <span class="dv">64</span> <span class="sc">~</span> <span class="st">&quot;55-64歳&quot;</span></span>
<span id="cb59-7"><a href="handling.html#cb59-7" aria-hidden="true" tabindex="-1"></a>    ))</span></code></pre></div>
<p>ちゃんとできたかを確認しよう。</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="handling.html#cb60-1" aria-hidden="true" tabindex="-1"></a>piaac <span class="sc">%&gt;%</span> </span>
<span id="cb60-2"><a href="handling.html#cb60-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">with</span>(<span class="fu">table</span>(age_r, agegroup))</span></code></pre></div>
<pre><code>##      agegroup
## age_r 25-34歳 35-44歳 45-54歳 55-64歳
##    16       0       0       0       0
##    17       0       0       0       0
##    18       0       0       0       0
##    19       0       0       0       0
##    20       0       0       0       0
##    21       0       0       0       0
##    22       0       0       0       0
##    23       0       0       0       0
##    24       0       0       0       0
##    25      70       0       0       0
##    26      86       0       0       0
##    27      83       0       0       0
##    28      77       0       0       0
##    29     104       0       0       0
##    30      86       0       0       0
##    31     105       0       0       0
##    32     106       0       0       0
##    33     106       0       0       0
##    34     110       0       0       0
##    35       0     126       0       0
##    36       0     124       0       0
##    37       0     123       0       0
##    38       0     144       0       0
##    39       0     133       0       0
##    40       0     128       0       0
##    41       0     110       0       0
##    42       0     116       0       0
##    43       0     127       0       0
##    44       0     111       0       0
##    45       0       0      93       0
##    46       0       0     119       0
##    47       0       0     114       0
##    48       0       0     110       0
##    49       0       0     109       0
##    50       0       0      85       0
##    51       0       0      97       0
##    52       0       0     102       0
##    53       0       0     110       0
##    54       0       0      98       0
##    55       0       0       0     103
##    56       0       0       0      95
##    57       0       0       0      88
##    58       0       0       0     133
##    59       0       0       0      98
##    60       0       0       0     136
##    61       0       0       0     138
##    62       0       0       0     132
##    63       0       0       0     143
##    64       0       0       0     145
##    65       0       0       0       0</code></pre>
<p>もともとのデータには年齢が16歳から65歳の人が含まれているが、先ほどのコードでは16歳から24歳、65歳の人が条件に含まれていなかったので、新しく作成した列である<code>agegroup</code>には該当するものがないという結果になっている。このようなケースには<code>NA</code>が与えられる。</p>
<p>実際、<code>NA</code>が与えられているかどうかを確認してみよう。以下のように<code>with(table())</code>にオプション<code>useNA = "always"</code>を指定することで、<code>NA</code>についても集計することができる。</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="handling.html#cb62-1" aria-hidden="true" tabindex="-1"></a>piaac <span class="sc">%&gt;%</span> </span>
<span id="cb62-2"><a href="handling.html#cb62-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">with</span>(<span class="fu">table</span>(age_r, agegroup, <span class="at">useNA =</span> <span class="st">&quot;always&quot;</span>))</span></code></pre></div>
<pre><code>##       agegroup
## age_r  25-34歳 35-44歳 45-54歳 55-64歳 &lt;NA&gt;
##   16         0       0       0       0  114
##   17         0       0       0       0   90
##   18         0       0       0       0   96
##   19         0       0       0       0   76
##   20         0       0       0       0   90
##   21         0       0       0       0   75
##   22         0       0       0       0   72
##   23         0       0       0       0   88
##   24         0       0       0       0   84
##   25        70       0       0       0    0
##   26        86       0       0       0    0
##   27        83       0       0       0    0
##   28        77       0       0       0    0
##   29       104       0       0       0    0
##   30        86       0       0       0    0
##   31       105       0       0       0    0
##   32       106       0       0       0    0
##   33       106       0       0       0    0
##   34       110       0       0       0    0
##   35         0     126       0       0    0
##   36         0     124       0       0    0
##   37         0     123       0       0    0
##   38         0     144       0       0    0
##   39         0     133       0       0    0
##   40         0     128       0       0    0
##   41         0     110       0       0    0
##   42         0     116       0       0    0
##   43         0     127       0       0    0
##   44         0     111       0       0    0
##   45         0       0      93       0    0
##   46         0       0     119       0    0
##   47         0       0     114       0    0
##   48         0       0     110       0    0
##   49         0       0     109       0    0
##   50         0       0      85       0    0
##   51         0       0      97       0    0
##   52         0       0     102       0    0
##   53         0       0     110       0    0
##   54         0       0      98       0    0
##   55         0       0       0     103    0
##   56         0       0       0      95    0
##   57         0       0       0      88    0
##   58         0       0       0     133    0
##   59         0       0       0      98    0
##   60         0       0       0     136    0
##   61         0       0       0     138    0
##   62         0       0       0     132    0
##   63         0       0       0     143    0
##   64         0       0       0     145    0
##   65         0       0       0       0   70
##   &lt;NA&gt;       0       0       0       0    0</code></pre>
</div>
<div id="カテゴリ変数へ変換factor" class="section level3" number="4.3.5">
<h3><span class="header-section-number">4.3.5</span> カテゴリ変数へ変換：factor()</h3>
<p>PIAACには次のように、母親の最終学歴を尋ねた質問項目（j_q06b）がある。</p>
<table>
<thead>
<tr class="header">
<th>選択肢</th>
<th>調査票の番号</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>小学校・中学校</td>
<td>1</td>
</tr>
<tr class="even">
<td>高校（旧制の中学校、高校を含む）</td>
<td>2</td>
</tr>
<tr class="odd">
<td>専門学校、高等専門学校、短大、大学以上</td>
<td>3</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="handling.html#cb64-1" aria-hidden="true" tabindex="-1"></a>piaac <span class="sc">%&gt;%</span> <span class="fu">with</span>(<span class="fu">table</span>(j_q06b))</span></code></pre></div>
<pre><code>## j_q06b
##    1    2    3 
## 1553 2303 1098</code></pre>
<p>この数値だけでは、何番が何を指しているのかよくわからない。そこで、この変数の値にそれぞれ名前を付けて文字列（カテゴリ）変数とした変数<code>mothereduc</code>を作成する。</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="handling.html#cb66-1" aria-hidden="true" tabindex="-1"></a>piaac <span class="ot">&lt;-</span> piaac <span class="sc">%&gt;%</span> </span>
<span id="cb66-2"><a href="handling.html#cb66-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">mothereduc =</span> <span class="fu">factor</span>(j_q06b,</span>
<span id="cb66-3"><a href="handling.html#cb66-3" aria-hidden="true" tabindex="-1"></a>                              <span class="at">levels =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>,</span>
<span id="cb66-4"><a href="handling.html#cb66-4" aria-hidden="true" tabindex="-1"></a>                              <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;母親・初等教育&quot;</span>, <span class="st">&quot;母親・中等教育&quot;</span>, <span class="st">&quot;母親・高等教育&quot;</span>)))</span></code></pre></div>
<p>結果を確認：</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="handling.html#cb67-1" aria-hidden="true" tabindex="-1"></a>piaac <span class="sc">%&gt;%</span> <span class="fu">with</span>(<span class="fu">table</span>(j_q06b, mothereduc))</span></code></pre></div>
<pre><code>##       mothereduc
## j_q06b 母親・初等教育 母親・中等教育 母親・高等教育
##      1           1553              0              0
##      2              0           2303              0
##      3              0              0           1098</code></pre>
<p><code>if_else()</code>や<code>case_when()</code>を使って新しくカテゴリ変数を作るとき、カテゴリの順序が意図していたものとは違う順序になってしまうことがある。これは、文字列の場合はアルファベット順、日本語の場合はshift-jis順で並んでしまうことによる。</p>
<p>たとえば、1週間の労働時間（<code>d_q10</code>）に関する変数をもとに、労働時間の長さ別に分けたカテゴリ変数を作成したいと思ったとする。<code>case_when()</code> を使って作成すると、意図していた順序とは違ったバラバラの順番になってしまう。</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="handling.html#cb69-1" aria-hidden="true" tabindex="-1"></a>piaac <span class="ot">&lt;-</span> piaac <span class="sc">%&gt;%</span> </span>
<span id="cb69-2"><a href="handling.html#cb69-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">workhour_fct =</span> <span class="fu">case_when</span>(</span>
<span id="cb69-3"><a href="handling.html#cb69-3" aria-hidden="true" tabindex="-1"></a>    d_q10 <span class="sc">&lt;</span> <span class="dv">35</span> <span class="sc">~</span> <span class="st">&quot;短時間（35時間未満）&quot;</span>,</span>
<span id="cb69-4"><a href="handling.html#cb69-4" aria-hidden="true" tabindex="-1"></a>    d_q10 <span class="sc">&gt;=</span> <span class="dv">35</span> <span class="sc">&amp;</span> d_q10 <span class="sc">&lt;=</span> <span class="dv">49</span> <span class="sc">~</span> <span class="st">&quot;通常（35-49時間）&quot;</span>,</span>
<span id="cb69-5"><a href="handling.html#cb69-5" aria-hidden="true" tabindex="-1"></a>    d_q10 <span class="sc">&gt;=</span> <span class="dv">50</span> <span class="sc">&amp;</span> d_q10 <span class="sc">&lt;=</span> <span class="dv">59</span> <span class="sc">~</span> <span class="st">&quot;準長時間（50-59時間）&quot;</span>,</span>
<span id="cb69-6"><a href="handling.html#cb69-6" aria-hidden="true" tabindex="-1"></a>    d_q10 <span class="sc">&gt;=</span> <span class="dv">60</span> <span class="sc">~</span> <span class="st">&quot;長時間（60時間以上）&quot;</span></span>
<span id="cb69-7"><a href="handling.html#cb69-7" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb69-8"><a href="handling.html#cb69-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-9"><a href="handling.html#cb69-9" aria-hidden="true" tabindex="-1"></a>piaac <span class="sc">%&gt;%</span> <span class="fu">with</span>(<span class="fu">table</span>(workhour_fct))</span></code></pre></div>
<pre><code>## workhour_fct
## 準長時間（50-59時間）  短時間（35時間未満）  長時間（60時間以上） 
##                   648                   960                   396 
##     通常（35-49時間） 
##                  1848</code></pre>
<p>このような場合には、いったん数値の変数を挟んでから<code>factor()</code> を使って変数を作成することで、順番がばらばらになってしまうのを防ぐことができる。</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="handling.html#cb71-1" aria-hidden="true" tabindex="-1"></a>piaac <span class="ot">&lt;-</span> piaac <span class="sc">%&gt;%</span> </span>
<span id="cb71-2"><a href="handling.html#cb71-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">workhour_fct =</span> <span class="fu">case_when</span>(</span>
<span id="cb71-3"><a href="handling.html#cb71-3" aria-hidden="true" tabindex="-1"></a>    d_q10 <span class="sc">&lt;</span> <span class="dv">35</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb71-4"><a href="handling.html#cb71-4" aria-hidden="true" tabindex="-1"></a>    d_q10 <span class="sc">&gt;=</span> <span class="dv">35</span> <span class="sc">&amp;</span> d_q10 <span class="sc">&lt;=</span> <span class="dv">49</span> <span class="sc">~</span> <span class="dv">2</span>,</span>
<span id="cb71-5"><a href="handling.html#cb71-5" aria-hidden="true" tabindex="-1"></a>    d_q10 <span class="sc">&gt;=</span> <span class="dv">50</span> <span class="sc">&amp;</span> d_q10 <span class="sc">&lt;=</span> <span class="dv">59</span> <span class="sc">~</span> <span class="dv">3</span>,</span>
<span id="cb71-6"><a href="handling.html#cb71-6" aria-hidden="true" tabindex="-1"></a>    d_q10 <span class="sc">&gt;=</span> <span class="dv">60</span> <span class="sc">~</span> <span class="dv">4</span></span>
<span id="cb71-7"><a href="handling.html#cb71-7" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span> </span>
<span id="cb71-8"><a href="handling.html#cb71-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">workhour_fct =</span> <span class="fu">factor</span>(workhour_fct,</span>
<span id="cb71-9"><a href="handling.html#cb71-9" aria-hidden="true" tabindex="-1"></a>                               <span class="at">levels =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>,</span>
<span id="cb71-10"><a href="handling.html#cb71-10" aria-hidden="true" tabindex="-1"></a>                               <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;短時間（35時間未満）&quot;</span>, <span class="st">&quot;通常（35-49時間）&quot;</span>, <span class="st">&quot;準長時間（50-59時間）&quot;</span>, <span class="st">&quot;長時間（60時間以上）&quot;</span>)))</span>
<span id="cb71-11"><a href="handling.html#cb71-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-12"><a href="handling.html#cb71-12" aria-hidden="true" tabindex="-1"></a>piaac <span class="sc">%&gt;%</span> <span class="fu">with</span>(<span class="fu">table</span>(workhour_fct)) </span></code></pre></div>
<pre><code>## workhour_fct
##  短時間（35時間未満）     通常（35-49時間） 準長時間（50-59時間） 
##                   960                  1848                   648 
##  長時間（60時間以上） 
##                   396</code></pre>
</div>
<div id="必要な列のみ抽出select" class="section level3" number="4.3.6">
<h3><span class="header-section-number">4.3.6</span> 必要な列のみ抽出：select()</h3>
<p>このコマンドは「変数の作成」の節で扱ったコマンドと比べるとやや特殊で、列を追加するのではなく、列を<strong>削除する</strong>という操作を行う。普通に分析をする限りは列を削除する必要はないが、一部の列だけを取り出してどのようになっているのかを確認したりしたいときなどに使う。</p>
<p>このときに使うコマンドが<code>select()</code>である。</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="handling.html#cb73-1" aria-hidden="true" tabindex="-1"></a>piaac_sub <span class="ot">&lt;-</span> piaac <span class="sc">%&gt;%</span> </span>
<span id="cb73-2"><a href="handling.html#cb73-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(gender, wage) <span class="co">#gender, wageの列を抽出</span></span></code></pre></div>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="handling.html#cb74-1" aria-hidden="true" tabindex="-1"></a>piaac_sub <span class="ot">&lt;-</span> piaac <span class="sc">%&gt;%</span> </span>
<span id="cb74-2"><a href="handling.html#cb74-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>gender, <span class="sc">-</span>wage) <span class="co">#gender, wage「以外」の列を抽出</span></span></code></pre></div>
</div>
<div id="をつなげてコマンドをまとめる" class="section level3" number="4.3.7">
<h3><span class="header-section-number">4.3.7</span> %&gt;%をつなげてコマンドをまとめる</h3>
<p>変数を作成する過程では、正しく変数を作れているかどうかを一つひとつ確認しながら進めていくことが必須である。しかし、正しく作成できたことが確認できたら、<code>with(table())</code>などを使って確認するコードは必ずしもスクリプトに残しておく必要はない。分析に使う変数が固まってきたら、変数を作成するためのコードを（ある程度）まとめておくと、コードがシンプルになってよいだろう。このようなときに、パイプ記法は有用である。</p>
<p>上記で作成した変数も含めて、本資料で使う変数をまとめて作成するためのコードを以下に記した。</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="handling.html#cb75-1" aria-hidden="true" tabindex="-1"></a>piaac <span class="ot">&lt;-</span> piaac <span class="sc">%&gt;%</span> </span>
<span id="cb75-2"><a href="handling.html#cb75-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">id =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb75-3"><a href="handling.html#cb75-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">wage =</span> earnhrbonus) <span class="sc">%&gt;%</span> </span>
<span id="cb75-4"><a href="handling.html#cb75-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">logwage =</span> <span class="fu">log</span>(wage)) <span class="sc">%&gt;%</span> </span>
<span id="cb75-5"><a href="handling.html#cb75-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">gender =</span> <span class="fu">factor</span>(gender_r, <span class="at">level =</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">1</span>, <span class="at">label =</span> <span class="fu">c</span>(<span class="st">&quot;女性&quot;</span>,<span class="st">&quot;男性&quot;</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb75-6"><a href="handling.html#cb75-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">age =</span> age_r) <span class="sc">%&gt;%</span> </span>
<span id="cb75-7"><a href="handling.html#cb75-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">work =</span> <span class="dv">2</span> <span class="sc">-</span> c_q01a) <span class="sc">%&gt;%</span> </span>
<span id="cb75-8"><a href="handling.html#cb75-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">workhour =</span> d_q10 <span class="sc">/</span> <span class="dv">5</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb75-9"><a href="handling.html#cb75-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">workhour_fct =</span> <span class="fu">case_when</span>(</span>
<span id="cb75-10"><a href="handling.html#cb75-10" aria-hidden="true" tabindex="-1"></a>    d_q10 <span class="sc">&lt;</span> <span class="dv">35</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb75-11"><a href="handling.html#cb75-11" aria-hidden="true" tabindex="-1"></a>    d_q10 <span class="sc">&gt;=</span> <span class="dv">35</span> <span class="sc">&amp;</span> d_q10 <span class="sc">&lt;=</span> <span class="dv">49</span> <span class="sc">~</span> <span class="dv">2</span>,</span>
<span id="cb75-12"><a href="handling.html#cb75-12" aria-hidden="true" tabindex="-1"></a>    d_q10 <span class="sc">&gt;=</span> <span class="dv">50</span> <span class="sc">&amp;</span> d_q10 <span class="sc">&lt;=</span> <span class="dv">59</span> <span class="sc">~</span> <span class="dv">3</span>,</span>
<span id="cb75-13"><a href="handling.html#cb75-13" aria-hidden="true" tabindex="-1"></a>    d_q10 <span class="sc">&gt;=</span> <span class="dv">60</span> <span class="sc">~</span> <span class="dv">4</span></span>
<span id="cb75-14"><a href="handling.html#cb75-14" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span> </span>
<span id="cb75-15"><a href="handling.html#cb75-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">workhour_fct =</span> <span class="fu">factor</span>(workhour_fct,</span>
<span id="cb75-16"><a href="handling.html#cb75-16" aria-hidden="true" tabindex="-1"></a>                               <span class="at">levels =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>,</span>
<span id="cb75-17"><a href="handling.html#cb75-17" aria-hidden="true" tabindex="-1"></a>                               <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;短時間（35時間未満）&quot;</span>, <span class="st">&quot;通常（35-49時間）&quot;</span>, <span class="st">&quot;準長時間（50-59時間）&quot;</span>, <span class="st">&quot;長時間（60時間以上）&quot;</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb75-18"><a href="handling.html#cb75-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">educ =</span> <span class="fu">case_when</span>(</span>
<span id="cb75-19"><a href="handling.html#cb75-19" aria-hidden="true" tabindex="-1"></a>    edcat8 <span class="sc">==</span> <span class="dv">1</span> <span class="sc">|</span> edcat8 <span class="sc">==</span> <span class="dv">2</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb75-20"><a href="handling.html#cb75-20" aria-hidden="true" tabindex="-1"></a>    edcat8 <span class="sc">==</span> <span class="dv">3</span> <span class="sc">~</span> <span class="dv">2</span>,</span>
<span id="cb75-21"><a href="handling.html#cb75-21" aria-hidden="true" tabindex="-1"></a>    edcat8 <span class="sc">==</span> <span class="dv">4</span> <span class="sc">|</span> edcat8 <span class="sc">==</span> <span class="dv">5</span> <span class="sc">~</span> <span class="dv">3</span>,</span>
<span id="cb75-22"><a href="handling.html#cb75-22" aria-hidden="true" tabindex="-1"></a>    edcat8 <span class="sc">==</span> <span class="dv">6</span> <span class="sc">|</span> edcat8 <span class="sc">==</span> <span class="dv">7</span> <span class="sc">|</span> edcat8 <span class="sc">==</span> <span class="dv">8</span> <span class="sc">~</span> <span class="dv">4</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb75-23"><a href="handling.html#cb75-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">educ =</span> <span class="fu">factor</span>(educ, <span class="at">levels =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>,</span>
<span id="cb75-24"><a href="handling.html#cb75-24" aria-hidden="true" tabindex="-1"></a>                       <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;中学&quot;</span>, <span class="st">&quot;高校&quot;</span>, <span class="st">&quot;短大高専&quot;</span>, <span class="st">&quot;大学大学院&quot;</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb75-25"><a href="handling.html#cb75-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">mothereduc =</span> <span class="fu">factor</span>(j_q06b,</span>
<span id="cb75-26"><a href="handling.html#cb75-26" aria-hidden="true" tabindex="-1"></a>                             <span class="at">levels =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>,</span>
<span id="cb75-27"><a href="handling.html#cb75-27" aria-hidden="true" tabindex="-1"></a>                             <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;母親：初等教育&quot;</span>, <span class="st">&quot;母親：中等教育&quot;</span>, <span class="st">&quot;母親：高等教育&quot;</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb75-28"><a href="handling.html#cb75-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fathereduc =</span> <span class="fu">factor</span>(j_q07b,</span>
<span id="cb75-29"><a href="handling.html#cb75-29" aria-hidden="true" tabindex="-1"></a>                             <span class="at">levels =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>,</span>
<span id="cb75-30"><a href="handling.html#cb75-30" aria-hidden="true" tabindex="-1"></a>                             <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;父親：初等教育&quot;</span>, <span class="st">&quot;父親：中等教育&quot;</span>, <span class="st">&quot;父親：高等教育&quot;</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb75-31"><a href="handling.html#cb75-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">parenteduc =</span> <span class="fu">case_when</span>(</span>
<span id="cb75-32"><a href="handling.html#cb75-32" aria-hidden="true" tabindex="-1"></a>    j_q07b <span class="sc">&gt;=</span> j_q06b <span class="sc">~</span> j_q07b,</span>
<span id="cb75-33"><a href="handling.html#cb75-33" aria-hidden="true" tabindex="-1"></a>    j_q07b <span class="sc">&lt;</span> j_q06b <span class="sc">~</span> j_q06b,</span>
<span id="cb75-34"><a href="handling.html#cb75-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">is.na</span>(j_q07b) <span class="sc">==</span> <span class="cn">TRUE</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(j_q06b) <span class="sc">==</span> <span class="cn">FALSE</span> <span class="sc">~</span> j_q06b,</span>
<span id="cb75-35"><a href="handling.html#cb75-35" aria-hidden="true" tabindex="-1"></a>    <span class="fu">is.na</span>(j_q06b) <span class="sc">==</span> <span class="cn">TRUE</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(j_q07b) <span class="sc">==</span> <span class="cn">FALSE</span> <span class="sc">~</span> j_q07b</span>
<span id="cb75-36"><a href="handling.html#cb75-36" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span> </span>
<span id="cb75-37"><a href="handling.html#cb75-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">parenteduc =</span> <span class="fu">factor</span>(parenteduc,</span>
<span id="cb75-38"><a href="handling.html#cb75-38" aria-hidden="true" tabindex="-1"></a>                             <span class="at">levels =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>,</span>
<span id="cb75-39"><a href="handling.html#cb75-39" aria-hidden="true" tabindex="-1"></a>                             <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;親：初等教育&quot;</span>, <span class="st">&quot;親：中等教育&quot;</span>, <span class="st">&quot;親：高等教育&quot;</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb75-40"><a href="handling.html#cb75-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">occupation =</span> <span class="fu">factor</span>(isco1c,</span>
<span id="cb75-41"><a href="handling.html#cb75-41" aria-hidden="true" tabindex="-1"></a>                             <span class="at">levels =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">9</span>,</span>
<span id="cb75-42"><a href="handling.html#cb75-42" aria-hidden="true" tabindex="-1"></a>                             <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;管理職&quot;</span>,<span class="st">&quot;専門職&quot;</span>,<span class="st">&quot;技術職・准専門職&quot;</span>,<span class="st">&quot;事務補助&quot;</span>,<span class="st">&quot;サービス・販売&quot;</span>,<span class="st">&quot;農林漁業&quot;</span>,<span class="st">&quot;技能工&quot;</span>,<span class="st">&quot;設備・機械運転・組立&quot;</span>,<span class="st">&quot;単純作業&quot;</span>)</span>
<span id="cb75-43"><a href="handling.html#cb75-43" aria-hidden="true" tabindex="-1"></a>)) <span class="sc">%&gt;%</span> </span>
<span id="cb75-44"><a href="handling.html#cb75-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">numeracy =</span> pvnum1) <span class="sc">%&gt;%</span> </span>
<span id="cb75-45"><a href="handling.html#cb75-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ojt =</span> <span class="dv">2</span> <span class="sc">-</span> b_q12c) <span class="sc">%&gt;%</span> </span>
<span id="cb75-46"><a href="handling.html#cb75-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">health =</span> <span class="dv">6</span> <span class="sc">-</span> i_q08)</span></code></pre></div>
<p>このようにして作成した変数のみを残したデータを別途データフレームとして残しておこう。</p>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb76-1"><a href="handling.html#cb76-1" aria-hidden="true" tabindex="-1"></a>piaac_variable <span class="ot">&lt;-</span> piaac <span class="sc">%&gt;%</span> </span>
<span id="cb76-2"><a href="handling.html#cb76-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(id, wage, logwage, gender, age, work, workhour, workhour_fct, educ, mothereduc, fathereduc, parenteduc, occupation, numeracy, ojt, health)</span></code></pre></div>
</div>
</div>
<div id="変数の作成についてのtips" class="section level2" number="4.4">
<h2><span class="header-section-number">4.4</span> 変数の作成についてのtips</h2>
<div id="カテゴリをまとめる" class="section level3" number="4.4.1">
<h3><span class="header-section-number">4.4.1</span> カテゴリをまとめる</h3>
<p>たとえば、親の職業（階級）によって、対象者の学歴がどの程度異なるのかを知りたいとする。このとき、学歴を「中学」「高校」「短大高専」「大学大学院」という4つのカテゴリで定義しているとする。この場合には、たとえば「大学大学院」を1、それ以外を0とすることで、大学以上か大学未満か、という2値のカテゴリにする。</p>
<p>一つひとつのカテゴリに該当する人数が少ないときや、議論を単純化したいときに有効な方法といえる。</p>
</div>
<div id="均等な順序を仮定して連続変数とする" class="section level3" number="4.4.2">
<h3><span class="header-section-number">4.4.2</span> 均等な順序を仮定して連続変数とする</h3>
<p>ある程度均等な順序があると仮定できるならば、数値として扱うことを考えてみるとよい。JGSSでは、「現在の仕事にどの程度満足していますか」という質問（ST5JOB）で、仕事への満足度が尋ねられている。選択肢は「満足している」「どちらかといえば満足している」「どちらともいえない」「どちらかといえば不満である」「不満である」という5つから1つを選択する形式である（わからないや無回答もあるが（後述）、ここでは省略する）。このようなときには、以下のように数値を割り当てることで、値が高いほど満足していることを表す連続変数に見立てることができる。もちろん、選択肢間の間隔がどれも同じ1であるというのはあくまで仮定であり本当は違うかもしれないということには注意が必要だが、解釈はわかりやすくなるというメリットがある。</p>
<table>
<thead>
<tr class="header">
<th>選択肢</th>
<th>調査票上の番号</th>
<th>数値化例</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>満足している</td>
<td>1</td>
<td>5</td>
</tr>
<tr class="even">
<td>どちらかといえば満足している</td>
<td>2</td>
<td>4</td>
</tr>
<tr class="odd">
<td>どちらでもない</td>
<td>3</td>
<td>3</td>
</tr>
<tr class="even">
<td>どちらかといえば不満である</td>
<td>4</td>
<td>2</td>
</tr>
<tr class="odd">
<td>不満である</td>
<td>5</td>
<td>1</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="handling.html#cb77-1" aria-hidden="true" tabindex="-1"></a>jgss <span class="co">#元のデータ（架空例）</span></span></code></pre></div>
<pre><code>## # A tibble: 6 × 1
##   ST5JOB
##    &lt;dbl&gt;
## 1      1
## 2      5
## 3      4
## 4      2
## 5      1
## 6      3</code></pre>
<p>以下のようにして値を変えた変数を作成する。</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="handling.html#cb79-1" aria-hidden="true" tabindex="-1"></a>jgss <span class="ot">&lt;-</span> jgss <span class="sc">%&gt;%</span> </span>
<span id="cb79-2"><a href="handling.html#cb79-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">jobsatis =</span> <span class="dv">6</span> <span class="sc">-</span> ST5JOB)</span>
<span id="cb79-3"><a href="handling.html#cb79-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-4"><a href="handling.html#cb79-4" aria-hidden="true" tabindex="-1"></a>jgss</span></code></pre></div>
<pre><code>## # A tibble: 6 × 2
##   ST5JOB jobsatis
##    &lt;dbl&gt;    &lt;dbl&gt;
## 1      1        5
## 2      5        1
## 3      4        2
## 4      2        4
## 5      1        5
## 6      3        3</code></pre>
<p>なお、こうした扱いが認められるかどうかは扱う変数によって異なるので、先行研究での定義を参考にするとよい。たとえば今回のような仕事への満足度についてはおおむねこのような処理は認められているが、「中学」に1、「高校」に2、「短大高専」に3、「大学大学院」に4を振る、というような処理はあまり認められていない。しかしながら、受けた教育年数として、「中学」に9、「高校」に12、「短大高専」に14、「大学」に16、「大学院」に18（など）といった値を振ることはある程度認められている。このあたりは先行研究の操作化を参考にしつつ、最終的には自分たちの関心によって決めるとよいだろう。</p>
</div>
<div id="無回答非該当わからないなどをnaに" class="section level3" number="4.4.3">
<h3><span class="header-section-number">4.4.3</span> 無回答、非該当、「わからない」などをNAに</h3>
<p>JGSSでは「夫は外で働き、妻は家庭を守るべきだ」という意見に対して賛成か反対かを4つの選択肢を設けて尋ねている。ただし、この質問に（何らかの理由で）回答していない者もおり、そのような場合には9という値が便宜的に振られている。</p>
<p>この質問に対する回答を連続値とみなして集計したりしたいとする。このような場合、無回答の9という値は計算から除外したいので、9という値ではなくNAとしたい。</p>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="handling.html#cb81-1" aria-hidden="true" tabindex="-1"></a>jgss <span class="co">#元のデータ（架空例）</span></span></code></pre></div>
<pre><code>## # A tibble: 6 × 1
##   Q4WWHHX
##     &lt;dbl&gt;
## 1       1
## 2       9
## 3       4
## 4       3
## 5       2
## 6       1</code></pre>
<p>以下のようにして9をNAに置き換えた変数を作成する。</p>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="handling.html#cb83-1" aria-hidden="true" tabindex="-1"></a>jgss <span class="ot">&lt;-</span> jgss <span class="sc">%&gt;%</span> </span>
<span id="cb83-2"><a href="handling.html#cb83-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">genderrole =</span> <span class="fu">if_else</span>(Q4WWHHX <span class="sc">==</span> <span class="dv">9</span>, <span class="cn">NA_real_</span>, Q4WWHHX))  <span class="co"># 9をNAに置換</span></span>
<span id="cb83-3"><a href="handling.html#cb83-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-4"><a href="handling.html#cb83-4" aria-hidden="true" tabindex="-1"></a>jgss <span class="co">#変換後のデータ</span></span></code></pre></div>
<pre><code>## # A tibble: 6 × 2
##   Q4WWHHX genderrole
##     &lt;dbl&gt;      &lt;dbl&gt;
## 1       1          1
## 2       9         NA
## 3       4          4
## 4       3          3
## 5       2          2
## 6       1          1</code></pre>
<p>調査によってはこのように無回答やあるいは「わからない」という選択肢に対して便宜的に99という数字が振られていたり、非該当（たとえば結婚している人に対してのみ尋ねる質問の場合、結婚していない人はその質問に回答しない。このような場合には、回答対象ではないという意味で、非該当とされる）のケースに対して便宜的に88といったような数字が振られていることがある。このような場合にも同じようにNAに変換する。</p>
<p>この作業を忘れて平均値などを計算するととんでもない間違いを犯してしまうことになるため、忘れないようにしっかりチェックしておきたい<a href="#fn4" class="footnote-ref" id="fnref4"><sup>4</sup></a>。</p>
<p>用いる変数については平均値だけではなく、分布や実際の値、調査票の文言などをきちんとチェックしておき、くれぐれもこのようなミスが起こらないようにしたい。</p>
</div>
<div id="カテゴリ変数の区間の中点をとって連続変数とする" class="section level3" number="4.4.4">
<h3><span class="header-section-number">4.4.4</span> カテゴリ変数の区間の中点をとって連続変数とする</h3>
<p>なんらかの区間をとって尋ねられている場合、その区間の中点をとって、連続変数とみなす。たとえば、日本家族社会学会が行っている2008年全国家族調査（NFRJ08）では、「あなたご自身…は、次にあげる…家事を現在どのくらいの頻度で行っていますか」という質問項目で、たとえば「食事の用意」について、以下のような選択肢で家事頻度を尋ねている。</p>
<table>
<thead>
<tr class="header">
<th>選択肢</th>
<th>調査票上の番号</th>
<th>数値化例</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ほぼ毎日（週6〜7回）</td>
<td>1</td>
<td>6.5</td>
</tr>
<tr class="even">
<td>1週間に4〜5回</td>
<td>2</td>
<td>4.5</td>
</tr>
<tr class="odd">
<td>1週間に2〜3回</td>
<td>3</td>
<td>2.5</td>
</tr>
<tr class="even">
<td>1週間に1回くらい</td>
<td>4</td>
<td>1</td>
</tr>
<tr class="odd">
<td>ほとんど行わない</td>
<td>5</td>
<td>0</td>
</tr>
</tbody>
</table>
<p>このような場合、週6〜7回という区間の中点をとって6.5、週4〜5回という区間の中点をとって4.5、、etcとすることで、1週間当たりの家事頻度を表す連続変数と見立てることができる。</p>
<p>こうした扱いがどの程度許容されるかについては、先行研究での定義を参照するとよい。</p>
<p>年収などもこうした区間で扱われることがあるが、この場合は中点を定義できない選択肢が設けられていることがある（例：2050万円以上）。こうした場合の扱いについては諸説あり、<a href="domain.html#domain_wage">こちら</a>にも少しそのことを記載している。</p>
</div>
</div>
<div id="handling_sample" class="section level2" number="4.5">
<h2><span class="header-section-number">4.5</span> サンプルの限定</h2>
<p>社会調査データを分析する場合、調査対象者をすべて分析対象に含めるわけではなく、年齢を限定したり、働いている人だけに限定したりといったふうに、分析対象を一部に限定することが多い。このときに使うコードや注意点について記す。</p>
<div id="該当するケースだけを残すfilter" class="section level3" number="4.5.1">
<h3><span class="header-section-number">4.5.1</span> 該当するケースだけを残す：filter()</h3>
<p>関心によっては、若年の人だけ分析したいとか、高齢の人だけ分析したいとか、女性（男性）だけ分析したいというときがある。それ以外にも、使う変数にNAが含まれているケースをあらかじめ除外するということはふつうにある。このようなときには、<code>filter()</code>を使う。</p>
<p>性別（<code>gender</code>）が男性のケースのみを抽出し、抽出したデータに新しい名前（<code>piaac_male</code>）をつける場合には次のようにする。</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="handling.html#cb85-1" aria-hidden="true" tabindex="-1"></a>piaac_male <span class="ot">&lt;-</span> piaac_variable <span class="sc">%&gt;%</span> </span>
<span id="cb85-2"><a href="handling.html#cb85-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(gender <span class="sc">==</span> <span class="st">&quot;男性&quot;</span>)</span></code></pre></div>
<p>年齢が25歳以上34歳以下のケースのみを抽出し、抽出したデータに新しい名前（<code>piaac_young</code>）をつける。</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb86-1"><a href="handling.html#cb86-1" aria-hidden="true" tabindex="-1"></a>piaac_young <span class="ot">&lt;-</span> piaac_variable <span class="sc">%&gt;%</span> </span>
<span id="cb86-2"><a href="handling.html#cb86-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(age <span class="sc">&gt;=</span> <span class="dv">25</span> <span class="sc">&amp;</span> age <span class="sc">&lt;=</span> <span class="dv">34</span>)</span></code></pre></div>
<p>今回の資料では、「25歳以上64歳未満の有業者」に対象を限定する。そのため、次のように条件を指定する。</p>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="handling.html#cb87-1" aria-hidden="true" tabindex="-1"></a>piaac_sample <span class="ot">&lt;-</span> piaac_variable <span class="sc">%&gt;%</span> </span>
<span id="cb87-2"><a href="handling.html#cb87-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="dv">25</span> <span class="sc">&lt;=</span> age <span class="sc">&amp;</span> age <span class="sc">&lt;=</span> <span class="dv">64</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb87-3"><a href="handling.html#cb87-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(work <span class="sc">==</span> <span class="dv">1</span>)</span></code></pre></div>
</div>
<div id="欠損値の扱い" class="section level3" number="4.5.2">
<h3><span class="header-section-number">4.5.2</span> 欠損値の扱い</h3>
<p>さて、上記のように分析対象を限定した。このデータに含まれる人数を確認してみる。<code>nrow()</code>を使うと、データフレーム（あるいはベクトル）の長さを調べることができる。</p>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb88-1"><a href="handling.html#cb88-1" aria-hidden="true" tabindex="-1"></a>piaac_sample <span class="sc">%&gt;%</span> <span class="fu">nrow</span>()</span></code></pre></div>
<pre><code>## [1] 3330</code></pre>
<p>このように、3330行からなるデータであることがわかる。しかしながら、回答者がすべての質問について回答しているわけではなく、回答を拒否したり、当該質問項目の対象者に当てはまらない（非該当）ために、値が入っていない（NAとなっている）場合がある。今回の資料で用いる変数について、<code>NA</code>となっている回答がどの程度あるかをみてみよう。</p>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb90-1"><a href="handling.html#cb90-1" aria-hidden="true" tabindex="-1"></a>piaac_sample <span class="sc">%&gt;%</span> <span class="fu">summary</span>()</span></code></pre></div>
<pre><code>##        id            wage              logwage        gender    
##  Min.   :   1   Min.   :     0.06   Min.   :-2.851   女性:1508  
##  1st Qu.:1310   1st Qu.:   937.50   1st Qu.: 6.843   男性:1822  
##  Median :2654   Median :  1445.09   Median : 7.276              
##  Mean   :2650   Mean   :  2027.32   Mean   : 7.311              
##  3rd Qu.:4008   3rd Qu.:  2224.38   3rd Qu.: 7.707              
##  Max.   :5278   Max.   :266666.67   Max.   :12.494              
##                 NA&#39;s   :464         NA&#39;s   :464                 
##       age             work      workhour                     workhour_fct 
##  Min.   :25.00   Min.   :1   Min.   : 0.200   短時間（35時間未満） : 721  
##  1st Qu.:36.00   1st Qu.:1   1st Qu.: 7.000   通常（35-49時間）    :1643  
##  Median :44.00   Median :1   Median : 8.000   準長時間（50-59時間）: 590  
##  Mean   :44.66   Mean   :1   Mean   : 8.272   長時間（60時間以上） : 368  
##  3rd Qu.:54.00   3rd Qu.:1   3rd Qu.:10.000   NA&#39;s                 :   8  
##  Max.   :64.00   Max.   :1   Max.   :22.400                               
##                              NA&#39;s   :8                                    
##          educ               mothereduc            fathereduc  
##  中学      : 305   母親：初等教育:1112   父親：初等教育:1110  
##  高校      :1187   母親：中等教育:1504   父親：中等教育:1305  
##  短大高専  : 793   母親：高等教育: 583   父親：高等教育: 760  
##  大学大学院:1044   NA&#39;s          : 131   NA&#39;s          : 155  
##  NA&#39;s      :   1                                              
##                                                               
##                                                               
##         parenteduc              occupation     numeracy          ojt        
##  親：初等教育: 853   サービス・販売  :712   Min.   :103.4   Min.   :0.0000  
##  親：中等教育:1411   技術職・准専門職:532   1st Qu.:266.6   1st Qu.:0.0000  
##  親：高等教育: 977   専門職          :512   Median :296.3   Median :0.0000  
##  NA&#39;s        :  89   事務補助        :491   Mean   :293.6   Mean   :0.3459  
##                      技能工          :349   3rd Qu.:323.2   3rd Qu.:1.0000  
##                      (Other)         :713   Max.   :440.9   Max.   :1.0000  
##                      NA&#39;s            : 21                                   
##      health     
##  Min.   :1.000  
##  1st Qu.:2.000  
##  Median :3.000  
##  Mean   :3.038  
##  3rd Qu.:4.000  
##  Max.   :5.000  
## </code></pre>
<p><code>NA's</code>と書かれているのが、各変数でNAとなっている行の数である。項目によってはNAがない変数もあるし、たくさんNAがある変数もある。</p>
<p>NAが含まれている変数は分析の際に集計が面倒だったりして、色々と取り扱いが難しい。そこで、分析に使う変数にNAが含まれている行はサンプルから除外しておくと集計が楽になる。<code>filter()</code>を使って、educ, occupation, wageの3つの変数についてNAが含まれている行を除外してみよう。</p>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb92-1"><a href="handling.html#cb92-1" aria-hidden="true" tabindex="-1"></a>piaac_sample <span class="ot">&lt;-</span> piaac_sample <span class="sc">%&gt;%</span> </span>
<span id="cb92-2"><a href="handling.html#cb92-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">is.na</span>(educ) <span class="sc">==</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb92-3"><a href="handling.html#cb92-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">is.na</span>(occupation) <span class="sc">==</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb92-4"><a href="handling.html#cb92-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">is.na</span>(wage) <span class="sc">==</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<p><code>is.na()</code>は値がNAであれば<code>TRUE</code>、NAでなければ<code>FALSE</code>を返す関数である。<code>filter(is.na(educ) == FALSE)</code>とすると、educがNA<strong>ではない</strong>ケースだけを残してね、という命令になる。上記のコードを実行したあとの回答を再度チェックしてみよう：</p>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb93-1"><a href="handling.html#cb93-1" aria-hidden="true" tabindex="-1"></a>piaac_sample <span class="sc">%&gt;%</span> <span class="fu">nrow</span>()</span></code></pre></div>
<pre><code>## [1] 2847</code></pre>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb95-1"><a href="handling.html#cb95-1" aria-hidden="true" tabindex="-1"></a>piaac_sample <span class="sc">%&gt;%</span> <span class="fu">summary</span>()</span></code></pre></div>
<pre><code>##        id            wage              logwage        gender    
##  Min.   :   1   Min.   :     0.06   Min.   :-2.851   女性:1344  
##  1st Qu.:1300   1st Qu.:   936.20   1st Qu.: 6.842   男性:1503  
##  Median :2656   Median :  1445.09   Median : 7.276              
##  Mean   :2646   Mean   :  2027.52   Mean   : 7.311              
##  3rd Qu.:3986   3rd Qu.:  2217.73   3rd Qu.: 7.704              
##  Max.   :5278   Max.   :266666.67   Max.   :12.494              
##                                                                 
##       age             work      workhour                     workhour_fct 
##  Min.   :25.00   Min.   :1   Min.   : 0.200   短時間（35時間未満） : 628  
##  1st Qu.:35.00   1st Qu.:1   1st Qu.: 7.000   通常（35-49時間）    :1452  
##  Median :43.00   Median :1   Median : 8.000   準長時間（50-59時間）: 501  
##  Mean   :44.07   Mean   :1   Mean   : 8.173   長時間（60時間以上） : 266  
##  3rd Qu.:53.00   3rd Qu.:1   3rd Qu.:10.000                               
##  Max.   :64.00   Max.   :1   Max.   :21.600                               
##                                                                           
##          educ               mothereduc            fathereduc  
##  中学      : 244   母親：初等教育: 931   父親：初等教育: 931  
##  高校      :1006   母親：中等教育:1305   父親：中等教育:1141  
##  短大高専  : 701   母親：高等教育: 511   父親：高等教育: 653  
##  大学大学院: 896   NA&#39;s          : 100   NA&#39;s          : 122  
##                                                               
##                                                               
##                                                               
##         parenteduc              occupation     numeracy          ojt        
##  親：初等教育: 711   サービス・販売  :598   Min.   :103.4   Min.   :0.0000  
##  親：中等教育:1228   事務補助        :461   1st Qu.:267.0   1st Qu.:0.0000  
##  親：高等教育: 844   技術職・准専門職:454   Median :296.5   Median :0.0000  
##  NA&#39;s        :  64   専門職          :428   Mean   :294.1   Mean   :0.3635  
##                      技能工          :281   3rd Qu.:323.6   3rd Qu.:1.0000  
##                      管理職          :229   Max.   :440.9   Max.   :1.0000  
##                      (Other)         :396                                   
##      health     
##  Min.   :1.000  
##  1st Qu.:2.000  
##  Median :3.000  
##  Mean   :3.039  
##  3rd Qu.:4.000  
##  Max.   :5.000  
## </code></pre>
<p>データの行数は先ほどよりも減っており、またwage, educ, occupationに含まれていたNA’sの表記が消えていることがわかる。</p>
<p>このように、変数に欠損が含まれるケースを除外するような処理の仕方をさして、<strong>リストワイズ削除 listwise delition</strong>という。今日では欠損値の処理としてあまり望ましくない処理とされているが、まずはこのやりかたでやるのがよいだろう。欠損があまりに多い場合には、何らかのデータ操作のミス、調査のうえでの何らかの問題、そのほかの理由が考えられるため、欠損の数がどれくらいあるのかは注意して見ておくとよいだろう。</p>
</div>
<div id="外れ値の扱い" class="section level3" number="4.5.3">
<h3><span class="header-section-number">4.5.3</span> 外れ値の扱い</h3>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb97-1"><a href="handling.html#cb97-1" aria-hidden="true" tabindex="-1"></a>piaac_sample <span class="sc">%&gt;%</span> </span>
<span id="cb97-2"><a href="handling.html#cb97-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> wage)) <span class="sc">+</span></span>
<span id="cb97-3"><a href="handling.html#cb97-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>()</span></code></pre></div>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p><img src="seminar_doc_files/figure-html/unnamed-chunk-68-1.png" width="672" /></p>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb99-1"><a href="handling.html#cb99-1" aria-hidden="true" tabindex="-1"></a>piaac_sample <span class="ot">&lt;-</span> piaac_sample <span class="sc">%&gt;%</span> </span>
<span id="cb99-2"><a href="handling.html#cb99-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">wage_tile =</span> <span class="fu">ntile</span>(wage, <span class="dv">100</span>))</span>
<span id="cb99-3"><a href="handling.html#cb99-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-4"><a href="handling.html#cb99-4" aria-hidden="true" tabindex="-1"></a>piaac_sample <span class="sc">%&gt;%</span> </span>
<span id="cb99-5"><a href="handling.html#cb99-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(wage_tile) <span class="sc">%&gt;%</span> </span>
<span id="cb99-6"><a href="handling.html#cb99-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">min =</span> <span class="fu">min</span>(wage), </span>
<span id="cb99-7"><a href="handling.html#cb99-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">max =</span> <span class="fu">max</span>(wage))</span></code></pre></div>
<pre><code>## # A tibble: 100 × 3
##    wage_tile      min   max
##        &lt;int&gt;    &lt;dbl&gt; &lt;dbl&gt;
##  1         1   0.0578  462.
##  2         2 462.      600 
##  3         3 600       650 
##  4         4 650       694.
##  5         5 694.      700 
##  6         6 700.      723.
##  7         7 723.      750 
##  8         8 750       757.
##  9         9 758.      771.
## 10        10 771.      792.
## # … with 90 more rows</code></pre>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb101-1"><a href="handling.html#cb101-1" aria-hidden="true" tabindex="-1"></a>piaac_sample <span class="ot">&lt;-</span> piaac_sample <span class="sc">%&gt;%</span> </span>
<span id="cb101-2"><a href="handling.html#cb101-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="dv">2</span> <span class="sc">&lt;=</span> wage_tile <span class="sc">&amp;</span> wage_tile <span class="sc">&lt;=</span> <span class="dv">99</span>)</span></code></pre></div>
<div class="sourceCode" id="cb102"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb102-1"><a href="handling.html#cb102-1" aria-hidden="true" tabindex="-1"></a>piaac_sample <span class="sc">%&gt;%</span> </span>
<span id="cb102-2"><a href="handling.html#cb102-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> wage)) <span class="sc">+</span></span>
<span id="cb102-3"><a href="handling.html#cb102-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>()</span></code></pre></div>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p><img src="seminar_doc_files/figure-html/unnamed-chunk-71-1.png" width="672" /></p>
</div>
<div id="分析用データを書き出す" class="section level3" number="4.5.4">
<h3><span class="header-section-number">4.5.4</span> 分析用データを書き出す</h3>
<p>上記のような手順を経て、ようやく分析することのできるデータを準備することができる。晴れて準備できたデータを、新しいデータとして保存しておこう。<code>readr::write_excel_csv()</code>を使うと、データフレームを<a href="import.html#import_rds">rds形式</a>で書き出すことができる。</p>
<div class="sourceCode" id="cb104"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb104-1"><a href="handling.html#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(piaac_sample, <span class="at">file =</span> <span class="st">&quot;data/piaac_sample.rds&quot;</span>)</span></code></pre></div>
<p>以降では、このデータを使って分析を行っていく。</p>
</div>
</div>
<div id="データの追加複数のデータを合併し行を追加する該当者のみ" class="section level2" number="4.6">
<h2><span class="header-section-number">4.6</span> データの追加：複数のデータを合併し、行を追加する（該当者のみ）</h2>
<p>たとえば複数の社会調査データを合併してサンプルサイズを増やしたり、時系列比較を行いたいといったことがあるかもしれない。このような場合には、データを追加する操作を行う。</p>
<p>以下のような2つのデータがあるとする。</p>
<pre><code>## # A tibble: 6 × 4
##      id    x1    x2 data  
##   &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; 
## 1     1     5     1 data 1
## 2     2     8     1 data 1
## 3     3     2     1 data 1
## 4     4     0     2 data 1
## 5     5     6     2 data 1
## 6     6     1     2 data 1</code></pre>
<pre><code>## # A tibble: 4 × 4
##      id    x1    x2 data  
##   &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; 
## 1     7     9     2 data 2
## 2     8     4     1 data 2
## 3     9     0     2 data 2
## 4    10     2     1 data 2</code></pre>
<p>この2つのデータを合併したいときには、<code>dplyr::bind_rows()</code>を使う。</p>
<div class="sourceCode" id="cb107"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb107-1"><a href="handling.html#cb107-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> df1 <span class="sc">%&gt;%</span> </span>
<span id="cb107-2"><a href="handling.html#cb107-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(df2) </span></code></pre></div>

</div>
</div>
<div class="footnotes">
<hr />
<ol start="4">
<li id="fn4"><p>実際、ある査読付き雑誌に掲載された論文が、売上高がわからないケースに対して付されていた88,888,888,888という値をNAにすることなく分析していたのではないか（実際、それをNAにすると分析の結果はまったく違うものになる）という<a href="https://doi.org/10.1177/0003122417714422">指摘</a>がなされたことがある。大学院時代の指導教員は「先行研究で言われていないような意外な結果が出たら、たいていはプログラムが間違っているものだ（だからちゃんとチェックしなさい）」とよく言っていた。<a href="handling.html#fnref4" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="import.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="descriptives.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
