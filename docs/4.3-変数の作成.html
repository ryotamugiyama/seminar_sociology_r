<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta property="og:title" content="4.3 変数の作成 | 社会調査データ分析のためのRの手引き" />
<meta property="og:type" content="book" />


<meta property="og:description" content="This is the document for the class Seminar in Sociology held in Department of Political Studies, Gakushuin University. Anyone can freely use this as reference." />


<meta name="author" content="Ryota Mugiyama (Department of Political Studies, Gakushuin University)" />

<meta name="date" content="2022-02-14" />

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  TeX: { equationNumbers: { autoNumber: "AMS" } }
});
</script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<meta name="description" content="This is the document for the class Seminar in Sociology held in Department of Political Studies, Gakushuin University. Anyone can freely use this as reference.">

<title>4.3 変数の作成 | 社会調査データ分析のためのRの手引き</title>

<script src="libs/header-attrs-2.11/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="libs/bootstrap-3.3.5/css/flatly.min.css" rel="stylesheet" />
<script src="libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="libs/navigation-1.1/tabsets.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>




<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
/* show arrow before summary tag as in bootstrap
TODO: remove if boostrap in updated in html_document (rmarkdown#1485) */
details > summary {
  display: list-item;
  cursor: pointer;
}
</style>
</head>

<body>

<div class="container-fluid main-container">


<div class="row">
<div class="col-sm-12">
<div id="TOC">
<ul>
<li><a href="index.html#まえがき">まえがき</a></li>
<li><a href="1-plan.html#plan"><span class="toc-section-number">1</span> 研究計画を立てる</a>
<ul>
<li><a href="1.1-研究計画とは.html#研究計画とは"><span class="toc-section-number">1.1</span> 研究計画とは</a></li>
<li><a href="1.2-研究背景.html#研究背景"><span class="toc-section-number">1.2</span> 研究背景</a>
<ul>
<li><a href="1.2-研究背景.html#問題背景1段落程度"><span class="toc-section-number">1.2.1</span> 問題背景（1段落程度）</a></li>
<li><a href="1.2-研究背景.html#先行研究の検討13段落程度"><span class="toc-section-number">1.2.2</span> 先行研究の検討（1–3段落程度）</a></li>
</ul></li>
<li><a href="1.3-研究目的問い.html#研究目的問い"><span class="toc-section-number">1.3</span> 研究目的・問い</a>
<ul>
<li><a href="1.3-研究目的問い.html#研究目的問い12段落程度"><span class="toc-section-number">1.3.1</span> 研究目的・問い（1–2段落程度）</a></li>
<li><a href="1.3-研究目的問い.html#仮説1段落程度あれば"><span class="toc-section-number">1.3.2</span> 仮説（1段落程度、あれば）</a></li>
</ul></li>
<li><a href="1.4-方法.html#方法"><span class="toc-section-number">1.4</span> 方法</a>
<ul>
<li><a href="1.4-方法.html#データ"><span class="toc-section-number">1.4.1</span> データ</a></li>
<li><a href="1.4-方法.html#分析対象"><span class="toc-section-number">1.4.2</span> 分析対象</a></li>
<li><a href="1.4-方法.html#使用する変数"><span class="toc-section-number">1.4.3</span> 使用する変数</a></li>
<li><a href="1.4-方法.html#分析方法"><span class="toc-section-number">1.4.4</span> 分析方法</a></li>
</ul></li>
<li><a href="1.5-参考文献.html#参考文献"><span class="toc-section-number">1.5</span> 参考文献</a></li>
<li><a href="1.6-使用する調査データの選定.html#使用する調査データの選定"><span class="toc-section-number">1.6</span> 使用する調査データの選定</a>
<ul>
<li><a href="1.6-使用する調査データの選定.html#個票データとは何か"><span class="toc-section-number">1.6.1</span> 個票データとは何か</a></li>
<li><a href="1.6-使用する調査データの選定.html#jgss"><span class="toc-section-number">1.6.2</span> JGSS</a></li>
<li><a href="1.6-使用する調査データの選定.html#jgss以外の日本の社会調査"><span class="toc-section-number">1.6.3</span> JGSS以外の日本の社会調査</a></li>
<li><a href="1.6-使用する調査データの選定.html#日本以外の社会調査データ"><span class="toc-section-number">1.6.4</span> 日本以外の社会調査データ</a></li>
</ul></li>
<li><a href="1.7-先行研究を探す.html#先行研究を探す"><span class="toc-section-number">1.7</span> 先行研究を探す</a>
<ul>
<li><a href="1.7-先行研究を探す.html#査読つき論文"><span class="toc-section-number">1.7.1</span> 査読つき論文</a></li>
<li><a href="1.7-先行研究を探す.html#研究の流れをつかむ"><span class="toc-section-number">1.7.2</span> 研究の流れをつかむ</a></li>
<li><a href="1.7-先行研究を探す.html#英語論文"><span class="toc-section-number">1.7.3</span> 英語論文</a></li>
<li><a href="1.7-先行研究を探す.html#先行研究の重要性"><span class="toc-section-number">1.7.4</span> 先行研究の重要性</a></li>
</ul></li>
</ul></li>
<li><a href="2-preparation.html#preparation"><span class="toc-section-number">2</span> RStudioの下準備</a>
<ul>
<li><a href="2.1-rとrstudioのインストール方法.html#rとrstudioのインストール方法"><span class="toc-section-number">2.1</span> RとRStudioのインストール方法</a></li>
<li><a href="2.2-プロジェクトの作成.html#プロジェクトの作成"><span class="toc-section-number">2.2</span> プロジェクトの作成</a>
<ul>
<li><a href="2.2-プロジェクトの作成.html#ファイルパスについて"><span class="toc-section-number">2.2.1</span> ファイルパスについて</a></li>
<li><a href="2.2-プロジェクトの作成.html#授業用のフォルダを作ろう"><span class="toc-section-number">2.2.2</span> 授業用のフォルダを作ろう</a></li>
<li><a href="2.2-プロジェクトの作成.html#プロジェクト作成の手順"><span class="toc-section-number">2.2.3</span> プロジェクト作成の手順</a></li>
</ul></li>
<li><a href="2.3-基本的な見方.html#基本的な見方"><span class="toc-section-number">2.3</span> 基本的な見方</a>
<ul>
<li><a href="2.3-基本的な見方.html#ちょっとさわってみる"><span class="toc-section-number">2.3.1</span> ちょっとさわってみる</a></li>
<li><a href="2.3-基本的な見方.html#スクリプトファイル"><span class="toc-section-number">2.3.2</span> スクリプトファイル</a></li>
</ul></li>
<li><a href="2.4-パッケージのインストール.html#パッケージのインストール"><span class="toc-section-number">2.4</span> パッケージのインストール</a></li>
<li><a href="2.5-データ読み込み以前のrの基礎.html#データ読み込み以前のrの基礎"><span class="toc-section-number">2.5</span> データ読み込み以前のRの基礎</a></li>
</ul></li>
<li><a href="3-import.html#import"><span class="toc-section-number">3</span> データの読み込み</a>
<ul>
<li><a href="3.1-rのサンプルデータの読み込み.html#rのサンプルデータの読み込み"><span class="toc-section-number">3.1</span> Rのサンプルデータの読み込み</a></li>
<li><a href="3.2-作業ディレクトリ上のデータの読み込み.html#作業ディレクトリ上のデータの読み込み"><span class="toc-section-number">3.2</span> 作業ディレクトリ上のデータの読み込み</a>
<ul>
<li><a href="3.2-作業ディレクトリ上のデータの読み込み.html#csv形式のファイル"><span class="toc-section-number">3.2.1</span> csv形式のファイル</a></li>
<li><a href="3.2-作業ディレクトリ上のデータの読み込み.html#xlsx形式のファイル"><span class="toc-section-number">3.2.2</span> xlsx形式のファイル</a></li>
<li><a href="3.2-作業ディレクトリ上のデータの読み込み.html#sav形式のファイル"><span class="toc-section-number">3.2.3</span> sav形式のファイル</a></li>
<li><a href="3.2-作業ディレクトリ上のデータの読み込み.html#dta形式のファイル"><span class="toc-section-number">3.2.4</span> dta形式のファイル</a></li>
<li><a href="3.2-作業ディレクトリ上のデータの読み込み.html#文字コードに関わる問題"><span class="toc-section-number">3.2.5</span> 文字コードに関わる問題</a></li>
</ul></li>
<li><a href="3.3-ウェブ上のデータの読み込み.html#ウェブ上のデータの読み込み"><span class="toc-section-number">3.3</span> ウェブ上のデータの読み込み</a></li>
</ul></li>
<li><a href="4-handling.html#handling"><span class="toc-section-number">4</span> データの加工</a>
<ul>
<li><a href="4.1-サンプルデータの説明.html#サンプルデータの説明"><span class="toc-section-number">4.1</span> サンプルデータの説明</a></li>
<li><a href="4.2-データ加工のステップ.html#データ加工のステップ"><span class="toc-section-number">4.2</span> データ加工のステップ</a>
<ul>
<li><a href="4.2-データ加工のステップ.html#データの追加複数のデータを合併し行を追加する該当者のみ"><span class="toc-section-number">4.2.1</span> データの追加：複数のデータを合併し、行を追加する（該当者のみ）</a></li>
<li><a href="4.2-データ加工のステップ.html#変数の作成もとのデータに列を追加する"><span class="toc-section-number">4.2.2</span> 変数の作成：もとのデータに列を追加する</a></li>
<li><a href="4.2-データ加工のステップ.html#サンプルの限定もとのデータから行を削除する"><span class="toc-section-number">4.2.3</span> サンプルの限定：もとのデータから行を削除する</a></li>
</ul></li>
<li><a href="4.3-変数の作成.html#変数の作成"><span class="toc-section-number">4.3</span> 変数の作成</a>
<ul>
<li><a href="4.3-変数の作成.html#変数の型数値か文字列か"><span class="toc-section-number">4.3.1</span> 変数の型（数値か、文字列か）</a></li>
<li><a href="4.3-変数の作成.html#新たな変数をつくるmutate"><span class="toc-section-number">4.3.2</span> 新たな変数をつくる：mutate()</a></li>
<li><a href="4.3-変数の作成.html#条件の指定if_else"><span class="toc-section-number">4.3.3</span> 条件の指定：if_else()</a></li>
<li><a href="4.3-変数の作成.html#複数条件の指定case_when"><span class="toc-section-number">4.3.4</span> 複数条件の指定：case_when()</a></li>
<li><a href="4.3-変数の作成.html#カテゴリ変数へ変換factor"><span class="toc-section-number">4.3.5</span> カテゴリ変数へ変換：factor()</a></li>
<li><a href="4.3-変数の作成.html#必要な列のみ抽出select"><span class="toc-section-number">4.3.6</span> 必要な列のみ抽出：select()</a></li>
<li><a href="4.3-変数の作成.html#をつなげてコマンドをまとめる"><span class="toc-section-number">4.3.7</span> %&gt;%をつなげてコマンドをまとめる</a></li>
</ul></li>
<li><a href="4.4-変数の作成についてのtips.html#変数の作成についてのtips"><span class="toc-section-number">4.4</span> 変数の作成についてのtips</a>
<ul>
<li><a href="4.4-変数の作成についてのtips.html#カテゴリをまとめる"><span class="toc-section-number">4.4.1</span> カテゴリをまとめる</a></li>
<li><a href="4.4-変数の作成についてのtips.html#均等な順序を仮定して連続変数とする"><span class="toc-section-number">4.4.2</span> 均等な順序を仮定して連続変数とする</a></li>
<li><a href="4.4-変数の作成についてのtips.html#無回答非該当わからないなどをnaに"><span class="toc-section-number">4.4.3</span> 無回答、非該当、「わからない」などをNAに</a></li>
<li><a href="4.4-変数の作成についてのtips.html#カテゴリ変数の区間の中点をとって連続変数とする"><span class="toc-section-number">4.4.4</span> カテゴリ変数の区間の中点をとって連続変数とする</a></li>
</ul></li>
<li><a href="4.5-サンプルの限定.html#サンプルの限定"><span class="toc-section-number">4.5</span> サンプルの限定</a>
<ul>
<li><a href="4.5-サンプルの限定.html#サンプルを限定filter"><span class="toc-section-number">4.5.1</span> サンプルを限定：filter()</a></li>
<li><a href="4.5-サンプルの限定.html#欠損値の扱い"><span class="toc-section-number">4.5.2</span> 欠損値の扱い</a></li>
</ul></li>
</ul></li>
<li><a href="5-descriptives.html#descriptives"><span class="toc-section-number">5</span> 1変数の集計</a>
<ul>
<li><a href="5.1-連続変数を集計する.html#連続変数を集計する"><span class="toc-section-number">5.1</span> 連続変数を集計する</a></li>
<li><a href="5.2-連続変数の分布の可視化ヒストグラム.html#連続変数の分布の可視化ヒストグラム"><span class="toc-section-number">5.2</span> 連続変数の分布の可視化：ヒストグラム</a></li>
<li><a href="5.3-カテゴリ変数の集計.html#カテゴリ変数の集計"><span class="toc-section-number">5.3</span> カテゴリ変数の集計</a></li>
<li><a href="5.4-記述統計量の一覧表を作る.html#記述統計量の一覧表を作る"><span class="toc-section-number">5.4</span> 記述統計量の一覧表を作る</a>
<ul>
<li><a href="5.4-記述統計量の一覧表を作る.html#用いる変数に欠損があるケースを除外"><span class="toc-section-number">5.4.1</span> 用いる変数に欠損があるケースを除外</a></li>
<li><a href="5.4-記述統計量の一覧表を作る.html#変数にラベル名前をつける"><span class="toc-section-number">5.4.2</span> 変数にラベル（名前）をつける</a></li>
<li><a href="5.4-記述統計量の一覧表を作る.html#連続変数は平均値標準偏差を表示する"><span class="toc-section-number">5.4.3</span> 連続変数は平均値・標準偏差を表示する</a></li>
<li><a href="5.4-記述統計量の一覧表を作る.html#グループ別の記述統計量の一覧表"><span class="toc-section-number">5.4.4</span> グループ別の記述統計量の一覧表</a></li>
</ul></li>
</ul></li>
<li><a href="6-tabulate.html#tabulate"><span class="toc-section-number">6</span> 2変数の集計</a>
<ul>
<li><a href="6.1-変数の集計の類型.html#変数の集計の類型"><span class="toc-section-number">6.1</span> 2変数の集計の類型</a></li>
<li><a href="6.2-平均値の比較.html#平均値の比較"><span class="toc-section-number">6.2</span> 平均値の比較</a>
<ul>
<li><a href="6.2-平均値の比較.html#基本"><span class="toc-section-number">6.2.1</span> 基本</a></li>
<li><a href="6.2-平均値の比較.html#棒グラフによる可視化"><span class="toc-section-number">6.2.2</span> 棒グラフによる可視化</a></li>
<li><a href="6.2-平均値の比較.html#複数カテゴリの組み合わせ"><span class="toc-section-number">6.2.3</span> 複数カテゴリの組み合わせ</a></li>
</ul></li>
<li><a href="6.3-分布の比較.html#分布の比較"><span class="toc-section-number">6.3</span> 分布の比較</a></li>
<li><a href="6.4-クロス集計.html#クロス集計"><span class="toc-section-number">6.4</span> クロス集計</a>
<ul>
<li><a href="6.4-クロス集計.html#基本-1"><span class="toc-section-number">6.4.1</span> 基本</a></li>
<li><a href="6.4-クロス集計.html#きれいなクロス表をつくる---gtsummarytbl_cross"><span class="toc-section-number">6.4.2</span> きれいなクロス表をつくる - gtsummary::tbl_cross()</a></li>
</ul></li>
<li><a href="6.5-クロス集計表を図示する.html#クロス集計表を図示する"><span class="toc-section-number">6.5</span> クロス集計表を図示する</a></li>
<li><a href="6.6-散布図.html#散布図"><span class="toc-section-number">6.6</span> 散布図</a>
<ul>
<li><a href="6.6-散布図.html#散布図をみる"><span class="toc-section-number">6.6.1</span> 散布図をみる</a></li>
<li><a href="6.6-散布図.html#カテゴリごとに散布図を分ける"><span class="toc-section-number">6.6.2</span> カテゴリごとに散布図を分ける</a></li>
<li><a href="6.6-散布図.html#相関係数"><span class="toc-section-number">6.6.3</span> 相関係数</a></li>
</ul></li>
<li><a href="6.7-値が細かくない連続変数を扱う.html#値が細かくない連続変数を扱う"><span class="toc-section-number">6.7</span> 値が細かくない連続変数を扱う</a></li>
</ul></li>
<li><a href="7-regression_basic.html#regression_basic"><span class="toc-section-number">7</span> 回帰分析の基礎</a>
<ul>
<li><a href="7.1-説明.html#説明"><span class="toc-section-number">7.1</span> 説明</a></li>
<li><a href="7.2-最小二乗法ols工事中.html#最小二乗法ols工事中"><span class="toc-section-number">7.2</span> 最小二乗法（OLS）（工事中）</a></li>
<li><a href="7.3-独立変数がカテゴリ変数の場合.html#独立変数がカテゴリ変数の場合"><span class="toc-section-number">7.3</span> 独立変数がカテゴリ変数の場合</a>
<ul>
<li><a href="7.3-独立変数がカテゴリ変数の場合.html#値のカテゴリ"><span class="toc-section-number">7.3.1</span> 2値のカテゴリ</a></li>
<li><a href="7.3-独立変数がカテゴリ変数の場合.html#値以上のカテゴリ"><span class="toc-section-number">7.3.2</span> 3値以上のカテゴリ</a></li>
<li><a href="7.3-独立変数がカテゴリ変数の場合.html#変数がfactorであれば自動でカテゴリとして投入される"><span class="toc-section-number">7.3.3</span> 変数がfactorであれば自動でカテゴリとして投入される</a></li>
</ul></li>
<li><a href="7.4-従属変数が2値のカテゴリ変数01の場合.html#従属変数が2値のカテゴリ変数01の場合"><span class="toc-section-number">7.4</span> 従属変数が2値のカテゴリ変数（0/1）の場合</a>
<ul>
<li><a href="7.4-従属変数が2値のカテゴリ変数01の場合.html#発展ロバスト標準誤差"><span class="toc-section-number">7.4.1</span> （発展）ロバスト標準誤差</a></li>
</ul></li>
<li><a href="7.5-非線形の関連対数変換.html#非線形の関連対数変換"><span class="toc-section-number">7.5</span> 非線形の関連：対数変換</a>
<ul>
<li><a href="7.5-非線形の関連対数変換.html#対数変換とは"><span class="toc-section-number">7.5.1</span> 対数変換とは</a></li>
<li><a href="7.5-非線形の関連対数変換.html#自然対数と対数関数について"><span class="toc-section-number">7.5.2</span> 自然対数と対数関数について</a></li>
<li><a href="7.5-非線形の関連対数変換.html#対数を使った場合の回帰分析"><span class="toc-section-number">7.5.3</span> 対数を使った場合の回帰分析</a></li>
<li><a href="7.5-非線形の関連対数変換.html#対数を使った場合の回帰分析なぜになるのか"><span class="toc-section-number">7.5.4</span> 対数を使った場合の回帰分析：なぜ%になるのか</a></li>
<li><a href="7.5-非線形の関連対数変換.html#従属変数と独立変数の対数をとる"><span class="toc-section-number">7.5.5</span> 従属変数と独立変数の対数をとる</a></li>
</ul></li>
<li><a href="7.6-非線形の関連2次関数型.html#非線形の関連2次関数型"><span class="toc-section-number">7.6</span> 非線形の関連：2次関数型</a>
<ul>
<li><a href="7.6-非線形の関連2次関数型.html#いつ2次関数型が役に立つか"><span class="toc-section-number">7.6.1</span> いつ2次関数型が役に立つか</a></li>
<li><a href="7.6-非線形の関連2次関数型.html#変数の作成と結果"><span class="toc-section-number">7.6.2</span> 変数の作成と結果</a></li>
</ul></li>
<li><a href="7.7-結果をきれいに表示する.html#結果をきれいに表示する"><span class="toc-section-number">7.7</span> 結果をきれいに表示する</a></li>
</ul></li>
<li><a href="8-regression_advanced.html#regression_advanced"><span class="toc-section-number">8</span> 重回帰分析の活用</a>
<ul>
<li><a href="8.1-説明-1.html#説明-1"><span class="toc-section-number">8.1</span> 説明</a></li>
<li><a href="8.2-最小二乗法ols工事中-1.html#最小二乗法ols工事中-1"><span class="toc-section-number">8.2</span> 最小二乗法（OLS）（工事中）</a></li>
<li><a href="8.3-交絡要因の統制.html#交絡要因の統制"><span class="toc-section-number">8.3</span> 交絡要因の統制</a></li>
<li><a href="8.4-結果の比較と解釈.html#結果の比較と解釈"><span class="toc-section-number">8.4</span> 結果の比較と解釈</a></li>
<li><a href="8.5-媒介分析要因分解.html#媒介分析要因分解"><span class="toc-section-number">8.5</span> 媒介分析／要因分解</a>
<ul>
<li><a href="8.5-媒介分析要因分解.html#モチベーション"><span class="toc-section-number">8.5.1</span> モチベーション</a></li>
<li><a href="8.5-媒介分析要因分解.html#発展係数変化の可視化"><span class="toc-section-number">8.5.2</span> （発展）係数変化の可視化</a></li>
</ul></li>
<li><a href="8.6-重回帰分析の実際.html#重回帰分析の実際"><span class="toc-section-number">8.6</span> 重回帰分析の実際</a></li>
</ul></li>
<li><a href="9-domain.html#domain"><span class="toc-section-number">9</span> 社会学のデータ分析でよくある処理</a>
<ul>
<li><a href="9.1-ssm職業小分類を大分類にまとめる.html#ssm職業小分類を大分類にまとめる"><span class="toc-section-number">9.1</span> SSM職業小分類を大分類にまとめる</a>
<ul>
<li><a href="9.1-ssm職業小分類を大分類にまとめる.html#jgssの場合"><span class="toc-section-number">9.1.1</span> JGSSの場合</a></li>
<li><a href="9.1-ssm職業小分類を大分類にまとめる.html#ssmの場合"><span class="toc-section-number">9.1.2</span> SSMの場合</a></li>
</ul></li>
<li><a href="9.2-旧制学歴と新制学歴の対応.html#旧制学歴と新制学歴の対応"><span class="toc-section-number">9.2</span> 旧制学歴と新制学歴の対応</a></li>
<li><a href="9.3-年収と労働時間から時間給を作成する.html#年収と労働時間から時間給を作成する"><span class="toc-section-number">9.3</span> 年収と労働時間から時間給を作成する</a>
<ul>
<li><a href="9.3-年収と労働時間から時間給を作成する.html#ssm2005の例"><span class="toc-section-number">9.3.1</span> SSM2005の例</a></li>
<li><a href="9.3-年収と労働時間から時間給を作成する.html#万円以上というカテゴリの処理"><span class="toc-section-number">9.3.2</span> 「〜万円以上」というカテゴリの処理</a></li>
<li><a href="9.3-年収と労働時間から時間給を作成する.html#外れ値の処理"><span class="toc-section-number">9.3.3</span> 外れ値の処理</a></li>
</ul></li>
</ul></li>
<li><a href="10-writepaper.html#writepaper"><span class="toc-section-number">10</span> 論文の書き方</a>
<ul>
<li><a href="10.1-全体の構成.html#全体の構成"><span class="toc-section-number">10.1</span> 全体の構成</a></li>
<li><a href="10.2-タイトル.html#タイトル"><span class="toc-section-number">10.2</span> タイトル</a></li>
<li><a href="10.3-要約400字.html#要約400字"><span class="toc-section-number">10.3</span> 要約（400字）</a></li>
<li><a href="10.4-序論.html#序論"><span class="toc-section-number">10.4</span> 序論</a>
<ul>
<li><a href="10.4-序論.html#問題背景1段落"><span class="toc-section-number">10.4.1</span> 問題背景（1段落）</a></li>
<li><a href="10.4-序論.html#先行研究の検討12段落"><span class="toc-section-number">10.4.2</span> 先行研究の検討（1–2段落）</a></li>
<li><a href="10.4-序論.html#研究目的12段落"><span class="toc-section-number">10.4.3</span> 研究目的（1–2段落）</a></li>
<li><a href="10.4-序論.html#本文の構成1段落任意"><span class="toc-section-number">10.4.4</span> 本文の構成（1段落、任意）</a></li>
</ul></li>
<li><a href="10.5-先行研究理論枠組みと仮説.html#先行研究理論枠組みと仮説"><span class="toc-section-number">10.5</span> 先行研究（理論枠組み）と仮説</a></li>
<li><a href="10.6-方法-1.html#方法-1"><span class="toc-section-number">10.6</span> 方法</a>
<ul>
<li><a href="10.6-方法-1.html#データと分析対象"><span class="toc-section-number">10.6.1</span> データと分析対象</a></li>
<li><a href="10.6-方法-1.html#変数"><span class="toc-section-number">10.6.2</span> 変数</a></li>
<li><a href="10.6-方法-1.html#分析手法任意"><span class="toc-section-number">10.6.3</span> 分析手法（任意）</a></li>
</ul></li>
<li><a href="10.7-結果.html#結果"><span class="toc-section-number">10.7</span> 結果</a>
<ul>
<li><a href="10.7-結果.html#記述的分析"><span class="toc-section-number">10.7.1</span> 記述的分析</a></li>
<li><a href="10.7-結果.html#回帰分析"><span class="toc-section-number">10.7.2</span> 回帰分析</a></li>
</ul></li>
<li><a href="10.8-結論.html#結論"><span class="toc-section-number">10.8</span> 結論</a>
<ul>
<li><a href="10.8-結論.html#背景と目的の再確認1段落"><span class="toc-section-number">10.8.1</span> 背景と目的の再確認（1段落）</a></li>
<li><a href="10.8-結論.html#分析結果の要約と解釈23段落"><span class="toc-section-number">10.8.2</span> 分析結果の要約と解釈（2–3段落）</a></li>
<li><a href="10.8-結論.html#含意示唆12段落"><span class="toc-section-number">10.8.3</span> 含意・示唆（1–2段落）</a></li>
<li><a href="10.8-結論.html#課題限界1段落"><span class="toc-section-number">10.8.4</span> 課題・限界（1段落）</a></li>
<li><a href="10.8-結論.html#まとめ1段落任意"><span class="toc-section-number">10.8.5</span> まとめ（1段落、任意）</a></li>
</ul></li>
<li><a href="10.9-謝辞.html#謝辞"><span class="toc-section-number">10.9</span> 謝辞</a></li>
<li><a href="10.10-参考文献-1.html#参考文献-1"><span class="toc-section-number">10.10</span> 参考文献</a></li>
<li><a href="10.11-形式上の注意事項.html#形式上の注意事項"><span class="toc-section-number">10.11</span> 形式上の注意事項</a>
<ul>
<li><a href="10.11-形式上の注意事項.html#推奨するwordの設定"><span class="toc-section-number">10.11.1</span> 推奨するWordの設定</a></li>
<li><a href="10.11-形式上の注意事項.html#引用の形式"><span class="toc-section-number">10.11.2</span> 引用の形式</a></li>
<li><a href="10.11-形式上の注意事項.html#図表の形式"><span class="toc-section-number">10.11.3</span> 図表の形式</a></li>
<li><a href="10.11-形式上の注意事項.html#脚注"><span class="toc-section-number">10.11.4</span> 脚注</a></li>
<li><a href="10.11-形式上の注意事項.html#参考文献の記載例"><span class="toc-section-number">10.11.5</span> 参考文献の記載例</a></li>
</ul></li>
</ul></li>
<li><a href="11-reference.html#reference"><span class="toc-section-number">11</span> 参考文献・ウェブサイト</a></li>
</ul>
</div>
</div>
</div>
<div class="row">
<div class="col-sm-12">
<div id="変数の作成" class="section level2" number="4.3">
<h2><span class="header-section-number">4.3</span> 変数の作成</h2>
<div id="変数の型数値か文字列か" class="section level3" number="4.3.1">
<h3><span class="header-section-number">4.3.1</span> 変数の型（数値か、文字列か）</h3>
</div>
<div id="新たな変数をつくるmutate" class="section level3" number="4.3.2">
<h3><span class="header-section-number">4.3.2</span> 新たな変数をつくる：mutate()</h3>
<p>データ操作の基本は、すでにある変数を書き換えたりして、自分の関心に即した新しい変数を作ることである。このときに使用するのが<code>mutate()</code>。変数の加工を行うときには、ほとんどの場合この<code>mutate()</code>を使うことになる。以下に、いくつか簡単な例を挙げる。</p>
<div id="例1-もとの変数の内容をそのままコピーする" class="section level4" number="4.3.2.1">
<h4><span class="header-section-number">4.3.2.1</span> 例1: もとの変数の内容をそのままコピーする</h4>
<p>PIAACには、ボーナスの額を含めて、対象者の給与を時給換算した<code>earnhrbonus</code>という変数が含まれている。この変数をそのままコピーして、時給換算した賃金を表す変数<code>wage</code>を作成する。</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="4.3-変数の作成.html#cb45-1" aria-hidden="true" tabindex="-1"></a>piaac <span class="sc">%&gt;%</span> </span>
<span id="cb45-2"><a href="4.3-変数の作成.html#cb45-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">wage =</span> earnhrbonus)</span></code></pre></div>
<p>このコードは、「<code>piaac</code>というデータフレームに<code>wage</code>という列を追加してね、ちなみにその列には（既存の列である）<code>earnhrbonus</code>の値を入れてね」という命令を表している。</p>
<p>ただしこれだけだと新たに列を追加した結果だけが表示されて、データフレームそのものは更新されることはない。そこで、次のようにして、列を追加した結果を新たなデータフレームに格納してみる。</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="4.3-変数の作成.html#cb46-1" aria-hidden="true" tabindex="-1"></a>piaac_new <span class="ot">&lt;-</span> piaac <span class="sc">%&gt;%</span> </span>
<span id="cb46-2"><a href="4.3-変数の作成.html#cb46-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">wage =</span> earnhrbonus)</span></code></pre></div>
<p>すると、右側のEnvironmentのウインドウに新たに「piaac_new」というデータフレームが追加される。</p>
<p><img src="images/Rstudio_environment.png" /></p>
<p><code>piaac_new</code> というのが、新たに1つ列を追加したデータフレームである。</p>
<p>もしくは、次のように同じデータフレームに格納してもよい。</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="4.3-変数の作成.html#cb47-1" aria-hidden="true" tabindex="-1"></a>piaac <span class="ot">&lt;-</span> piaac <span class="sc">%&gt;%</span> </span>
<span id="cb47-2"><a href="4.3-変数の作成.html#cb47-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">wage =</span> earnhrbonus)</span></code></pre></div>
<p>先ほど<code>piaac_new</code> というデータフレームに格納したのが「名前をつけて保存」に当たるとしたら、これは「上書き保存」に当たるようなイメージである。どちらでも、個人の好みに応じて使い分けるとよいだろう。</p>
<p>さて、上記の処理を行った結果、<code>piaac</code>というデータフレームには、<code>earnhrbonus</code>とまったく同じ値が含まれる<code>wage</code>という列が作られたことがわかる。</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="4.3-変数の作成.html#cb48-1" aria-hidden="true" tabindex="-1"></a>piaac <span class="sc">%&gt;%</span> </span>
<span id="cb48-2"><a href="4.3-変数の作成.html#cb48-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(earnhrbonus, wage) <span class="sc">%&gt;%</span> <span class="co"># select()についてはこのあと解説があります</span></span>
<span id="cb48-3"><a href="4.3-変数の作成.html#cb48-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>()</span></code></pre></div>
<pre><code>## # A tibble: 6 × 2
##   earnhrbonus  wage
##         &lt;dbl&gt; &lt;dbl&gt;
## 1        793.  793.
## 2       1763. 1763.
## 3       2692. 2692.
## 4       2312. 2312.
## 5         NA    NA 
## 6       5192. 5192.</code></pre>
<p>もとの変数を何ら加工せずにそのまま使うとしても、元々の変数の名前がわかりやすいとはいえない名前になっていることはよくある（たとえば、<code>q31_3</code>、など）。このような場合には、今行ったように、その列が何の変数であるかがすぐに分かるように新たに名前を付けた列を作成すると、後から間違いが少なくなる。</p>
</div>
<div id="例2-もとの変数に何らかの計算を施す" class="section level4" number="4.3.2.2">
<h4><span class="header-section-number">4.3.2.2</span> 例2: もとの変数に何らかの計算を施す</h4>
<p>たとえば、1週間の労働時間を尋ねた変数<code>d_q10</code>を5で割って、平日1日あたりの労働時間に変換した列を作りたいというときがあるだろう。このような場合には次のように計算する。</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="4.3-変数の作成.html#cb50-1" aria-hidden="true" tabindex="-1"></a>piaac <span class="ot">&lt;-</span> piaac <span class="sc">%&gt;%</span> </span>
<span id="cb50-2"><a href="4.3-変数の作成.html#cb50-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">workhour =</span> d_q10 <span class="sc">/</span> <span class="dv">5</span>)</span></code></pre></div>
<p>新しく作った列<code>workhour</code>は、たしかにもともとの変数を5で割った値になっていることがわかる。</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="4.3-変数の作成.html#cb51-1" aria-hidden="true" tabindex="-1"></a>piaac <span class="sc">%&gt;%</span> </span>
<span id="cb51-2"><a href="4.3-変数の作成.html#cb51-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(d_q10, workhour) <span class="sc">%&gt;%</span> </span>
<span id="cb51-3"><a href="4.3-変数の作成.html#cb51-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>()</span></code></pre></div>
<pre><code>## # A tibble: 6 × 2
##   d_q10 workhour
##   &lt;dbl&gt;    &lt;dbl&gt;
## 1    48      9.6
## 2    60     12  
## 3    50     10  
## 4    60     12  
## 5    NA     NA  
## 6    40      8</code></pre>
</div>
<div id="例3-もとの変数と関係なくまったく新しい変数を作成する" class="section level4" number="4.3.2.3">
<h4><span class="header-section-number">4.3.2.3</span> 例3: もとの変数と関係なく、まったく新しい変数を作成する</h4>
<p>たとえば、以下のように1ずつ増える変数を作成することもできる。この変数を分析に直接使用するということはないが、通し番号が振ってあると何かと便利なことが多い。</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="4.3-変数の作成.html#cb53-1" aria-hidden="true" tabindex="-1"></a>piaac <span class="ot">&lt;-</span> piaac <span class="sc">%&gt;%</span> </span>
<span id="cb53-2"><a href="4.3-変数の作成.html#cb53-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">id =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>())</span></code></pre></div>
<p><code>n()</code> はデータフレーム内の行数を返す関数。上記3つの例で作成した変数を並べてみよう：</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="4.3-変数の作成.html#cb54-1" aria-hidden="true" tabindex="-1"></a>piaac <span class="sc">%&gt;%</span> </span>
<span id="cb54-2"><a href="4.3-変数の作成.html#cb54-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(id, wage, workhour) <span class="sc">%&gt;%</span> </span>
<span id="cb54-3"><a href="4.3-変数の作成.html#cb54-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>()</span></code></pre></div>
<pre><code>## # A tibble: 6 × 3
##      id  wage workhour
##   &lt;int&gt; &lt;dbl&gt;    &lt;dbl&gt;
## 1     1  793.      9.6
## 2     2 1763.     12  
## 3     3 2692.     10  
## 4     4 2312.     12  
## 5     5   NA      NA  
## 6     6 5192.      8</code></pre>
</div>
</div>
<div id="条件の指定if_else" class="section level3" number="4.3.3">
<h3><span class="header-section-number">4.3.3</span> 条件の指定：if_else()</h3>
<p>実際に<code>mutate()</code>で既存の変数の値を書き換えたりする場合には、カテゴリをまとめたり、複数の変数を組み合わせて新しい変数を作成したりすることが多い。そこでよく使う関数が<code>if_else()</code>、<code>case_when()</code>、<code>factor()</code>の3つである。</p>
<div id="if_elseの説明" class="section level4" number="4.3.3.1">
<h4><span class="header-section-number">4.3.3.1</span> if_else()の説明</h4>
<p><code>if_else()</code>は、条件を指定し、その条件に合う場合と合わない場合の値を返す関数。<code>if_else(条件, 条件に合う場合の値, 条件に合わない場合の値)</code>、というふうに使う。</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="4.3-変数の作成.html#cb56-1" aria-hidden="true" tabindex="-1"></a>piaac <span class="ot">&lt;-</span> piaac <span class="sc">%&gt;%</span> </span>
<span id="cb56-2"><a href="4.3-変数の作成.html#cb56-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">gender =</span> <span class="fu">if_else</span>(gender_r <span class="sc">==</span> <span class="dv">1</span>, <span class="st">&quot;男性&quot;</span>, <span class="st">&quot;女性&quot;</span>))</span></code></pre></div>
<p>上記は、<code>gender</code>という列に対して、<code>gender_r</code>の列の値が1ならば”男性”、そうでないならば”女性”という文字列を入れていね、という命令である。</p>
<p>新しく変数を作ったときには、きちんとできているかどうかを逐一確認するのがよい。たとえば以下のように、古い変数と新しい変数の<a href="6-tabulate.html#tabulate">クロス集計表</a>を作ってみるのが良い方法だろう。</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="4.3-変数の作成.html#cb57-1" aria-hidden="true" tabindex="-1"></a>piaac <span class="sc">%&gt;%</span> </span>
<span id="cb57-2"><a href="4.3-変数の作成.html#cb57-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">with</span>(<span class="fu">table</span>(gender_r, gender))</span></code></pre></div>
<pre><code>##         gender
## gender_r 女性 男性
##        1    0 2517
##        2 2761    0</code></pre>
</div>
<div id="論理演算子の説明" class="section level4" number="4.3.3.2">
<h4><span class="header-section-number">4.3.3.2</span> 論理演算子の説明</h4>
<p>上記の例のように、条件を指定するときには論理演算子というのを使用する。よく使う論理演算子の意味は次の通り。</p>
<table>
<colgroup>
<col width="12%" />
<col width="14%" />
<col width="29%" />
<col width="43%" />
</colgroup>
<thead>
<tr class="header">
<th>条件記号</th>
<th>意味</th>
<th>コード例</th>
<th>コード例の意味</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>==</code></td>
<td>等しい</td>
<td><code>age == 25</code></td>
<td>年齢が25に等しい</td>
</tr>
<tr class="even">
<td><code>!=</code></td>
<td>ではない</td>
<td><code>age != 25</code></td>
<td>年齢が25ではない</td>
</tr>
<tr class="odd">
<td><code>&gt;</code></td>
<td>より大きい</td>
<td><code>age &gt; 25</code></td>
<td>年齢が25より大きい</td>
</tr>
<tr class="even">
<td><code>&lt;</code></td>
<td>より小さい</td>
<td><code>age &lt; 25</code></td>
<td>年齢が25より小さい</td>
</tr>
<tr class="odd">
<td><code>&gt;=</code></td>
<td>以上</td>
<td><code>age &gt;= 25</code></td>
<td>年齢が25以上（25を含む）</td>
</tr>
<tr class="even">
<td><code>&lt;=</code></td>
<td>以下</td>
<td><code>age &lt;= 25</code></td>
<td>年齢が25以下（25を含む）</td>
</tr>
<tr class="odd">
<td><code>&amp;</code></td>
<td>かつ</td>
<td><code>age &gt;= 25 &amp; age &lt;= 54</code></td>
<td>年齢が25以上54以下</td>
</tr>
<tr class="even">
<td><code>|</code></td>
<td>または</td>
<td><code>age &lt; 35 | age &gt; 54</code></td>
<td>年齢が35より小さいまたは54より大きい</td>
</tr>
</tbody>
</table>
<p>以上、以下のときの不等号の位置（どちらも左側！）、等しいときには=ではなく==、などは間違えやすいので注意しよう。</p>
</div>
</div>
<div id="複数条件の指定case_when" class="section level3" number="4.3.4">
<h3><span class="header-section-number">4.3.4</span> 複数条件の指定：case_when()</h3>
<p><code>if_else()</code>の場合は条件節は一つだが、複数の条件を指定して、それぞれの条件に対応するときに特定の値を入れたい、というような時がある。このときには、複数条件を指定して値を書き換えるコマンドである、<code>case_when()</code>をつかうとよい。</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="4.3-変数の作成.html#cb59-1" aria-hidden="true" tabindex="-1"></a>piaac <span class="ot">&lt;-</span> piaac <span class="sc">%&gt;%</span> </span>
<span id="cb59-2"><a href="4.3-変数の作成.html#cb59-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">agegroup =</span> <span class="fu">case_when</span>(</span>
<span id="cb59-3"><a href="4.3-変数の作成.html#cb59-3" aria-hidden="true" tabindex="-1"></a>    <span class="dv">25</span> <span class="sc">&lt;=</span> age_r <span class="sc">&amp;</span> age_r <span class="sc">&lt;=</span> <span class="dv">34</span> <span class="sc">~</span> <span class="st">&quot;25-34歳&quot;</span>,</span>
<span id="cb59-4"><a href="4.3-変数の作成.html#cb59-4" aria-hidden="true" tabindex="-1"></a>    <span class="dv">35</span> <span class="sc">&lt;=</span> age_r <span class="sc">&amp;</span> age_r <span class="sc">&lt;=</span> <span class="dv">44</span> <span class="sc">~</span> <span class="st">&quot;35-44歳&quot;</span>,</span>
<span id="cb59-5"><a href="4.3-変数の作成.html#cb59-5" aria-hidden="true" tabindex="-1"></a>    <span class="dv">45</span> <span class="sc">&lt;=</span> age_r <span class="sc">&amp;</span> age_r <span class="sc">&lt;=</span> <span class="dv">54</span> <span class="sc">~</span> <span class="st">&quot;45-54歳&quot;</span>,</span>
<span id="cb59-6"><a href="4.3-変数の作成.html#cb59-6" aria-hidden="true" tabindex="-1"></a>    <span class="dv">55</span> <span class="sc">&lt;=</span> age_r <span class="sc">&amp;</span> age_r <span class="sc">&lt;=</span> <span class="dv">64</span> <span class="sc">~</span> <span class="st">&quot;55-64歳&quot;</span></span>
<span id="cb59-7"><a href="4.3-変数の作成.html#cb59-7" aria-hidden="true" tabindex="-1"></a>    ))</span></code></pre></div>
<p>ちゃんとできたかを確認しよう。</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="4.3-変数の作成.html#cb60-1" aria-hidden="true" tabindex="-1"></a>piaac <span class="sc">%&gt;%</span> </span>
<span id="cb60-2"><a href="4.3-変数の作成.html#cb60-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">with</span>(<span class="fu">table</span>(age_r, agegroup))</span></code></pre></div>
<pre><code>##      agegroup
## age_r 25-34歳 35-44歳 45-54歳 55-64歳
##    16       0       0       0       0
##    17       0       0       0       0
##    18       0       0       0       0
##    19       0       0       0       0
##    20       0       0       0       0
##    21       0       0       0       0
##    22       0       0       0       0
##    23       0       0       0       0
##    24       0       0       0       0
##    25      70       0       0       0
##    26      86       0       0       0
##    27      83       0       0       0
##    28      77       0       0       0
##    29     104       0       0       0
##    30      86       0       0       0
##    31     105       0       0       0
##    32     106       0       0       0
##    33     106       0       0       0
##    34     110       0       0       0
##    35       0     126       0       0
##    36       0     124       0       0
##    37       0     123       0       0
##    38       0     144       0       0
##    39       0     133       0       0
##    40       0     128       0       0
##    41       0     110       0       0
##    42       0     116       0       0
##    43       0     127       0       0
##    44       0     111       0       0
##    45       0       0      93       0
##    46       0       0     119       0
##    47       0       0     114       0
##    48       0       0     110       0
##    49       0       0     109       0
##    50       0       0      85       0
##    51       0       0      97       0
##    52       0       0     102       0
##    53       0       0     110       0
##    54       0       0      98       0
##    55       0       0       0     103
##    56       0       0       0      95
##    57       0       0       0      88
##    58       0       0       0     133
##    59       0       0       0      98
##    60       0       0       0     136
##    61       0       0       0     138
##    62       0       0       0     132
##    63       0       0       0     143
##    64       0       0       0     145
##    65       0       0       0       0</code></pre>
<p>もともとのデータには年齢が16歳から65歳の人が含まれているが、先ほどのコードでは16歳から24歳、65歳の人が条件に含まれていなかったので、新しく作成した列である<code>agegroup</code>には該当するものがないという結果になっている。このようなケースには<code>NA</code>が与えられる。</p>
<p>実際、<code>NA</code>が与えられているかどうかを確認してみよう。以下のように<code>with(table())</code>にオプション<code>useNA = "always"</code>を指定することで、<code>NA</code>についても集計することができる。</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="4.3-変数の作成.html#cb62-1" aria-hidden="true" tabindex="-1"></a>piaac <span class="sc">%&gt;%</span> </span>
<span id="cb62-2"><a href="4.3-変数の作成.html#cb62-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">with</span>(<span class="fu">table</span>(age_r, agegroup, <span class="at">useNA =</span> <span class="st">&quot;always&quot;</span>))</span></code></pre></div>
<pre><code>##       agegroup
## age_r  25-34歳 35-44歳 45-54歳 55-64歳 &lt;NA&gt;
##   16         0       0       0       0  114
##   17         0       0       0       0   90
##   18         0       0       0       0   96
##   19         0       0       0       0   76
##   20         0       0       0       0   90
##   21         0       0       0       0   75
##   22         0       0       0       0   72
##   23         0       0       0       0   88
##   24         0       0       0       0   84
##   25        70       0       0       0    0
##   26        86       0       0       0    0
##   27        83       0       0       0    0
##   28        77       0       0       0    0
##   29       104       0       0       0    0
##   30        86       0       0       0    0
##   31       105       0       0       0    0
##   32       106       0       0       0    0
##   33       106       0       0       0    0
##   34       110       0       0       0    0
##   35         0     126       0       0    0
##   36         0     124       0       0    0
##   37         0     123       0       0    0
##   38         0     144       0       0    0
##   39         0     133       0       0    0
##   40         0     128       0       0    0
##   41         0     110       0       0    0
##   42         0     116       0       0    0
##   43         0     127       0       0    0
##   44         0     111       0       0    0
##   45         0       0      93       0    0
##   46         0       0     119       0    0
##   47         0       0     114       0    0
##   48         0       0     110       0    0
##   49         0       0     109       0    0
##   50         0       0      85       0    0
##   51         0       0      97       0    0
##   52         0       0     102       0    0
##   53         0       0     110       0    0
##   54         0       0      98       0    0
##   55         0       0       0     103    0
##   56         0       0       0      95    0
##   57         0       0       0      88    0
##   58         0       0       0     133    0
##   59         0       0       0      98    0
##   60         0       0       0     136    0
##   61         0       0       0     138    0
##   62         0       0       0     132    0
##   63         0       0       0     143    0
##   64         0       0       0     145    0
##   65         0       0       0       0   70
##   &lt;NA&gt;       0       0       0       0    0</code></pre>
</div>
<div id="カテゴリ変数へ変換factor" class="section level3" number="4.3.5">
<h3><span class="header-section-number">4.3.5</span> カテゴリ変数へ変換：factor()</h3>
<p>PIAACには次のように、職場（事業所単位）で何人の従業員が働いているかを尋ねた質問項目（d_q06a）があるとする。</p>
<table>
<thead>
<tr class="header">
<th>選択肢</th>
<th>調査票の番号</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1-10人</td>
<td>1</td>
</tr>
<tr class="even">
<td>11-50人</td>
<td>2</td>
</tr>
<tr class="odd">
<td>51-250人</td>
<td>3</td>
</tr>
<tr class="even">
<td>251-1000人</td>
<td>4</td>
</tr>
<tr class="odd">
<td>1001人以上</td>
<td>5</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="4.3-変数の作成.html#cb64-1" aria-hidden="true" tabindex="-1"></a>piaac <span class="sc">%&gt;%</span> <span class="fu">with</span>(<span class="fu">table</span>(d_q06a))</span></code></pre></div>
<pre><code>## d_q06a
##    1    2    3    4    5 
##  852 1170  817  391  241</code></pre>
<p>この数値だけでは、何番が何を指しているのかよくわからない。そこで、この変数を文字列（factor）に変換した変数<code>officesize</code>を作成する。</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="4.3-変数の作成.html#cb66-1" aria-hidden="true" tabindex="-1"></a>piaac <span class="ot">&lt;-</span> piaac <span class="sc">%&gt;%</span> </span>
<span id="cb66-2"><a href="4.3-変数の作成.html#cb66-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">officesize =</span> <span class="fu">factor</span>(d_q06a,</span>
<span id="cb66-3"><a href="4.3-変数の作成.html#cb66-3" aria-hidden="true" tabindex="-1"></a>                              <span class="at">levels =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>,</span>
<span id="cb66-4"><a href="4.3-変数の作成.html#cb66-4" aria-hidden="true" tabindex="-1"></a>                              <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;1-10人&quot;</span>, <span class="st">&quot;11-50人&quot;</span>, <span class="st">&quot;51-250人&quot;</span>, <span class="st">&quot;251-1000人&quot;</span>, <span class="st">&quot;1001人以上&quot;</span>)))</span></code></pre></div>
<p>結果を確認：</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="4.3-変数の作成.html#cb67-1" aria-hidden="true" tabindex="-1"></a>piaac <span class="sc">%&gt;%</span> <span class="fu">with</span>(<span class="fu">table</span>(d_q06a, officesize))</span></code></pre></div>
<pre><code>##       officesize
## d_q06a 1-10人 11-50人 51-250人 251-1000人 1001人以上
##      1    852       0        0          0          0
##      2      0    1170        0          0          0
##      3      0       0      817          0          0
##      4      0       0        0        391          0
##      5      0       0        0          0        241</code></pre>
<p><code>if_else()</code>や<code>case_when()</code>を使って新しくカテゴリ変数を作るとき、カテゴリの順序が意図していたものとは違う順序になってしまうことがある。これは、文字列の場合はアルファベット順、日本語の場合はshift-jis順で並んでしまうことによる。</p>
<p>たとえば、1週間の労働時間（<code>d_q10</code>）に関する変数をもとに、労働時間の長さ別に分けたカテゴリ変数を作成したいと思ったとする。<code>case_when()</code> を使って作成すると、意図していた順序とは違ったバラバラの順番になってしまう。</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="4.3-変数の作成.html#cb69-1" aria-hidden="true" tabindex="-1"></a>piaac <span class="ot">&lt;-</span> piaac <span class="sc">%&gt;%</span> </span>
<span id="cb69-2"><a href="4.3-変数の作成.html#cb69-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">workhour_fct =</span> <span class="fu">case_when</span>(</span>
<span id="cb69-3"><a href="4.3-変数の作成.html#cb69-3" aria-hidden="true" tabindex="-1"></a>    d_q10 <span class="sc">&lt;</span> <span class="dv">35</span> <span class="sc">~</span> <span class="st">&quot;短時間（35時間未満）&quot;</span>,</span>
<span id="cb69-4"><a href="4.3-変数の作成.html#cb69-4" aria-hidden="true" tabindex="-1"></a>    d_q10 <span class="sc">&gt;=</span> <span class="dv">35</span> <span class="sc">&amp;</span> d_q10 <span class="sc">&lt;=</span> <span class="dv">49</span> <span class="sc">~</span> <span class="st">&quot;通常（35-49時間）&quot;</span>,</span>
<span id="cb69-5"><a href="4.3-変数の作成.html#cb69-5" aria-hidden="true" tabindex="-1"></a>    d_q10 <span class="sc">&gt;=</span> <span class="dv">50</span> <span class="sc">&amp;</span> d_q10 <span class="sc">&lt;=</span> <span class="dv">59</span> <span class="sc">~</span> <span class="st">&quot;準長時間（50-59時間）&quot;</span>,</span>
<span id="cb69-6"><a href="4.3-変数の作成.html#cb69-6" aria-hidden="true" tabindex="-1"></a>    d_q10 <span class="sc">&gt;=</span> <span class="dv">60</span> <span class="sc">~</span> <span class="st">&quot;長時間（60時間以上）&quot;</span></span>
<span id="cb69-7"><a href="4.3-変数の作成.html#cb69-7" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb69-8"><a href="4.3-変数の作成.html#cb69-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-9"><a href="4.3-変数の作成.html#cb69-9" aria-hidden="true" tabindex="-1"></a>piaac <span class="sc">%&gt;%</span> <span class="fu">with</span>(<span class="fu">table</span>(workhour_fct))</span></code></pre></div>
<pre><code>## workhour_fct
## 準長時間（50-59時間）  短時間（35時間未満）  長時間（60時間以上） 
##                   648                   960                   396 
##     通常（35-49時間） 
##                  1848</code></pre>
<p>このような場合には、いったん数値の変数を挟んでから<code>factor()</code> を使って変数を作成することで、順番がばらばらになってしまうのを防ぐことができる。</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="4.3-変数の作成.html#cb71-1" aria-hidden="true" tabindex="-1"></a>piaac <span class="ot">&lt;-</span> piaac <span class="sc">%&gt;%</span> </span>
<span id="cb71-2"><a href="4.3-変数の作成.html#cb71-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">workhour_fct =</span> <span class="fu">case_when</span>(</span>
<span id="cb71-3"><a href="4.3-変数の作成.html#cb71-3" aria-hidden="true" tabindex="-1"></a>    d_q10 <span class="sc">&lt;</span> <span class="dv">35</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb71-4"><a href="4.3-変数の作成.html#cb71-4" aria-hidden="true" tabindex="-1"></a>    d_q10 <span class="sc">&gt;=</span> <span class="dv">35</span> <span class="sc">&amp;</span> d_q10 <span class="sc">&lt;=</span> <span class="dv">49</span> <span class="sc">~</span> <span class="dv">2</span>,</span>
<span id="cb71-5"><a href="4.3-変数の作成.html#cb71-5" aria-hidden="true" tabindex="-1"></a>    d_q10 <span class="sc">&gt;=</span> <span class="dv">50</span> <span class="sc">&amp;</span> d_q10 <span class="sc">&lt;=</span> <span class="dv">59</span> <span class="sc">~</span> <span class="dv">3</span>,</span>
<span id="cb71-6"><a href="4.3-変数の作成.html#cb71-6" aria-hidden="true" tabindex="-1"></a>    d_q10 <span class="sc">&gt;=</span> <span class="dv">60</span> <span class="sc">~</span> <span class="dv">4</span></span>
<span id="cb71-7"><a href="4.3-変数の作成.html#cb71-7" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span> </span>
<span id="cb71-8"><a href="4.3-変数の作成.html#cb71-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">workhour_fct =</span> <span class="fu">factor</span>(workhour_fct,</span>
<span id="cb71-9"><a href="4.3-変数の作成.html#cb71-9" aria-hidden="true" tabindex="-1"></a>                               <span class="at">levels =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>,</span>
<span id="cb71-10"><a href="4.3-変数の作成.html#cb71-10" aria-hidden="true" tabindex="-1"></a>                               <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;短時間（35時間未満）&quot;</span>, <span class="st">&quot;通常（35-49時間）&quot;</span>, <span class="st">&quot;準長時間（50-59時間）&quot;</span>, <span class="st">&quot;長時間（60時間以上）&quot;</span>)))</span>
<span id="cb71-11"><a href="4.3-変数の作成.html#cb71-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-12"><a href="4.3-変数の作成.html#cb71-12" aria-hidden="true" tabindex="-1"></a>piaac <span class="sc">%&gt;%</span> <span class="fu">with</span>(<span class="fu">table</span>(workhour_fct)) </span></code></pre></div>
<pre><code>## workhour_fct
##  短時間（35時間未満）     通常（35-49時間） 準長時間（50-59時間） 
##                   960                  1848                   648 
##  長時間（60時間以上） 
##                   396</code></pre>
</div>
<div id="必要な列のみ抽出select" class="section level3" number="4.3.6">
<h3><span class="header-section-number">4.3.6</span> 必要な列のみ抽出：select()</h3>
<p>このコマンドは「変数の作成」の節で扱ったコマンドと比べるとやや特殊で、列を追加するのではなく、列を<strong>削除する</strong>という操作を行う。普通に分析をする限りは列を削除する必要はないが、一部の列だけを取り出してどのようになっているのかを確認したりしたいときなどに使う。</p>
<p>このときに使うコマンドが<code>select()</code>である。</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="4.3-変数の作成.html#cb73-1" aria-hidden="true" tabindex="-1"></a>piaac_sub <span class="ot">&lt;-</span> piaac <span class="sc">%&gt;%</span> </span>
<span id="cb73-2"><a href="4.3-変数の作成.html#cb73-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(gender, wage) <span class="co">#gender, wageの列を抽出</span></span></code></pre></div>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="4.3-変数の作成.html#cb74-1" aria-hidden="true" tabindex="-1"></a>piaac_sub <span class="ot">&lt;-</span> piaac <span class="sc">%&gt;%</span> </span>
<span id="cb74-2"><a href="4.3-変数の作成.html#cb74-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>gender, <span class="sc">-</span>wage) <span class="co">#gender, wage「以外」の列を抽出</span></span></code></pre></div>
</div>
<div id="をつなげてコマンドをまとめる" class="section level3" number="4.3.7">
<h3><span class="header-section-number">4.3.7</span> %&gt;%をつなげてコマンドをまとめる</h3>
<p>変数を作成する過程では、正しく変数を作れているかどうかを一つひとつ確認しながら進めていくことが必須である。しかし、正しく作成できたことが確認できたら、<code>with(table())</code>などを使って確認するコードは必ずしもスクリプトに残しておく必要はない。分析に使う変数が固まってきたら、変数を作成するためのコードを（ある程度）まとめておくと、コードがシンプルになってよいだろう。このようなときに、パイプ記法は有用である。</p>
<p>上記で作成した変数も含めて、本資料で使う変数をまとめて作成するためのコードを以下に記した。</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="4.3-変数の作成.html#cb75-1" aria-hidden="true" tabindex="-1"></a>piaac <span class="ot">&lt;-</span> piaac <span class="sc">%&gt;%</span> </span>
<span id="cb75-2"><a href="4.3-変数の作成.html#cb75-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">id =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb75-3"><a href="4.3-変数の作成.html#cb75-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">wage =</span> earnhrbonus) <span class="sc">%&gt;%</span> </span>
<span id="cb75-4"><a href="4.3-変数の作成.html#cb75-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">logwage =</span> <span class="fu">log</span>(wage)) <span class="sc">%&gt;%</span> </span>
<span id="cb75-5"><a href="4.3-変数の作成.html#cb75-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">gender =</span> <span class="fu">factor</span>(gender_r, <span class="at">level =</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">1</span>, <span class="at">label =</span> <span class="fu">c</span>(<span class="st">&quot;女性&quot;</span>,<span class="st">&quot;男性&quot;</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb75-6"><a href="4.3-変数の作成.html#cb75-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">age =</span> age_r) <span class="sc">%&gt;%</span> </span>
<span id="cb75-7"><a href="4.3-変数の作成.html#cb75-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">workhour =</span> d_q10) <span class="sc">%&gt;%</span> </span>
<span id="cb75-8"><a href="4.3-変数の作成.html#cb75-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">workhour_fct =</span> <span class="fu">case_when</span>(</span>
<span id="cb75-9"><a href="4.3-変数の作成.html#cb75-9" aria-hidden="true" tabindex="-1"></a>    d_q10 <span class="sc">&lt;</span> <span class="dv">35</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb75-10"><a href="4.3-変数の作成.html#cb75-10" aria-hidden="true" tabindex="-1"></a>    d_q10 <span class="sc">&gt;=</span> <span class="dv">35</span> <span class="sc">&amp;</span> d_q10 <span class="sc">&lt;=</span> <span class="dv">49</span> <span class="sc">~</span> <span class="dv">2</span>,</span>
<span id="cb75-11"><a href="4.3-変数の作成.html#cb75-11" aria-hidden="true" tabindex="-1"></a>    d_q10 <span class="sc">&gt;=</span> <span class="dv">50</span> <span class="sc">&amp;</span> d_q10 <span class="sc">&lt;=</span> <span class="dv">59</span> <span class="sc">~</span> <span class="dv">3</span>,</span>
<span id="cb75-12"><a href="4.3-変数の作成.html#cb75-12" aria-hidden="true" tabindex="-1"></a>    d_q10 <span class="sc">&gt;=</span> <span class="dv">60</span> <span class="sc">~</span> <span class="dv">4</span></span>
<span id="cb75-13"><a href="4.3-変数の作成.html#cb75-13" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span> </span>
<span id="cb75-14"><a href="4.3-変数の作成.html#cb75-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">workhour_fct =</span> <span class="fu">factor</span>(workhour_fct,</span>
<span id="cb75-15"><a href="4.3-変数の作成.html#cb75-15" aria-hidden="true" tabindex="-1"></a>                               <span class="at">levels =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>,</span>
<span id="cb75-16"><a href="4.3-変数の作成.html#cb75-16" aria-hidden="true" tabindex="-1"></a>                               <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;短時間（35時間未満）&quot;</span>, <span class="st">&quot;通常（35-49時間）&quot;</span>, <span class="st">&quot;準長時間（50-59時間）&quot;</span>, <span class="st">&quot;長時間（60時間以上）&quot;</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb75-17"><a href="4.3-変数の作成.html#cb75-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">officesize =</span> <span class="fu">factor</span>(d_q06a,</span>
<span id="cb75-18"><a href="4.3-変数の作成.html#cb75-18" aria-hidden="true" tabindex="-1"></a>                              <span class="at">levels =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>,</span>
<span id="cb75-19"><a href="4.3-変数の作成.html#cb75-19" aria-hidden="true" tabindex="-1"></a>                              <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;1-10人&quot;</span>, <span class="st">&quot;11-50人&quot;</span>, <span class="st">&quot;51-250人&quot;</span>, <span class="st">&quot;251-1000人&quot;</span>, <span class="st">&quot;1001人以上&quot;</span>)))  <span class="sc">%&gt;%</span> </span>
<span id="cb75-20"><a href="4.3-変数の作成.html#cb75-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">educ =</span> <span class="fu">case_when</span>(</span>
<span id="cb75-21"><a href="4.3-変数の作成.html#cb75-21" aria-hidden="true" tabindex="-1"></a>    edcat8 <span class="sc">==</span> <span class="dv">1</span> <span class="sc">|</span> edcat8 <span class="sc">==</span> <span class="dv">2</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb75-22"><a href="4.3-変数の作成.html#cb75-22" aria-hidden="true" tabindex="-1"></a>    edcat8 <span class="sc">==</span> <span class="dv">3</span> <span class="sc">~</span> <span class="dv">2</span>,</span>
<span id="cb75-23"><a href="4.3-変数の作成.html#cb75-23" aria-hidden="true" tabindex="-1"></a>    edcat8 <span class="sc">==</span> <span class="dv">4</span> <span class="sc">|</span> edcat8 <span class="sc">==</span> <span class="dv">5</span> <span class="sc">~</span> <span class="dv">3</span>,</span>
<span id="cb75-24"><a href="4.3-変数の作成.html#cb75-24" aria-hidden="true" tabindex="-1"></a>    edcat8 <span class="sc">==</span> <span class="dv">6</span> <span class="sc">|</span> edcat8 <span class="sc">==</span> <span class="dv">7</span> <span class="sc">|</span> edcat8 <span class="sc">==</span> <span class="dv">8</span> <span class="sc">~</span> <span class="dv">4</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb75-25"><a href="4.3-変数の作成.html#cb75-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">educ =</span> <span class="fu">factor</span>(educ, <span class="at">levels =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>,</span>
<span id="cb75-26"><a href="4.3-変数の作成.html#cb75-26" aria-hidden="true" tabindex="-1"></a>                       <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;中学&quot;</span>, <span class="st">&quot;高校&quot;</span>, <span class="st">&quot;短大高専&quot;</span>, <span class="st">&quot;大学大学院&quot;</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb75-27"><a href="4.3-変数の作成.html#cb75-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">mothereduc =</span> <span class="fu">factor</span>(j_q06b,</span>
<span id="cb75-28"><a href="4.3-変数の作成.html#cb75-28" aria-hidden="true" tabindex="-1"></a>                             <span class="at">levels =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>,</span>
<span id="cb75-29"><a href="4.3-変数の作成.html#cb75-29" aria-hidden="true" tabindex="-1"></a>                             <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;母親：初等教育&quot;</span>, <span class="st">&quot;母親：中等教育&quot;</span>, <span class="st">&quot;母親：高等教育&quot;</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb75-30"><a href="4.3-変数の作成.html#cb75-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fathereduc =</span> <span class="fu">factor</span>(j_q07b,</span>
<span id="cb75-31"><a href="4.3-変数の作成.html#cb75-31" aria-hidden="true" tabindex="-1"></a>                             <span class="at">levels =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>,</span>
<span id="cb75-32"><a href="4.3-変数の作成.html#cb75-32" aria-hidden="true" tabindex="-1"></a>                             <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;父親：初等教育&quot;</span>, <span class="st">&quot;父親：中等教育&quot;</span>, <span class="st">&quot;父親：高等教育&quot;</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb75-33"><a href="4.3-変数の作成.html#cb75-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-34"><a href="4.3-変数の作成.html#cb75-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">parenteduc =</span> <span class="fu">case_when</span>(</span>
<span id="cb75-35"><a href="4.3-変数の作成.html#cb75-35" aria-hidden="true" tabindex="-1"></a>    j_q07b <span class="sc">&gt;=</span> j_q06b <span class="sc">~</span> j_q07b,</span>
<span id="cb75-36"><a href="4.3-変数の作成.html#cb75-36" aria-hidden="true" tabindex="-1"></a>    j_q07b <span class="sc">&lt;</span> j_q06b <span class="sc">~</span> j_q06b,</span>
<span id="cb75-37"><a href="4.3-変数の作成.html#cb75-37" aria-hidden="true" tabindex="-1"></a>    <span class="fu">is.na</span>(j_q07b) <span class="sc">==</span> <span class="cn">TRUE</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(j_q06b) <span class="sc">==</span> <span class="cn">FALSE</span> <span class="sc">~</span> j_q06b,</span>
<span id="cb75-38"><a href="4.3-変数の作成.html#cb75-38" aria-hidden="true" tabindex="-1"></a>    <span class="fu">is.na</span>(j_q06b) <span class="sc">==</span> <span class="cn">TRUE</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(j_q07b) <span class="sc">==</span> <span class="cn">FALSE</span> <span class="sc">~</span> j_q07b</span>
<span id="cb75-39"><a href="4.3-変数の作成.html#cb75-39" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span> </span>
<span id="cb75-40"><a href="4.3-変数の作成.html#cb75-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">parenteduc =</span> <span class="fu">factor</span>(parenteduc,</span>
<span id="cb75-41"><a href="4.3-変数の作成.html#cb75-41" aria-hidden="true" tabindex="-1"></a>                             <span class="at">levels =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>,</span>
<span id="cb75-42"><a href="4.3-変数の作成.html#cb75-42" aria-hidden="true" tabindex="-1"></a>                             <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;親：初等教育&quot;</span>, <span class="st">&quot;親：中等教育&quot;</span>, <span class="st">&quot;親：高等教育&quot;</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb75-43"><a href="4.3-変数の作成.html#cb75-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">occupation =</span> <span class="fu">factor</span>(isco1c,</span>
<span id="cb75-44"><a href="4.3-変数の作成.html#cb75-44" aria-hidden="true" tabindex="-1"></a>                             <span class="at">levels =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">9</span>,</span>
<span id="cb75-45"><a href="4.3-変数の作成.html#cb75-45" aria-hidden="true" tabindex="-1"></a>                             <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;管理職&quot;</span>,<span class="st">&quot;専門職&quot;</span>,<span class="st">&quot;技術職・准専門職&quot;</span>,<span class="st">&quot;事務補助&quot;</span>,<span class="st">&quot;サービス・販売&quot;</span>,<span class="st">&quot;農林漁業&quot;</span>,<span class="st">&quot;技能工&quot;</span>,<span class="st">&quot;設備・機械運転・組立&quot;</span>,<span class="st">&quot;単純作業&quot;</span>)</span>
<span id="cb75-46"><a href="4.3-変数の作成.html#cb75-46" aria-hidden="true" tabindex="-1"></a>)) <span class="sc">%&gt;%</span> </span>
<span id="cb75-47"><a href="4.3-変数の作成.html#cb75-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">literacy =</span> pvlit1) <span class="sc">%&gt;%</span> </span>
<span id="cb75-48"><a href="4.3-変数の作成.html#cb75-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">numeracy =</span> pvnum1) <span class="sc">%&gt;%</span> </span>
<span id="cb75-49"><a href="4.3-変数の作成.html#cb75-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ojt =</span> <span class="dv">2</span> <span class="sc">-</span> b_q12c) <span class="sc">%&gt;%</span> </span>
<span id="cb75-50"><a href="4.3-変数の作成.html#cb75-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">health =</span> <span class="dv">6</span> <span class="sc">-</span> i_q08) </span></code></pre></div>
<p>このようにして作成した変数のみを残したデータを別途データフレームとして残しておこう。</p>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb76-1"><a href="4.3-変数の作成.html#cb76-1" aria-hidden="true" tabindex="-1"></a>piaac_variable <span class="ot">&lt;-</span> piaac <span class="sc">%&gt;%</span> </span>
<span id="cb76-2"><a href="4.3-変数の作成.html#cb76-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(id, wage, logwage, gender, age, workhour, workhour_fct, officesize, educ, mothereduc, fathereduc, parenteduc, occupation, literacy, numeracy, ojt, health)</span></code></pre></div>
</div>
</div>
<p style="text-align: center;">
<a href="4.2-データ加工のステップ.html"><button class="btn btn-default">Previous</button></a>
<a href="4.4-変数の作成についてのtips.html"><button class="btn btn-default">Next</button></a>
</p>
</div>
</div>


</div>

<script>

// add bootstrap table styles to pandoc tables
$(document).ready(function () {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
});

</script>

</body>
</html>
